<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Auth_db Module</title>
    <link rel="stylesheet" type="text/css" href="../../../../css/sr-doc.css" tppabs="http://kamailio.org/css/sr-doc.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.76.1" />
    <link rel="home" href="#idm15532344" title="Auth_db Module" />
    <link rel="next" href="#idp3383432" title="Chapter¬†1.¬†Admin Guide" />
  </head>
  <body>
    <div class="book" title="Auth_db Module">
      <div class="titlepage">
        <div>
          <div>
            <h1 class="title"><a id="idm15532344"></a>Auth_db Module</h1>
          </div>
          <div>
            <div class="authorgroup">
              <div class="author">
                <h3 class="author"><span class="firstname">Jan</span> <span class="surname">Janak</span></h3>
                <div class="affiliation">
                  <span class="orgname">FhG Fokus<br /></span>
                </div>
                <code class="email">&lt;<a class="email" href="mailto:jan@iptel.org">jan@iptel.org</a>&gt;</code>
              </div>
              <div class="author">
                <h3 class="author"><span class="firstname">Jakob</span> <span class="surname">Schlyter</span></h3>
                <code class="email">&lt;<a class="email" href="mailto:jakob@schlyter.se">jakob@schlyter.se</a>&gt;</code>
              </div>
              <div class="author">
                <h3 class="author"><span class="firstname">Bogdan-Andrei</span> <span class="surname">Iancu</span></h3>
                <div class="affiliation">
                  <span class="orgname">Voice Sistem SRL<br /></span>
                </div>
                <code class="email">&lt;<a class="email" href="mailto:bogdan@voice-system.ro">bogdan@voice-system.ro</a>&gt;</code>
              </div>
              <div class="author">
                <h3 class="author"><span class="firstname">Daniel-Constantin</span> <span class="surname">Mierla</span></h3>
                <code class="email">&lt;<a class="email" href="mailto:miconda@gmail.com">miconda@gmail.com</a>&gt;</code>
              </div>
              <div class="editor">
                <h4 class="editedby">Edited by</h4>
                <h3 class="editor"><span class="firstname">Jan</span> <span class="surname">Janak</span></h3>
                <code class="email">&lt;<a class="email" href="mailto:jan@iptel.org">jan@iptel.org</a>&gt;</code>
              </div>
            </div>
          </div>
          <div>
            <p class="copyright">Copyright ¬© 2002, 2003 FhG FOKUS</p>
          </div>
          <div>
            <p class="copyright">Copyright ¬© 2005 Voice Sistem SRL</p>
          </div>
        </div>
        <hr />
      </div>
      <div class="toc">
        <p>
          <strong>Table of Contents</strong>
        </p>
        <dl>
          <dt>
            <span class="chapter">
              <a href="#idp3383432">1. Admin Guide</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="#idp1925464">1. Overview</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="#idp1550736">2. Dependencies</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp3259944">2.1. Kamailio Modules</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp2448016">2.2. External Libraries or Applications</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp1869008">3. Parameters</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#auth_db.p.db_url">3.1. <code class="varname">db_url</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#auth_db.p.user_column">3.2. <code class="varname">user_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#auth_db.p.domain_column">3.3. <code class="varname">domain_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#auth_db.p.password_column">3.4. <code class="varname">password_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#auth_db.p.2password_column_2">3.5. <code class="varname">password_column_2</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#auth_db.p.calculate_ha1">3.6. <code class="varname">calculate_ha1</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#auth_db.p.use_domain">3.7. <code class="varname">use_domain</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#auth_db.p.load_credentials">3.8. <code class="varname">load_credentials</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#auth_db.p.version_table">3.9. <code class="varname">version_table</code> (integer)</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp67704">4. Functions</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#auth_db.f.www_authenticate">4.1. 
			<code class="function">www_authenticate(realm, table [, method])</code>
		</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#auth_db.f.www_authorize">4.2. 
			<code class="function">www_authorize(realm, table)</code>
		</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#auth_db.f.proxy_authenticate">4.3. 
			<code class="function">proxy_authenticate(realm, table)</code>
		</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#auth_db.f.proxy_authorize">4.4. 
			<code class="function">proxy_authorize(realm, table)</code>
		</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#auth_db.f.auth_check">4.5. 
			<code class="function">auth_check(realm, table, flags)</code>
		</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp32072">4.6. 
			<code class="function">is_subscriber(uri, dbtable, flags)</code>
		</a>
                    </span>
                  </dt>
                </dl>
              </dd>
            </dl>
          </dd>
        </dl>
      </div>
      <div class="list-of-examples">
        <p>
          <strong>List of Examples</strong>
        </p>
        <dl>
          <dt>1.1. <a href="#idp1843072"><code class="varname">db_url</code> parameter usage</a></dt>
          <dt>1.2. <a href="#idp153936"><code class="varname">user_column</code> parameter usage</a></dt>
          <dt>1.3. <a href="#idp144504"><code class="varname">domain_column</code> parameter usage</a></dt>
          <dt>1.4. <a href="#idp147232"><code class="varname">password_column</code> parameter usage</a></dt>
          <dt>1.5. <a href="#idm16800"><code class="varname">password_column_2</code> parameter usage</a></dt>
          <dt>1.6. <a href="#idm11584"><code class="varname">calculate_ha1</code> parameter usage</a></dt>
          <dt>1.7. <a href="#idm8256"><code class="varname">use_domain</code> parameter usage</a></dt>
          <dt>1.8. <a href="#idm3952"><code class="varname">load_credentials</code> parameter usage</a></dt>
          <dt>1.9. <a href="#idm1368"><code class="varname">version_table</code> parameter usage</a></dt>
          <dt>1.10. <a href="#idp78688"><code class="function">www_authorize</code> usage</a></dt>
          <dt>1.11. <a href="#idp20912">proxy_authorize usage</a></dt>
          <dt>1.12. <a href="#idp31080">auth_check usage</a></dt>
          <dt>1.13. <a href="#idp36944">is_subscriber usage</a></dt>
        </dl>
      </div>
      <div class="chapter" title="Chapter¬†1.¬†Admin Guide">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="idp3383432"></a>Chapter¬†1.¬†Admin Guide</h2>
            </div>
          </div>
        </div>
        <div class="toc">
          <p>
            <strong>Table of Contents</strong>
          </p>
          <dl>
            <dt>
              <span class="section">
                <a href="#idp1925464">1. Overview</a>
              </span>
            </dt>
            <dt>
              <span class="section">
                <a href="#idp1550736">2. Dependencies</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp3259944">2.1. Kamailio Modules</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp2448016">2.2. External Libraries or Applications</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp1869008">3. Parameters</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#auth_db.p.db_url">3.1. <code class="varname">db_url</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#auth_db.p.user_column">3.2. <code class="varname">user_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#auth_db.p.domain_column">3.3. <code class="varname">domain_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#auth_db.p.password_column">3.4. <code class="varname">password_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#auth_db.p.2password_column_2">3.5. <code class="varname">password_column_2</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#auth_db.p.calculate_ha1">3.6. <code class="varname">calculate_ha1</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#auth_db.p.use_domain">3.7. <code class="varname">use_domain</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#auth_db.p.load_credentials">3.8. <code class="varname">load_credentials</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#auth_db.p.version_table">3.9. <code class="varname">version_table</code> (integer)</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp67704">4. Functions</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#auth_db.f.www_authenticate">4.1. 
			<code class="function">www_authenticate(realm, table [, method])</code>
		</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#auth_db.f.www_authorize">4.2. 
			<code class="function">www_authorize(realm, table)</code>
		</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#auth_db.f.proxy_authenticate">4.3. 
			<code class="function">proxy_authenticate(realm, table)</code>
		</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#auth_db.f.proxy_authorize">4.4. 
			<code class="function">proxy_authorize(realm, table)</code>
		</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#auth_db.f.auth_check">4.5. 
			<code class="function">auth_check(realm, table, flags)</code>
		</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp32072">4.6. 
			<code class="function">is_subscriber(uri, dbtable, flags)</code>
		</a>
                  </span>
                </dt>
              </dl>
            </dd>
          </dl>
        </div>
        <div class="section" title="1.¬†Overview">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp1925464"></a>1.¬†Overview</h2>
              </div>
            </div>
          </div>
          <p>
		This module contains all authentication related functions that need 
		the access to the database. This module should be used together with 
		auth module, it cannot be used independently because it depends on 
		the module. Select this module if you want to use database to store 
		authentication information like subscriber usernames and passwords. If
		you want to use radius authentication, then use auth_radius instead.
	</p>
        </div>
        <div class="section" title="2.¬†Dependencies">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp1550736"></a>2.¬†Dependencies</h2>
              </div>
            </div>
          </div>
          <div class="section" title="2.1.¬†Kamailio Modules">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp3259944"></a>2.1.¬†Kamailio Modules</h3>
                </div>
              </div>
            </div>
            <p>
			The module depends on the following modules (in the other words 
			the listed modules must be loaded before this module):
			</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p><span class="emphasis"><em>auth</em></span> -- Generic authentication 
				functions
				</p>
                </li>
                <li class="listitem">
                  <p><span class="emphasis"><em>database</em></span> -- Any database module
				(currently mysql, postgres, dbtext)
				</p>
                </li>
              </ul>
            </div>
            <p>
		</p>
          </div>
          <div class="section" title="2.2.¬†External Libraries or Applications">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp2448016"></a>2.2.¬†External Libraries or Applications</h3>
                </div>
              </div>
            </div>
            <p>
			The following libraries or applications must be installed 
			before running Kamailio with this module loaded:
			</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
                    <span class="emphasis">
                      <em>none</em>
                    </span>
                  </p>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="section" title="3.¬†Parameters">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp1869008"></a>3.¬†Parameters</h2>
              </div>
            </div>
          </div>
          <div class="section" title="3.1.¬†db_url (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="auth_db.p.db_url"></a>3.1.¬†<code class="varname">db_url</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		This is URL of the database to be used. Value of the parameter depends 
		on the database module used. For example for mysql and postgres modules 
		this is something like mysql://username:password@host:port/database. 
		For dbtext module (which stores data in plaintext files) it is
		directory in which the database resides.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">‚Äú<span class="quote">mysql://kamailioro:kamailioro@localhost/kamailio</span>‚Äù</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1843072"></a>
              <p class="title">
                <strong>Example¬†1.1.¬†<code class="varname">db_url</code> parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("auth_db", "db_url", "dbdriver://username:password@dbhost/dbname")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.2.¬†user_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="auth_db.p.user_column"></a>3.2.¬†<code class="varname">user_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		This is the name of the column holding usernames. Default value is 
		fine for most people. Use the parameter if you really need to change it.
		</p>
            <p>
		Default value is <span class="quote">‚Äú<span class="quote">username</span>‚Äù</span>.
		</p>
            <div class="example">
              <a id="idp153936"></a>
              <p class="title">
                <strong>Example¬†1.2.¬†<code class="varname">user_column</code> parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("auth_db", "user_column", "user")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.3.¬†domain_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="auth_db.p.domain_column"></a>3.3.¬†<code class="varname">domain_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		This is the name of the column holding domains of users. Default value 
		is fine for most people. Use the parameter if you really need to 
		change it.
		</p>
            <p>
		Default value is <span class="quote">‚Äú<span class="quote">domain</span>‚Äù</span>.
		</p>
            <div class="example">
              <a id="idp144504"></a>
              <p class="title">
                <strong>Example¬†1.3.¬†<code class="varname">domain_column</code> parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("auth_db", "domain_column", "domain")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.4.¬†password_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="auth_db.p.password_column"></a>3.4.¬†<code class="varname">password_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		This is the name of the column holding passwords. Passwords can be 
		either stored as plain text or pre-calculated HA1 strings. HA1 strings 
		are MD5 hashes of username, password, and realm. HA1 strings are more 
		safe because the server doesn't need to know plaintext passwords and 
		they cannot be obtained from HA1 strings.
		</p>
            <p>
		Default value is <span class="quote">‚Äú<span class="quote">ha1</span>‚Äù</span>.
		</p>
            <div class="example">
              <a id="idp147232"></a>
              <p class="title">
                <strong>Example¬†1.4.¬†<code class="varname">password_column</code> parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("auth_db", "password_column", "password")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.5.¬†password_column_2 (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="auth_db.p.2password_column_2"></a>3.5.¬†<code class="varname">password_column_2</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		As described in the previous section this parameter contains name of 
		column holding pre-calculated HA1 string that were calculated including 
		the domain in the username. This parameter is used only when 
		<code class="varname">calculate_ha1</code> is set to 0 and user agent send a 
		credentials containing the domain in the username.
		</p>
            <p>
		Default value of the parameter is ha1b.
		</p>
            <div class="example">
              <a id="idm16800"></a>
              <p class="title">
                <strong>Example¬†1.5.¬†<code class="varname">password_column_2</code> parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("auth_db", "password_column_2", "ha1_2")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.6.¬†calculate_ha1 (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="auth_db.p.calculate_ha1"></a>3.6.¬†<code class="varname">calculate_ha1</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		This parameter tells the server whether it should use a pre-calculated
		HA1 string or plaintext passwords for authentification.
		</p>
            <p>
		If the parameter is set to 0 and the username parameter of credentials
		contains also <span class="quote">‚Äú<span class="quote">@domain</span>‚Äù</span> (some user agents append the
		domain to the username parameter), then the server will use the HA1
		values from the column specified in the 
		<span class="quote">‚Äú<span class="quote">password_column_2</span>‚Äù</span> parameter. If the username parameter
		doesn't contain a domain, the server will use the HA1 values from the
		column given in the <span class="quote">‚Äú<span class="quote">password_column</span>‚Äù</span>parameter.
		</p>
            <p>
		If the parameter is set to 1 then the HA1 value will be calculated
		from the column specified in the <span class="quote">‚Äú<span class="quote">password_column</span>‚Äù</span>
		parameter.
		</p>
            <p>
		The <span class="quote">‚Äú<span class="quote">password_column_2</span>‚Äù</span>column contain also HA1 strings
		but they should be calculated including the domain in the username
		parameter (as opposed to password_column which (when containing HA1
		strings) should always contains HA1 strings calculated without domain
		in username.
		</p>
            <p>
		This ensures that the authentication will always work when using
		pre-calculated HA1 strings, not depending on the presence of the
		domain in username.
		</p>
            <p>
		Default value of this parameter is 0.
		</p>
            <div class="example">
              <a id="idm11584"></a>
              <p class="title">
                <strong>Example¬†1.6.¬†<code class="varname">calculate_ha1</code> parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("auth_db", "calculate_ha1", 1)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.7.¬†use_domain (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="auth_db.p.use_domain"></a>3.7.¬†<code class="varname">use_domain</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		If true (not 0), domain will be also used when looking up in the 
		subscriber table. If you have a multi-domain setup, it is strongly
		recommended to turn on this parameter to avoid username overlapping
		between domains.
		</p>
            <p>
		IMPORTANT: before turning on this parameter, be sure that the 
		<code class="varname">domain</code> column in <code class="varname">subscriber</code> 
		table is properly populated.
		</p>
            <p>
		Default value is <span class="quote">‚Äú<span class="quote">0 (false)</span>‚Äù</span>.
		</p>
            <div class="example">
              <a id="idm8256"></a>
              <p class="title">
                <strong>Example¬†1.7.¬†<code class="varname">use_domain</code> parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("auth_db", "use_domain", 1)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.8.¬†load_credentials (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="auth_db.p.load_credentials"></a>3.8.¬†<code class="varname">load_credentials</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		This parameter specifies of credentials to be fetch from database when
		the authentication is performed. The loaded credentials will be stored
		in AVPs. If the AVP name is not specificaly given, it will be used a
		NAME AVP with the same name as the column name.
		</p>
            <p>
		 Parameter syntax:
		</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
                    <span class="emphasis">
                      <em>
			load_credentials = credential (';' credential)*
			</em>
                    </span>
                  </p>
                </li>
                <li class="listitem">
                  <p>
                    <span class="emphasis">
                      <em>
			credential = (avp_specification '=' column_name) |
							(column_name)
			</em>
                    </span>
                  </p>
                </li>
                <li class="listitem">
                  <p>
                    <span class="emphasis">
                      <em>
			avp_specification = '$avp(' + 'i:'ID | 's:'NAME | alias + ')'
			</em>
                    </span>
                  </p>
                </li>
              </ul>
            </div>
            <p>
		</p>
            <p>
		Default value of this parameter is <span class="quote">‚Äú<span class="quote">NULL</span>‚Äù</span> (no credientials
		loaded).
		</p>
            <div class="example">
              <a id="idm3952"></a>
              <p class="title">
                <strong>Example¬†1.8.¬†<code class="varname">load_credentials</code> parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
# load rpid column into $avp(i:123) and email_address column
# into $avp(s:email_address)
modparam("auth_db", "load_credentials", "$avp(i:123)=rpid;email_address")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.9.¬†version_table (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="auth_db.p.version_table"></a>3.9.¬†<code class="varname">version_table</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		If set to 0, the module will skip checking the version
		for subscriber table.
		</p>
            <p>
		Default value is <span class="quote">‚Äú<span class="quote">1 (check for table version)</span>‚Äù</span>.
		</p>
            <div class="example">
              <a id="idm1368"></a>
              <p class="title">
                <strong>Example¬†1.9.¬†<code class="varname">version_table</code> parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("auth_db", "version_table", 0)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
        <div class="section" title="4.¬†Functions">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp67704"></a>4.¬†Functions</h2>
              </div>
            </div>
          </div>
          <div class="section" title="4.1.¬† www_authenticate(realm, table [, method])">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="auth_db.f.www_authenticate"></a>4.1.¬†
			<code class="function">www_authenticate(realm, table [, method])</code>
		</h3>
                </div>
              </div>
            </div>
            <p>
			Name alias: www_authorize(realm, table)
		</p>
            <p>
		The function verifies credentials according to 
		<a class="ulink" href="javascript:if(confirm('http://www.ietf.org/rfc/rfc2617.txt  \n\n∏√Œƒº˛Œﬁ∑®”√ Teleport Ultra œ¬‘ÿ, “ÚŒ™ À¸ «“ª∏ˆ”ÚªÚ¬∑æ∂Õ‚≤ø±ª…Ë÷√Œ™À¸µƒ∆Ù ºµÿ÷∑µƒµÿ÷∑°£  \n\nƒ„œÎ‘⁄∑˛ŒÒ∆˜…œ¥Úø™À¸?'))window.location='http://www.ietf.org/rfc/rfc2617.txt'" tppabs="http://www.ietf.org/rfc/rfc2617.txt">RFC2617</a>. If the 
		credentials are verified successfully then the function will succeed 
		and mark the credentials as authorized (marked credentials can be later 
		used by some other functions). If the function was unable to verify the 
		credentials for some reason then it will fail and the script should 
		call <code class="function">www_challenge</code> which will 
		challenge the user again.
		</p>
            <p>Negative codes may be interpreted as follows:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>-1 (generic error)</em></span> - some generic error
			occurred and no reply was sent out;
			</p>
                </li>
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>-2 (invalid password)</em></span> - wrong password;
			</p>
                </li>
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>-3 (invalid user)</em></span> - authentication user does
			not exist.
			</p>
                </li>
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>-4 (nonce expired)</em></span> - the nonce has expired
			</p>
                </li>
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>-5 (no credentials)</em></span> - request does not contain
			an Authorization header with the correct realm.
			</p>
                </li>
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>-6 (nonce reused)</em></span> - the nonce has already been
			used to authenticate a previous request
			</p>
                </li>
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>-8 (authuser mismatch)</em></span> - depending on the method, th
			From/To/RURI user does not match the authentication user (see auth_check() function).
			</p>
                </li>
              </ul>
            </div>
            <p>Meaning of the parameters is as follows:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p><span class="emphasis"><em>realm</em></span> - Realm is a opaque string that 
			the user agent should present to the user so he can decide what 
			username and password to use. Usually this is domain of the host 
			the server is running on.
			</p>
                  <p>
			It must not be empty string <span class="quote">‚Äú<span class="quote"></span>‚Äù</span>. In case of REGISTER
			requests To header field domain (e.g., variable $td) can be used
			(because this header field represents the user being registered),
			for all other messages From header field domain can be used
			(e.g., variable $fd).
			</p>
                  <p>
			The string may contain pseudo variables.
			</p>
                </li>
                <li class="listitem">
                  <p><span class="emphasis"><em>table</em></span> - Table to be used to lookup 
			usernames and passwords (usually subscribers table).
			</p>
                </li>
                <li class="listitem">
                  <p><span class="emphasis"><em>method</em></span> - the method to be used for
			authentication. This parameter is optional and if not set
			is the first "word" on the request-line.</p>
                </li>
              </ul>
            </div>
            <p>
		This function can be used from REQUEST_ROUTE.
		</p>
            <div class="example">
              <a id="idp78688"></a>
              <p class="title">
                <strong>Example¬†1.10.¬†<code class="function">www_authorize</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
if (!www_authorize("kamailio.org", "subscriber")) {
	www_challenge("kamailio.org", "1");
};
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.2.¬† www_authorize(realm, table)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="auth_db.f.www_authorize"></a>4.2.¬†
			<code class="function">www_authorize(realm, table)</code>
		</h3>
                </div>
              </div>
            </div>
            <p>
			It is same function as www_authenticate(realm, table). This name
			is kept for backward compatibility, since it was named this way
			first time by it actually does user authentication.
		</p>
          </div>
          <div class="section" title="4.3.¬† proxy_authenticate(realm, table)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="auth_db.f.proxy_authenticate"></a>4.3.¬†
			<code class="function">proxy_authenticate(realm, table)</code>
		</h3>
                </div>
              </div>
            </div>
            <p>
			Name alias: proxy_authorize(realm, table)
		</p>
            <p>
		The function verifies credentials according to 
		<a class="ulink" href="javascript:if(confirm('http://www.ietf.org/rfc/rfc2617.txt  \n\n∏√Œƒº˛Œﬁ∑®”√ Teleport Ultra œ¬‘ÿ, “ÚŒ™ À¸ «“ª∏ˆ”ÚªÚ¬∑æ∂Õ‚≤ø±ª…Ë÷√Œ™À¸µƒ∆Ù ºµÿ÷∑µƒµÿ÷∑°£  \n\nƒ„œÎ‘⁄∑˛ŒÒ∆˜…œ¥Úø™À¸?'))window.location='http://www.ietf.org/rfc/rfc2617.txt'" tppabs="http://www.ietf.org/rfc/rfc2617.txt">RFC2617</a>. If 
		the credentials are verified successfully then the function will 
		succeed and mark the credentials as authorized (marked credentials can 
		be later used by some other functions). If the function was unable to 
		verify the credentials for some reason then it will fail and
		the script should call 
		<code class="function">proxy_challenge</code> which will
		challenge the user again. 
		</p>
            <p>Negative return codes have the same meaning as for
			www_authenticate().</p>
            <p>Meaning of the parameters is as follows:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p><span class="emphasis"><em>realm</em></span> - Realm is a opaque string that 
			the user agent should present to the user so he can decide what 
			username and password to use. Usually this is domain of the host 
			the server is running on.
			</p>
                  <p>
			It must not be empty string <span class="quote">‚Äú<span class="quote"></span>‚Äù</span>. Apart of a static
			string, typical value is From header field domain
			(e.g., variable $fd).
			</p>
                  <p>
			If an empty string <span class="quote">‚Äú<span class="quote"></span>‚Äù</span> is used then the server will 
			generate it from the request. From header field domain will be 
			used as realm.
			</p>
                  <p>
			The string may contain pseudo variables.
			</p>
                </li>
                <li class="listitem">
                  <p><span class="emphasis"><em>table</em></span> - Table to be used to lookup 
			usernames and passwords (usually subscribers table).
			</p>
                </li>
              </ul>
            </div>
            <p>
		This function can be used from REQUEST_ROUTE.
		</p>
            <div class="example">
              <a id="idp20912"></a>
              <p class="title">
                <strong>Example¬†1.11.¬†proxy_authorize usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
if (!proxy_authorize("$fd", "subscriber)) {
	proxy_challenge("$fd", "1");  # Realm will be autogenerated
};
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.4.¬† proxy_authorize(realm, table)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="auth_db.f.proxy_authorize"></a>4.4.¬†
			<code class="function">proxy_authorize(realm, table)</code>
		</h3>
                </div>
              </div>
            </div>
            <p>
			It is same function as proxy_authenticate(realm, table). This name
			is kept for backward compatibility, since it was named this way
			first time but it actually does user authentication.
		</p>
          </div>
          <div class="section" title="4.5.¬† auth_check(realm, table, flags)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="auth_db.f.auth_check"></a>4.5.¬†
			<code class="function">auth_check(realm, table, flags)</code>
		</h3>
                </div>
              </div>
            </div>
            <p>The function combines the functionalities of
		<code class="function">www_authenticate</code> and
		<code class="function">proxy_authenticate</code>, first being
		exectuted if the SIP request is a REGISTER, the second for the rest.
		</p>
            <p>
		In addition, a matter of <span class="emphasis"><em>flags</em></span> parameter value,
		the function checks if authentication username matches From/To header
		username, and Request-URI in case of PUBLISH.
		</p>
            <p>Negative return codes have the same meaning as for
			www_authenticate().</p>
            <p>Meaning of the parameters is as follows:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p><span class="emphasis"><em>realm</em></span> - Realm is a opaque string that
			the user agent should present to the user so he can decide what
			username and password to use. Usually this is domain of the host
			the server is running on.
			</p>
                  <p>
			It must not be empty string <span class="quote">‚Äú<span class="quote"></span>‚Äù</span>. Apart of a static
			string, typical value is From header field domain
			(e.g., variable $fd).
			</p>
                  <p>
			The string may contain pseudo variables.
			</p>
                </li>
                <li class="listitem">
                  <p><span class="emphasis"><em>table</em></span> - Table to be used to lookup
			usernames and passwords (usually subscribers table).
			</p>
                  <p>
			The string may contain pseudo variables.
			</p>
                </li>
                <li class="listitem">
                  <p><span class="emphasis"><em>flags</em></span> - set of flags to control the
			behaviour of the function. If it is 1, then the function will
			check to see if the authentication username matches either To or
			From header username. REGISTER requests: From and To must match the 
			authentication user. PUBLISH requests: From, To and Request-URI must
			match the authentication user. All other requests: From header must
			match the authentication user. If bit 2 is set as well (flags==3),
			the ID check is skipped for INVITE, BYE, PRACK, UPDATE, MESSAGE
			- these requests can come with anonymoys caller id.
			</p>
                  <p>
			Additionally all domains in the checked URIs and the realm in the 
			authentication header will be checked to match the provided realm parameter.
			</p>
                  <p>
			The string may contain pseudo variables.
			</p>
                </li>
              </ul>
            </div>
            <p>
		This function can be used from REQUEST_ROUTE.
		</p>
            <div class="example">
              <a id="idp31080"></a>
              <p class="title">
                <strong>Example¬†1.12.¬†auth_check usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
if (!auth_check("$fd", "subscriber", "1")) {
    auth_challenge("$fd", "1");
    exit;
}
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.6.¬† is_subscriber(uri, dbtable, flags)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp32072"></a>4.6.¬†
			<code class="function">is_subscriber(uri, dbtable, flags)</code>
		</h3>
                </div>
              </div>
            </div>
            <p>The function checks if there is a subscriber corresponding to
		the AoR in uri parameter. It uses same database connection as for
		authentication functions.
		</p>
            <p>
		In addition, if the subscriber record is found, then the load_credentials
		attributes are loaded. An use case can be loading the credential attributes
		for callee.
		</p>
            <p>Meaning of the parameters is as follows:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p><span class="emphasis"><em>uri</em></span> - a valid SIP URI value to identify
			the subscriber. The string may contain pseudo variables.
			</p>
                </li>
                <li class="listitem">
                  <p><span class="emphasis"><em>dbtable</em></span> - Table to be used to lookup
			username and domain from URI (usually subscriber table). The string
			may contain pseudo variables.
			</p>
                </li>
                <li class="listitem">
                  <p><span class="emphasis"><em>flags</em></span> - set of flags to control the
			behaviour of the function. If 1st bit is set, then the function will
			use the domain part of the URI to perform the database table search.
			If 2nd bit is set, then the credentials are not loaded in variables
			(a simple check if subscriber exists).
			</p>
                  <p>
			The parameter may be a pseudo variable.
			</p>
                </li>
              </ul>
            </div>
            <p>
		This function can be used from ANY_ROUTE.
		</p>
            <div class="example">
              <a id="idp36944"></a>
              <p class="title">
                <strong>Example¬†1.13.¬†is_subscriber usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
if (!is_subscriber("$ru", "subscriber", "3")) {
    # callee is not a local subscriber
    ...
}
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
