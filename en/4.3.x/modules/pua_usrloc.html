<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>PUA Usrloc</title>
    <link rel="stylesheet" type="text/css" href="../../../../css/sr-doc.css" tppabs="http://kamailio.org/css/sr-doc.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.76.1" />
    <link rel="home" href="#idp11381048" title="PUA Usrloc" />
    <link rel="next" href="#idp18779136" title="Chapter 1. Admin Guide" />
  </head>
  <body>
    <div class="book" title="PUA Usrloc">
      <div class="titlepage">
        <div>
          <div>
            <h1 class="title"><a id="idp11381048"></a>PUA Usrloc</h1>
          </div>
          <div>
            <div class="authorgroup">
              <div class="author">
                <h3 class="author"><span class="firstname">Anca-Maria</span> <span class="surname">Vamanu</span></h3>
                <div class="affiliation">
                  <span class="orgname">Voice Sistem SRL<br /></span>
                </div>
              </div>
              <div class="editor">
                <h4 class="editedby">Edited by</h4>
                <h3 class="editor"><span class="firstname">Anca-Maria</span> <span class="surname">Vamanu</span></h3>
              </div>
            </div>
          </div>
          <div>
            <p class="copyright">Copyright © 2006 Voice Sistem SRL</p>
          </div>
        </div>
        <hr />
      </div>
      <div class="toc">
        <p>
          <strong>Table of Contents</strong>
        </p>
        <dl>
          <dt>
            <span class="chapter">
              <a href="#idp18779136">1. Admin Guide</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="#idp19172256">1. Overview</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="#idp18308576">2. Dependencies</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp18042120">2.1. Kamailio Modules</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp19247192">2.2. External Libraries or Applications</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp18273568">3. Parameters</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp18452440">3.1. <code class="varname">default_domain</code> (str)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp18595088">3.2. <code class="varname">entity_prefix</code> (str)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp17879176">3.3. <code class="varname">branch_flag</code> (int)</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp17820048">4. Functions</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp18417960">4.1. 
				<code class="function">pua_set_publish()</code>
				</a>
                    </span>
                  </dt>
                </dl>
              </dd>
            </dl>
          </dd>
        </dl>
      </div>
      <div class="list-of-examples">
        <p>
          <strong>List of Examples</strong>
        </p>
        <dl>
          <dt>1.1. <a href="#idp19218104">Set <code class="varname">default_domain</code> parameter</a></dt>
          <dt>1.2. <a href="#idp18424840">Set <code class="varname">presentity_prefix</code> parameter</a></dt>
          <dt>1.3. <a href="#idp18102888">Set <code class="varname">branch_flag</code> parameter</a></dt>
          <dt>1.4. <a href="#idp17204256"><code class="function">pua_set_publish</code> usage</a></dt>
        </dl>
      </div>
      <div class="chapter" title="Chapter 1. Admin Guide">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="idp18779136"></a>Chapter 1. Admin Guide</h2>
            </div>
          </div>
        </div>
        <div class="toc">
          <p>
            <strong>Table of Contents</strong>
          </p>
          <dl>
            <dt>
              <span class="section">
                <a href="#idp19172256">1. Overview</a>
              </span>
            </dt>
            <dt>
              <span class="section">
                <a href="#idp18308576">2. Dependencies</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp18042120">2.1. Kamailio Modules</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp19247192">2.2. External Libraries or Applications</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp18273568">3. Parameters</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp18452440">3.1. <code class="varname">default_domain</code> (str)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp18595088">3.2. <code class="varname">entity_prefix</code> (str)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp17879176">3.3. <code class="varname">branch_flag</code> (int)</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp17820048">4. Functions</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp18417960">4.1. 
				<code class="function">pua_set_publish()</code>
				</a>
                  </span>
                </dt>
              </dl>
            </dd>
          </dl>
        </div>
        <div class="section" title="1. Overview">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp19172256"></a>1. Overview</h2>
              </div>
            </div>
          </div>
          <p>
		 The pua_usrloc module is the connector between the usrloc and pua modules.
		 With this module, you can monitor the status of SIP registrations.
		 The module sends PUBLISH requests for user location record changes, 
		 based on specific events (e.g., when a new record is
		 added in usrloc, a PUBLISH with status open (online) is issued;
		 when expires, it sends closed (offline)).
	</p>
          <p>
		Using this module phones which have no support for presence can
		be seen as online/offline. 
	</p>
        </div>
        <div class="section" title="2. Dependencies">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp18308576"></a>2. Dependencies</h2>
              </div>
            </div>
          </div>
          <div class="section" title="2.1. Kamailio Modules">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp18042120"></a>2.1. Kamailio Modules</h3>
                </div>
              </div>
            </div>
            <p>
		The following modules must be loaded before this module:
			</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
				<span class="emphasis"><em>usrloc</em></span>.
			</p>
                </li>
                <li class="listitem">
                  <p>
				<span class="emphasis"><em>pua</em></span>.
			</p>
                </li>
              </ul>
            </div>
            <p>
		</p>
          </div>
          <div class="section" title="2.2. External Libraries or Applications">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp19247192"></a>2.2. External Libraries or Applications</h3>
                </div>
              </div>
            </div>
            <p>
		The following libraries or applications must be installed before running
		Kamailio with this module loaded:
			</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
				<span class="emphasis"><em>libxml</em></span>.
			</p>
                </li>
              </ul>
            </div>
            <p>
		</p>
          </div>
        </div>
        <div class="section" title="3. Parameters">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp18273568"></a>3. Parameters</h2>
              </div>
            </div>
          </div>
          <div class="section" title="3.1. default_domain (str)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp18452440"></a>3.1. <code class="varname">default_domain</code> (str)</h3>
                </div>
              </div>
            </div>
            <p>
		The default domain to use when constructing the presentity
		URI if it is missing from stored AOR in the usrloc table (in
		memory or database). 
		</p>
            <p>
		<span class="emphasis"><em>Default value is <span class="quote">“<span class="quote">NULL</span>”</span>.	
		</em></span>
		</p>
            <div class="example">
              <a id="idp19218104"></a>
              <p class="title">
                <strong>Example 1.1. Set <code class="varname">default_domain</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("pua_usrloc", "default_domain", "kamailio.org")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.2. entity_prefix (str)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp18595088"></a>3.2. <code class="varname">entity_prefix</code> (str)</h3>
                </div>
              </div>
            </div>
            <p>
		The prefix used when constructing the entity attribute to be added to
		a presence node in the XML PIDF document.
		(ex: pres:user@domain ).
		</p>
            <p>
		<span class="emphasis"><em>Default value is <span class="quote">“<span class="quote">NULL</span>”</span>.	
		</em></span>
		</p>
            <div class="example">
              <a id="idp18424840"></a>
              <p class="title">
                <strong>Example 1.2. Set <code class="varname">presentity_prefix</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("pua_usrloc", "entity_prefix", "pres")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.3. branch_flag (int)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp17879176"></a>3.3. <code class="varname">branch_flag</code> (int)</h3>
                </div>
              </div>
            </div>
            <p>
		Which branch flag to be used to select the contact addresses for which
		to generate PUBLISH. Valid values are 0 to 31.
		</p>
            <p>
		<span class="emphasis"><em>Default value is <span class="quote">“<span class="quote">-1</span>”</span> (disabled).	
		</em></span>
		</p>
            <div class="example">
              <a id="idp18102888"></a>
              <p class="title">
                <strong>Example 1.3. Set <code class="varname">branch_flag</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("pua_usrloc", "branch_flag", 9)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
        <div class="section" title="4. Functions">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp17820048"></a>4. Functions</h2>
              </div>
            </div>
          </div>
          <div class="section" title="4.1.  pua_set_publish()">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp18417960"></a>4.1. 
				<code class="function">pua_set_publish()</code>
				</h3>
                </div>
              </div>
            </div>
            <p>
				The function is used to mark REGISTER requests that have to
				issue a PUBLISH. The PUBLISH is issued when REGISTER is saved
				in location table.
			</p>
            <p>
			</p>
            <div class="example">
              <a id="idp17204256"></a>
              <p class="title">
                <strong>Example 1.4. <code class="function">pua_set_publish</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
if(is_method("REGISTER") &amp;&amp; from_uri=~"john@kamailio.org") 
	pua_set_publish();		
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
