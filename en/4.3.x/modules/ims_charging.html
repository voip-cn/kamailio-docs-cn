<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>The IMS Charging Module</title>
    <link rel="stylesheet" type="text/css" href="../../../../css/sr-doc.css" tppabs="http://kamailio.org/css/sr-doc.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.76.1" />
    <link rel="home" href="#idm15456120" title="The IMS Charging Module" />
    <link rel="next" href="#idp1637944" title="Chapter 1. Admin Guide" />
  </head>
  <body>
    <div class="book" title="The IMS Charging Module">
      <div class="titlepage">
        <div>
          <div>
            <h1 class="title"><a id="idm15456120"></a>The IMS Charging Module</h1>
          </div>
          <div>
            <div class="authorgroup">
              <div class="author">
                <h3 class="author"><span class="firstname">Jason</span> <span class="surname">Penton</span></h3>
                <div class="affiliation">
                  <span class="orgname">Smile Communications<br /></span>
                </div>
                <code class="email">&lt;<a class="email" href="mailto:jason.penton@smilecoms.com">jason.penton@smilecoms.com</a>&gt;</code>
              </div>
              <div class="author">
                <h3 class="author"><span class="firstname">Carsten</span> <span class="surname">Bock</span></h3>
                <div class="affiliation">
                  <span class="orgname">ng-voice GmbH<br /></span>
                </div>
                <code class="email">&lt;<a class="email" href="mailto:carsten@ng-voice.com">carsten@ng-voice.com</a>&gt;</code>
              </div>
              <div class="author">
                <h3 class="author"><span class="firstname">Carlos</span> <span class="surname">Ruiz Diaz</span></h3>
                <div class="affiliation">
                  <span class="orgname">ng-voice GmbH<br /></span>
                </div>
                <code class="email">&lt;<a class="email" href="mailto:carlos@ng-voice.com">carlos@ng-voice.com</a>&gt;</code>
              </div>
            </div>
          </div>
          <div>
            <p class="copyright">Copyright © 2013 Smile Communications</p>
          </div>
          <div>
            <p class="copyright">Copyright © 2013 ng-voice GmbH</p>
          </div>
        </div>
        <hr />
      </div>
      <div class="toc">
        <p>
          <strong>Table of Contents</strong>
        </p>
        <dl>
          <dt>
            <span class="chapter">
              <a href="#idp1637944">1. Admin Guide</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="#idp3468736">1. Overview</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="#idp1693096">2. Dependencies</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp2265984">2.1. Kamailio Modules</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp2713688">2.2. External Libraries or Applications</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp2490576">3. Understanding Charging in the IP-Multimedia-Subsystem (IMS)</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp2675528">3.1. Offline Charging (Rf)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idm14824">3.2. Online Charging (Ro)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idm9944">3.3. Online Charging (Ro): A practical example</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idm4776">4. Parameters</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idm4408">4.1. <code class="varname">hash_size</code>(int)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idm1608">4.2. <code class="varname">interim_update_credits</code>(int)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp72696">4.3. <code class="varname">timer_buffer</code>(int)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp74920">4.4. <code class="varname">ro_forced_peer</code>(string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp77320">4.5. <code class="varname">ro_auth_expiry</code>(integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp79520">4.6. <code class="varname">ro_auth_expiry</code>(integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp81720">4.7. <code class="varname">cdp_event_latency</code>(integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp83992">4.8. <code class="varname">cdp_event_threshold</code>(integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp86360">4.9. <code class="varname">cdp_event_latency_log</code>(integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp88656">4.10. <code class="varname">single_ro_session_per_dialog</code>(integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp20504">4.11. <code class="varname">origin_host</code>(string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp22752">4.12. <code class="varname">origin_realm</code>(string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp24960">4.13. <code class="varname">destination_host</code>(string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp27176">4.14. <code class="varname">destination_realm</code>(string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp29384">4.15. <code class="varname">service_context_id_root</code>(string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp34208">4.16. <code class="varname">service_context_id_ext</code>(string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp36368">4.17. <code class="varname">service_context_id_mnc</code>(string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp38528">4.18. <code class="varname">voice_service_identifier</code>(string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp40656">4.19. <code class="varname">voice_rating_group</code>(string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp42824">4.20. <code class="varname">video_service_identifier</code>(string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1847144">4.21. <code class="varname">video_rating_group</code>(string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1849312">4.22. <code class="varname">service_context_id_mcc</code>(string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1851768">4.23. <code class="varname">service_context_id_release</code>(string)</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp1854040">5. Functions</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp1854408">5.1. <code class="function">Ro_CCR(route_name, direction,
      reservation_units, domain, incoming_trunk_id, outgoing_trunk_id</code>
      </a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp1861992">6. Statistics</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp1862360">6.1. Initial CCRs (initial_ccrs)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1863096">6.2. Interim CCRs (interim_ccrs)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1863800">6.3. Final CCRs (final_ccrs)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1864496">6.4. Sucessful initial CCRs (successful_initial_ccrs)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1865264">6.5. Sucessful interim CCRs (successful_interim_ccrs)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1866032">6.6. Sucessful final CCRs (successful_final_ccrs)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1866792">6.7. Failed initial CCRs (failed_initial_ccrs)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1867544">6.8. Failed interim CCRs (failed_interim_ccrs)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1868296">6.9. Failed final CCRs (failed_final_ccrs)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1869048">6.10. CCRs average response time (ccr_avg_response_time)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1869744">6.11. CCRs responses time (ccr_responses_time)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1870384">6.12. CCRs requests, which ended with a timeout (ccr_timeouts)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1871144">6.13. Billed seconds (billed_secs)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1871864">6.14. Killed calls (killed_calls)</a>
                    </span>
                  </dt>
                </dl>
              </dd>
            </dl>
          </dd>
        </dl>
      </div>
      <div class="list-of-examples">
        <p>
          <strong>List of Examples</strong>
        </p>
        <dl>
          <dt>1.1. <a href="#idm2712"><code class="varname">hash_size</code>parameter usage</a></dt>
          <dt>1.2. <a href="#idp71680"><code class="varname">interim_update_credits</code>parameter
        usage</a></dt>
          <dt>1.3. <a href="#idp73808"><code class="varname">timer_buffer</code>parameter usage</a></dt>
          <dt>1.4. <a href="#idp76184"><code class="varname">ro_forced_peer</code>parameter usage</a></dt>
          <dt>1.5. <a href="#idp78408"><code class="varname">ro_auth_expiry</code>parameter usage</a></dt>
          <dt>1.6. <a href="#idp80608"><code class="varname">ro_auth_expiry</code>parameter usage</a></dt>
          <dt>1.7. <a href="#idp82880"><code class="varname">cdp_event_latency</code>parameter usage</a></dt>
          <dt>1.8. <a href="#idp85240"><code class="varname">cdp_event_threshold</code>parameter usage</a></dt>
          <dt>1.9. <a href="#idp87560"><code class="varname">cdp_event_latency_log</code>parameter usage</a></dt>
          <dt>1.10. <a href="#idp90048"><code class="varname">single_ro_session_per_dialog</code>parameter
        usage</a></dt>
          <dt>1.11. <a href="#idp21632"><code class="varname">origin_host</code>parameter usage</a></dt>
          <dt>1.12. <a href="#idp23832"><code class="varname">origin_realm</code>parameter usage</a></dt>
          <dt>1.13. <a href="#idp26040"><code class="varname">destination_host</code>parameter usage</a></dt>
          <dt>1.14. <a href="#idp28256"><code class="varname">destination_realm</code>parameter usage</a></dt>
          <dt>1.15. <a href="#idp33112"><code class="varname">service_context_id_root</code>parameter
        usage</a></dt>
          <dt>1.16. <a href="#idp35288"><code class="varname">service_context_id_ext</code>parameter
        usage</a></dt>
          <dt>1.17. <a href="#idp37456"><code class="varname">service_context_id_mnc</code>parameter
        usage</a></dt>
          <dt>1.18. <a href="#idp39576"><code class="varname">voice_service_identifier</code>parameter
        usage</a></dt>
          <dt>1.19. <a href="#idp41728"><code class="varname">voice_rating_group</code>parameter
        usage</a></dt>
          <dt>1.20. <a href="#idp1846064"><code class="varname">video_service_identifier</code>parameter
        usage</a></dt>
          <dt>1.21. <a href="#idp1848216"><code class="varname">video_rating_group</code>parameter
        usage</a></dt>
          <dt>1.22. <a href="#idp1850696"><code class="varname">service_context_id_mcc</code>parameter
        usage</a></dt>
          <dt>1.23. <a href="#idp1852880"><code class="varname">service_context_id_release</code>parameter
        usage</a></dt>
          <dt>1.24. <a href="#idp1860192">Ro_CCR</a></dt>
        </dl>
      </div>
      <div class="chapter" title="Chapter 1. Admin Guide">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="idp1637944"></a>Chapter 1. Admin Guide</h2>
            </div>
          </div>
        </div>
        <div class="toc">
          <p>
            <strong>Table of Contents</strong>
          </p>
          <dl>
            <dt>
              <span class="section">
                <a href="#idp3468736">1. Overview</a>
              </span>
            </dt>
            <dt>
              <span class="section">
                <a href="#idp1693096">2. Dependencies</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp2265984">2.1. Kamailio Modules</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp2713688">2.2. External Libraries or Applications</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp2490576">3. Understanding Charging in the IP-Multimedia-Subsystem (IMS)</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp2675528">3.1. Offline Charging (Rf)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idm14824">3.2. Online Charging (Ro)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idm9944">3.3. Online Charging (Ro): A practical example</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idm4776">4. Parameters</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idm4408">4.1. <code class="varname">hash_size</code>(int)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idm1608">4.2. <code class="varname">interim_update_credits</code>(int)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp72696">4.3. <code class="varname">timer_buffer</code>(int)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp74920">4.4. <code class="varname">ro_forced_peer</code>(string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp77320">4.5. <code class="varname">ro_auth_expiry</code>(integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp79520">4.6. <code class="varname">ro_auth_expiry</code>(integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp81720">4.7. <code class="varname">cdp_event_latency</code>(integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp83992">4.8. <code class="varname">cdp_event_threshold</code>(integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp86360">4.9. <code class="varname">cdp_event_latency_log</code>(integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp88656">4.10. <code class="varname">single_ro_session_per_dialog</code>(integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp20504">4.11. <code class="varname">origin_host</code>(string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp22752">4.12. <code class="varname">origin_realm</code>(string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp24960">4.13. <code class="varname">destination_host</code>(string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp27176">4.14. <code class="varname">destination_realm</code>(string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp29384">4.15. <code class="varname">service_context_id_root</code>(string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp34208">4.16. <code class="varname">service_context_id_ext</code>(string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp36368">4.17. <code class="varname">service_context_id_mnc</code>(string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp38528">4.18. <code class="varname">voice_service_identifier</code>(string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp40656">4.19. <code class="varname">voice_rating_group</code>(string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp42824">4.20. <code class="varname">video_service_identifier</code>(string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1847144">4.21. <code class="varname">video_rating_group</code>(string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1849312">4.22. <code class="varname">service_context_id_mcc</code>(string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1851768">4.23. <code class="varname">service_context_id_release</code>(string)</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp1854040">5. Functions</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp1854408">5.1. <code class="function">Ro_CCR(route_name, direction,
      reservation_units, domain, incoming_trunk_id, outgoing_trunk_id</code>
      </a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp1861992">6. Statistics</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp1862360">6.1. Initial CCRs (initial_ccrs)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1863096">6.2. Interim CCRs (interim_ccrs)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1863800">6.3. Final CCRs (final_ccrs)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1864496">6.4. Sucessful initial CCRs (successful_initial_ccrs)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1865264">6.5. Sucessful interim CCRs (successful_interim_ccrs)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1866032">6.6. Sucessful final CCRs (successful_final_ccrs)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1866792">6.7. Failed initial CCRs (failed_initial_ccrs)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1867544">6.8. Failed interim CCRs (failed_interim_ccrs)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1868296">6.9. Failed final CCRs (failed_final_ccrs)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1869048">6.10. CCRs average response time (ccr_avg_response_time)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1869744">6.11. CCRs responses time (ccr_responses_time)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1870384">6.12. CCRs requests, which ended with a timeout (ccr_timeouts)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1871144">6.13. Billed seconds (billed_secs)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1871864">6.14. Killed calls (killed_calls)</a>
                  </span>
                </dt>
              </dl>
            </dd>
          </dl>
        </div>
        <div class="section" title="1. Overview">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp3468736"></a>1. Overview</h2>
              </div>
            </div>
          </div>
          <p>This module contains all methods related to the IMS charging control
    functions performed by an network element (e.g. a S-CSCF) over the Ro
    interface. This module is dependent on the CDP (C Diameter Peer) modules
    for communicating with a Charging-Server as specified in 3GPP
    specification TS xx.xxx.</p>
          <p>Please also refer to RFC 4006 (Diameter Credit-Control
    Application)</p>
        </div>
        <div class="section" title="2. Dependencies">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp1693096"></a>2. Dependencies</h2>
              </div>
            </div>
          </div>
          <div class="section" title="2.1. Kamailio Modules">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp2265984"></a>2.1. Kamailio Modules</h3>
                </div>
              </div>
            </div>
            <p>The Following mouldes must be loaded before this module:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>Dialog_ng</p>
                </li>
                <li class="listitem">
                  <p>TM - Transaction Manager</p>
                </li>
                <li class="listitem">
                  <p>CDP - C Diameter Peer</p>
                </li>
                <li class="listitem">
                  <p>CDP_AVP - CDP AVP Applications</p>
                </li>
              </ul>
            </div>
          </div>
          <div class="section" title="2.2. External Libraries or Applications">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp2713688"></a>2.2. External Libraries or Applications</h3>
                </div>
              </div>
            </div>
            <p>This modules requires the internal IMS library.</p>
          </div>
        </div>
        <div class="section" title="3. Understanding Charging in the IP-Multimedia-Subsystem (IMS)">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp2490576"></a>3. Understanding Charging in the IP-Multimedia-Subsystem (IMS)</h2>
              </div>
            </div>
          </div>
          <p>Before each service usage, the charging system must be asked for
    permission (credit authorization). The charging server must make a
    decision: Either authorize or deny the session. For postpaid scenarios
    this is fairly easy: The charging-server only needs to collect the usage
    data for processing it at the end of the month. As no realtime account
    updating is needed, this is often called "offline-charging". For prepaid
    scenarios the charging server needs to know the user's account balance and
    it will need to update the account in real-time. This is often referred to
    as "online-charging".</p>
          <p>Question: What is the double of the Radius? Answer: It's the
    Diameter!</p>
          <p>As quite often, we use the Diameter-Protocol to do the Charging in
    the IMS. And as quite often, IMS uses a huge bunch of acronyms to describe
    the different interfaces: We call the diameter-interface for
    offline-charging the "Rf"-interface and the interface for online charging
    the "Ro"-interface.</p>
          <p>Each system, that needs this credit authorization, have to be
    equipped with a proper charging trigger, a so-called
    charging-trigger-function (CTF) in order to communicate with the
    charging-server (also called charging-function):</p>
          <div class="mediaobject">
            <img src="images/charging1.png" tppabs="http://kamailio.org/docs/modules/4.3.x/modules/images/charging1.png" />
          </div>
          <div class="section" title="3.1. Offline Charging (Rf)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp2675528"></a>3.1. Offline Charging (Rf)</h3>
                </div>
              </div>
            </div>
            <p>For the offlinc charging (Rf), we have the following two
      diameter-messages:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>ACR - Accounting Request</p>
                </li>
                <li class="listitem">
                  <p>ACA - Accounting Answer</p>
                </li>
              </ul>
            </div>
            <p>Each request can have the following Accounting-Record-Type:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>START_RECORD - used to start an accounting session, typically
          when the application receives a SIP 200 OK acknowledging an initial
          SIP INVITE.</p>
                </li>
                <li class="listitem">
                  <p>INTERIM_RECORD - used to update a session, for example, in the
          case of SIP RE-INVITE and/or UPDATE in the current SIP
          dialog.</p>
                </li>
                <li class="listitem">
                  <p>STOP_RECORD - used to stop an accounting session, for example,
          when the application receives a SIP BYE message.</p>
                </li>
                <li class="listitem">
                  <p>EVENT_RECORD - used for event-based accounting, e.g. a short
          message or similar</p>
                </li>
              </ul>
            </div>
          </div>
          <div class="section" title="3.2. Online Charging (Ro)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idm14824"></a>3.2. Online Charging (Ro)</h3>
                </div>
              </div>
            </div>
            <p>For online charging (Ro), this get's a little bit more
      complicated. The charging function needs to perform credit control
      before allowing resource usage. The prepaid subscriber needs to exist in
      the charging-server and all activities must be monitored by the
      charging-server. We must distinguish between the following two
      cases:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>Direct debiting - the amount is immediately deducted from the
          user's account in one single transaction. This could be for example
          a SMS or the ordering of a movie in case of Video-on-Demand.</p>
                </li>
                <li class="listitem">
                  <p>Unit reservation - an amount is reserved by the
          charging-server. This is done, because the charging-server does not
          know yet, how many units are needed to provide the service. During
          the session, the used amount may be deducted and more units can be
          requested; at the end of the session the used sessions are reported
          in the final request. These sessions could be typically a voice- or
          video-call or a Pay-TV session, if you pay per usage.</p>
                </li>
              </ul>
            </div>
            <p>As a result, we have the following three scenarios:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>Immediate Event Charging (IEC) - used for simple Event-based
          charging</p>
                </li>
                <li class="listitem">
                  <p>Event Charging with Unit Reservation (ECUR) (of type
          Event-based charging)</p>
                </li>
                <li class="listitem">
                  <p>Session Charging with Unit Reservation (SCUR) (of type
          Session-based charging)</p>
                </li>
              </ul>
            </div>
          </div>
          <div class="section" title="3.3. Online Charging (Ro): A practical example">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idm9944"></a>3.3. Online Charging (Ro): A practical example</h3>
                </div>
              </div>
            </div>
            <p>But how does it look in reality? Let us make a more practical
      example:</p>
            <p>Let us assume we have a subscriber, who has sufficient credit for
      75 seconds of talking. The subscriber initiates a call; as we do not
      know, how long the call will take, we start with requesting credit for
      30 seconds (CCR-Request, we could request any duration, e.g. 2 hours,
      but it would probably block other calls if we reserve all the required
      credit).</p>
            <p>The call proceeds, so after 30 seconds we send another CCR-Request
      with the indication that we used the reserved 30 seconds and that we
      request another 30 seconds. We reduce the account of the subscriber by
      30 seconds, so he has a credit of 45 seconds. Since 45 seconds is more
      than the requested 30 seconds, this second request can also easily be
      accepted and another 30 seconds can be granted. After this request, the
      account is at 45 seconds and we still (or again) have 30 seconds
      reserved.</p>
            <p>Meanwhile the subscriber initiates a second call. We try to
      request again 30 seconds from the charging-server, but as our account is
      at 45 seconds of speaking time and since we reserved another 30 seconds
      for the first call, we can only grant 15 seconds for the second call.
      The last 15 seconds are now reserved for this subscriber; we have 45
      seconds on the account of which 45 seconds are reserved.</p>
            <p>Now the first call gets terminated: We only used 20 seconds from
      the granted 30 seconds. So we decrease the account of the subscriber by
      20 seconds and we reduce the amount of reserved units by 30. We have 25
      seconds in the account and we have still reserved 15 seconds for the
      second call.</p>
            <p>As the second call is still proceeding, we will try to request
      another 30 seconds and we indicate, that we used the granted 15 seconds.
      The account is deducted by 15 seconds (the used units) and we can grant
      another 10 seconds for the second call, as this is the remains on the
      account.</p>
            <p>After 10 seconds, no more units can be granted, so the call is
      teared down.</p>
            <p>The following diagram is a graphical representation of the above
      example:</p>
            <div class="mediaobject">
              <img src="images/charging2.png" tppabs="http://kamailio.org/docs/modules/4.3.x/modules/images/charging2.png" />
            </div>
          </div>
        </div>
        <div class="section" title="4. Parameters">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idm4776"></a>4. Parameters</h2>
              </div>
            </div>
          </div>
          <div class="section" title="4.1. hash_size(int)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idm4408"></a>4.1. <code class="varname">hash_size</code>(int)</h3>
                </div>
              </div>
            </div>
            <p>The size of the hash table internally used to keep the
      Diameter-Ro-Session. A larger table is much faster but consumes more
      memory. The hash size must be a power of two number.</p>
            <p>IMPORTANT: If Ro-Session's information should be stored in a
      database, a constant hash_size should be used, otherwise the restoring
      process will not take place. If you really want to modify the hash_size
      you must delete all table's rows before restarting the server.</p>
            <p>
              <span class="emphasis">
                <em>Default value is 4096.</em>
              </span>
            </p>
            <div class="example">
              <a id="idm2712"></a>
              <p class="title">
                <strong>Example 1.1. <code class="varname">hash_size</code>parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "hash_size", 1024)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.2. interim_update_credits(int)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idm1608"></a>4.2. <code class="varname">interim_update_credits</code>(int)</h3>
                </div>
              </div>
            </div>
            <p>How much credit should be requested interim request? At the start
      of the call, we request the amout of seconds as per Command. For each
      interim request, we would request credit for
      "interim_update_credits".</p>
            <p>
              <span class="emphasis">
                <em>Default value is 30.</em>
              </span>
            </p>
            <div class="example">
              <a id="idp71680"></a>
              <p class="title">
                <strong>Example 1.2. <code class="varname">interim_update_credits</code>parameter
        usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "interim_update_credits", 600)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.3. timer_buffer(int)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp72696"></a>4.3. <code class="varname">timer_buffer</code>(int)</h3>
                </div>
              </div>
            </div>
            <p>How many seconds before expiry of our credit should we request
      more credit?</p>
            <p>
              <span class="emphasis">
                <em>Default value is 8.</em>
              </span>
            </p>
            <div class="example">
              <a id="idp73808"></a>
              <p class="title">
                <strong>Example 1.3. <code class="varname">timer_buffer</code>parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "timer_buffer", 10)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.4. ro_forced_peer(string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp74920"></a>4.4. <code class="varname">ro_forced_peer</code>(string)</h3>
                </div>
              </div>
            </div>
            <p>FQDN of Diameter Peer (OCS) to use for communication (CCR). If you
      use this, the routing defined in your diameter xml configuration file
      (CDP) will be ignored and as a result you will lose the benefits of load
      balancing and failover. </p>
            <p>
              <span class="emphasis">
                <em>Default value is ''.</em>
              </span>
            </p>
            <div class="example">
              <a id="idp76184"></a>
              <p class="title">
                <strong>Example 1.4. <code class="varname">ro_forced_peer</code>parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "ro_forced_peer", "ocs.ims.smilecoms.com")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.5. ro_auth_expiry(integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp77320"></a>4.5. <code class="varname">ro_auth_expiry</code>(integer)</h3>
                </div>
              </div>
            </div>
            <p>This is the expiry length in seconds of the initiated Diameter
      sessions.</p>
            <p>
              <span class="emphasis">
                <em>Default value is 7200.</em>
              </span>
            </p>
            <div class="example">
              <a id="idp78408"></a>
              <p class="title">
                <strong>Example 1.5. <code class="varname">ro_auth_expiry</code>parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "ro_auth_expiry", 14400)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.6. ro_auth_expiry(integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp79520"></a>4.6. <code class="varname">ro_auth_expiry</code>(integer)</h3>
                </div>
              </div>
            </div>
            <p>This is the expiry length in seconds of the initiated Diameter
      sessions.</p>
            <p>
              <span class="emphasis">
                <em>Default value is 7200.</em>
              </span>
            </p>
            <div class="example">
              <a id="idp80608"></a>
              <p class="title">
                <strong>Example 1.6. <code class="varname">ro_auth_expiry</code>parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "ro_auth_expiry", 14400)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.7. cdp_event_latency(integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp81720"></a>4.7. <code class="varname">cdp_event_latency</code>(integer)</h3>
                </div>
              </div>
            </div>
            <p>This is a flag to determine whether or slow CDP responses should
      be reported in the log file. 1 is enabled and 0 is disabled.</p>
            <p>
              <span class="emphasis">
                <em>Default value is 1.</em>
              </span>
            </p>
            <div class="example">
              <a id="idp82880"></a>
              <p class="title">
                <strong>Example 1.7. <code class="varname">cdp_event_latency</code>parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "cdp_event_latency", 1)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.8. cdp_event_threshold(integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp83992"></a>4.8. <code class="varname">cdp_event_threshold</code>(integer)</h3>
                </div>
              </div>
            </div>
            <p>This time in milliseconds is the limit we should report a CDP
      response as slow. i.e. if a CDP response exceeds this limit it will be
      reported in the log file. This is only relevant is cdp_event_latency is
      enabled (set to 0).</p>
            <p>
              <span class="emphasis">
                <em>Default value is 500.</em>
              </span>
            </p>
            <div class="example">
              <a id="idp85240"></a>
              <p class="title">
                <strong>Example 1.8. <code class="varname">cdp_event_threshold</code>parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "cdp_event_threshold", 500)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.9. cdp_event_latency_log(integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp86360"></a>4.9. <code class="varname">cdp_event_latency_log</code>(integer)</h3>
                </div>
              </div>
            </div>
            <p>This time log level at which we should report slow CDP responses.
      0 is ERROR, 1 is WARN, 2 is INFO and 3 is DEBUG. This is only relevant
      is cdp_event_latency is enabled (set to 0)</p>
            <p>
              <span class="emphasis">
                <em>Default value is 0.</em>
              </span>
            </p>
            <div class="example">
              <a id="idp87560"></a>
              <p class="title">
                <strong>Example 1.9. <code class="varname">cdp_event_latency_log</code>parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "cdp_event_latency_log", 1)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.10. single_ro_session_per_dialog(integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp88656"></a>4.10. <code class="varname">single_ro_session_per_dialog</code>(integer)</h3>
                </div>
              </div>
            </div>
            <p>This tells the module whether it should do a single ro session per
      dialog no matter how many times Ro_send_CCR is called from the config
      file or initiate an ro session each time Ro_send_CCR is called. It is
      useful for IMS charging where you might want to charge for on-net
      originating and off-net originating calls but always have only a single
      ro session.</p>
            <p>
              <span class="emphasis">
                <em>Default value is 0.</em>
              </span>
            </p>
            <div class="example">
              <a id="idp90048"></a>
              <p class="title">
                <strong>Example 1.10. <code class="varname">single_ro_session_per_dialog</code>parameter
        usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "single_ro_session_per_dialog", 1)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.11. origin_host(string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp20504"></a>4.11. <code class="varname">origin_host</code>(string)</h3>
                </div>
              </div>
            </div>
            <p>Origin host to be used in Diameter messages to
      charging-server.</p>
            <p>
              <span class="emphasis">
                <em>Default value is
      "scscf.ims.smilecoms.com".</em>
              </span>
            </p>
            <div class="example">
              <a id="idp21632"></a>
              <p class="title">
                <strong>Example 1.11. <code class="varname">origin_host</code>parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "origin_host", "scscf.kamailio-ims.org")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.12. origin_realm(string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp22752"></a>4.12. <code class="varname">origin_realm</code>(string)</h3>
                </div>
              </div>
            </div>
            <p>Origin Realm to be used in Diameter messages to
      charging-server.</p>
            <p>
              <span class="emphasis">
                <em>Default value is "ims.smilecome.com".</em>
              </span>
            </p>
            <div class="example">
              <a id="idp23832"></a>
              <p class="title">
                <strong>Example 1.12. <code class="varname">origin_realm</code>parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "origin_realm", "kamailio-ims.org")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.13. destination_host(string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp24960"></a>4.13. <code class="varname">destination_host</code>(string)</h3>
                </div>
              </div>
            </div>
            <p>Destination host to be used in Diameter messages to
      charging-server.</p>
            <p>
              <span class="emphasis">
                <em>Default value is 5s.</em>
              </span>
            </p>
            <div class="example">
              <a id="idp26040"></a>
              <p class="title">
                <strong>Example 1.13. <code class="varname">destination_host</code>parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "destination_host", "ocs.kamailio-ims.org")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.14. destination_realm(string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp27176"></a>4.14. <code class="varname">destination_realm</code>(string)</h3>
                </div>
              </div>
            </div>
            <p>Destination realm to be used in Diameter messages to
      charging-server.</p>
            <p>
              <span class="emphasis">
                <em>Default value is "ims.smilecoms.com".</em>
              </span>
            </p>
            <div class="example">
              <a id="idp28256"></a>
              <p class="title">
                <strong>Example 1.14. <code class="varname">destination_realm</code>parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "destination_realm", "kamailio-ims.org")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.15. service_context_id_root(string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp29384"></a>4.15. <code class="varname">service_context_id_root</code>(string)</h3>
                </div>
              </div>
            </div>
            <p>This defines a root-element of the Service-Context-Id AVP used in
      the diameter-message</p>
            <p>The Service-Context-Id AVP is of type UTF8String (AVP Code 461)
      and contains a unique identifier of the Diameter credit-control service
      specific document that applies to the request (as defined in section RFC
      4006 4.1.2). This is an identifier allocated by the service provider, by
      the service element manufacturer, or by a standardization body, and MUST
      uniquely identify a given Diameter credit-control service specific
      document. The format of the Service-Context-Id is:</p>
            <pre class="programlisting">"service-context" "@" "domain" service-context = Token</pre>
            <p>The Token is an arbitrary string of characters and digits.</p>
            <p>'domain' represents the entity that allocated the
      Service-Context-Id. It can be ietf.org, 3gpp.org, etc., if the
      identifier is allocated by a standardization body, or it can be the FQDN
      of the service provider (e.g., provider.example.com) or of the vendor
      (e.g., vendor.example.com) if the identifier is allocated by a private
      entity.</p>
            <p>Service-specific documents that are for private use only (i.e., to
      one provider's own use, where no interoperability is deemed useful) may
      define private identifiers without need of coordination. However, when
      interoperability is wanted, coordination of the identifiers via, for
      example, publication of an informational RFC is RECOMMENDED in order to
      make Service-Context-Id globally available.</p>
            <p>
              <span class="emphasis">
                <em>Default value is "32260@3gpp.org".</em>
              </span>
            </p>
            <div class="example">
              <a id="idp33112"></a>
              <p class="title">
                <strong>Example 1.15. <code class="varname">service_context_id_root</code>parameter
        usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "service_context_id_root", "calls@kamailio-ims.org")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.16. service_context_id_ext(string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp34208"></a>4.16. <code class="varname">service_context_id_ext</code>(string)</h3>
                </div>
              </div>
            </div>
            <p>This defines the extension of the Service-Context-Id AVP used in
      the diameter-message.</p>
            <p>
              <span class="emphasis">
                <em>Default value is "ext".</em>
              </span>
            </p>
            <div class="example">
              <a id="idp35288"></a>
              <p class="title">
                <strong>Example 1.16. <code class="varname">service_context_id_ext</code>parameter
        usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "service_context_id_ext", "ext2")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.17. service_context_id_mnc(string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp36368"></a>4.17. <code class="varname">service_context_id_mnc</code>(string)</h3>
                </div>
              </div>
            </div>
            <p>This defines Mobile-Network-Code (MNC) of the Service-Context-Id
      AVP used in the diameter-message.</p>
            <p>
              <span class="emphasis">
                <em>Default value is "01".</em>
              </span>
            </p>
            <div class="example">
              <a id="idp37456"></a>
              <p class="title">
                <strong>Example 1.17. <code class="varname">service_context_id_mnc</code>parameter
        usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "service_context_id_mnc", "42")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.18. voice_service_identifier(string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp38528"></a>4.18. <code class="varname">voice_service_identifier</code>(string)</h3>
                </div>
              </div>
            </div>
            <p>This defines the service identifier to be used for charging voice.</p>
            <p>
              <span class="emphasis">
                <em>Default value is "1000".</em>
              </span>
            </p>
            <div class="example">
              <a id="idp39576"></a>
              <p class="title">
                <strong>Example 1.18. <code class="varname">voice_service_identifier</code>parameter
        usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "voice_service_identifier", "1000")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.19. voice_rating_group(string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp40656"></a>4.19. <code class="varname">voice_rating_group</code>(string)</h3>
                </div>
              </div>
            </div>
            <p>This defines the rating group to be used for charging voice.</p>
            <p>
              <span class="emphasis">
                <em>Default value is "100".</em>
              </span>
            </p>
            <div class="example">
              <a id="idp41728"></a>
              <p class="title">
                <strong>Example 1.19. <code class="varname">voice_rating_group</code>parameter
        usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "voice_rating_group", "100")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.20. video_service_identifier(string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp42824"></a>4.20. <code class="varname">video_service_identifier</code>(string)</h3>
                </div>
              </div>
            </div>
            <p>This defines the service identifier to be used for charging video.</p>
            <p>
              <span class="emphasis">
                <em>Default value is "1001".</em>
              </span>
            </p>
            <div class="example">
              <a id="idp1846064"></a>
              <p class="title">
                <strong>Example 1.20. <code class="varname">video_service_identifier</code>parameter
        usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "video_service_identifier", "1000")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.21. video_rating_group(string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1847144"></a>4.21. <code class="varname">video_rating_group</code>(string)</h3>
                </div>
              </div>
            </div>
            <p>This defines the rating group to be used for charging video.</p>
            <p>
              <span class="emphasis">
                <em>Default value is "200".</em>
              </span>
            </p>
            <div class="example">
              <a id="idp1848216"></a>
              <p class="title">
                <strong>Example 1.21. <code class="varname">video_rating_group</code>parameter
        usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "video_rating_group", "100")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.22. service_context_id_mcc(string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1849312"></a>4.22. <code class="varname">service_context_id_mcc</code>(string)</h3>
                </div>
              </div>
            </div>
            <p>This defines Mobile-Country-Code (MCC) of the Service-Context-Id
      AVP used in the diameter-message.</p>
            <p>see https://en.wikipedia.org/wiki/Mobile_country_code_(MCC) for
      details.</p>
            <p>
              <span class="emphasis">
                <em>Default value is "001".</em>
              </span>
            </p>
            <div class="example">
              <a id="idp1850696"></a>
              <p class="title">
                <strong>Example 1.22. <code class="varname">service_context_id_mcc</code>parameter
        usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "service_context_id_mcc", "262")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.23. service_context_id_release(string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1851768"></a>4.23. <code class="varname">service_context_id_release</code>(string)</h3>
                </div>
              </div>
            </div>
            <p>This defines Release of the Service-Context-Id AVP used in the
      diameter-message.</p>
            <p>
              <span class="emphasis">
                <em>Default value is "8" (Release 8).</em>
              </span>
            </p>
            <div class="example">
              <a id="idp1852880"></a>
              <p class="title">
                <strong>Example 1.23. <code class="varname">service_context_id_release</code>parameter
        usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("ims_charging", "service_context_id_release", "262")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
        <div class="section" title="5. Functions">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp1854040"></a>5. Functions</h2>
              </div>
            </div>
          </div>
          <div class="section" title="5.1. Ro_CCR(route_name, direction, reservation_units, domain, incoming_trunk_id, outgoing_trunk_id">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1854408"></a>5.1. <code class="function">Ro_CCR(route_name, direction,
      reservation_units, domain, incoming_trunk_id, outgoing_trunk_id</code>
      </h3>
                </div>
              </div>
            </div>
            <p>Perform a CCR on Diameter Ro interface for Charging</p>
            <p>Meaning of the parameters is as follows:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p><span class="emphasis"><em>route_name</em></span> route to be executed upon
          reception of charging requests</p>
                </li>
                <li class="listitem">
                  <p><span class="emphasis"><em>direction</em></span> "orig"inating or
          "term"inating</p>
                </li>
                <li class="listitem">
                  <p><span class="emphasis"><em>reservation_units</em></span> how many units (at the
          moment seconds) should be reservated at the moment.</p>
                </li>
                <li class="listitem">
                  <p><span class="emphasis"><em>domain</em></span> Logical domain within
          registrar.</p>
                </li>
                <li class="listitem">
                  <p><span class="emphasis"><em>incoming_trunk_id</em></span> Identifies the trunk group 
	  from which this originates.</p>
                </li>
                <li class="listitem">
                  <p><span class="emphasis"><em>outgoing_trunk_id</em></span> Identifies the trunk 
	  group where this will be terminated.</p>
                </li>
              </ul>
            </div>
            <p>This function can be used from REQUEST_ROUTE.</p>
            <p>This method is executed asynchronously. See example on how to
      retrieve return value.</p>
            <div class="example">
              <a id="idp1860192"></a>
              <p class="title">
                <strong>Example 1.24. Ro_CCR</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
  xlog("L_DBG","Sending initial CCR Request for call\n");
    Ro_CCR("RO_ASYNC_TERM_REPLY", "term", 30, "1", "1");
}

route[CHARGING_CCR_REPLY] 
  xlog("L_DBG","cca_return code is $avp(s:cca_return_code)\n");
  switch ($avp(s:cca_return_code)) {
    case 1: #success
        xlog("L_DBG", "CCR success - will route message\n");
        route(Finalize_Orig);
        break;
    case -1: #failure
        xlog("L_ERR", "CCR failure - error response sent from module\n");
        sl_send_reply("402","Payment required");
        break;
    case -2: #error
        xlog("L_ERR", "CCR error - error response sent from module\n");
        sl_send_reply("500", "Charging Error");
        break;
    default:
        xlog("L_ERR", "Unknown return code from CCR: [$avp(s:cca_return_code)] \n");
        break;
  }
  exit;
  }
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
        <div class="section" title="6. Statistics">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp1861992"></a>6. Statistics</h2>
              </div>
            </div>
          </div>
          <div class="section" title="6.1. Initial CCRs (initial_ccrs)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1862360"></a>6.1. Initial CCRs (initial_ccrs)</h3>
                </div>
              </div>
            </div>
            <p>The number of initial CCRs, i.e., the CCRs that were sent for the
      initial INVITEs.</p>
          </div>
          <div class="section" title="6.2. Interim CCRs (interim_ccrs)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1863096"></a>6.2. Interim CCRs (interim_ccrs)</h3>
                </div>
              </div>
            </div>
            <p>The number of CCRs sent within established sessions.</p>
          </div>
          <div class="section" title="6.3. Final CCRs (final_ccrs)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1863800"></a>6.3. Final CCRs (final_ccrs)</h3>
                </div>
              </div>
            </div>
            <p>The number of CCRs sent to terminate a session.</p>
          </div>
          <div class="section" title="6.4. Sucessful initial CCRs (successful_initial_ccrs)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1864496"></a>6.4. Sucessful initial CCRs (successful_initial_ccrs)</h3>
                </div>
              </div>
            </div>
            <p>Initial CCRs that ended with DIAMETER_SUCCESS response
      code.</p>
          </div>
          <div class="section" title="6.5. Sucessful interim CCRs (successful_interim_ccrs)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1865264"></a>6.5. Sucessful interim CCRs (successful_interim_ccrs)</h3>
                </div>
              </div>
            </div>
            <p>Interim CCRs that ended with DIAMETER_SUCCESS response
      code.</p>
          </div>
          <div class="section" title="6.6. Sucessful final CCRs (successful_final_ccrs)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1866032"></a>6.6. Sucessful final CCRs (successful_final_ccrs)</h3>
                </div>
              </div>
            </div>
            <p>Final CCRs that ended with DIAMETER_SUCCESS response code.</p>
          </div>
          <div class="section" title="6.7. Failed initial CCRs (failed_initial_ccrs)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1866792"></a>6.7. Failed initial CCRs (failed_initial_ccrs)</h3>
                </div>
              </div>
            </div>
            <p>Initial CCRs that ended with no DIAMETER_SUCCESS response or with
      some other error during processing.</p>
          </div>
          <div class="section" title="6.8. Failed interim CCRs (failed_interim_ccrs)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1867544"></a>6.8. Failed interim CCRs (failed_interim_ccrs)</h3>
                </div>
              </div>
            </div>
            <p>Interim CCRs that ended with no DIAMETER_SUCCESS response or with
      some other error during processing.</p>
          </div>
          <div class="section" title="6.9. Failed final CCRs (failed_final_ccrs)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1868296"></a>6.9. Failed final CCRs (failed_final_ccrs)</h3>
                </div>
              </div>
            </div>
            <p>Final CCRs that ended with no DIAMETER_SUCCESS response or with
      some other error during processing.</p>
          </div>
          <div class="section" title="6.10. CCRs average response time (ccr_avg_response_time)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1869048"></a>6.10. CCRs average response time (ccr_avg_response_time)</h3>
                </div>
              </div>
            </div>
            <p>Average CCA arrival time in milliseconds.</p>
          </div>
          <div class="section" title="6.11. CCRs responses time (ccr_responses_time)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1869744"></a>6.11. CCRs responses time (ccr_responses_time)</h3>
                </div>
              </div>
            </div>
            <p>Total CCA arrival time in milliseconds.</p>
          </div>
          <div class="section" title="6.12. CCRs requests, which ended with a timeout (ccr_timeouts)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1870384"></a>6.12. CCRs requests, which ended with a timeout (ccr_timeouts)</h3>
                </div>
              </div>
            </div>
            <p>Number of CCR-Requests, which ran into an timeout.</p>
          </div>
          <div class="section" title="6.13. Billed seconds (billed_secs)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1871144"></a>6.13. Billed seconds (billed_secs)</h3>
                </div>
              </div>
            </div>
            <p>Number of seconds billed in total.</p>
          </div>
          <div class="section" title="6.14. Killed calls (killed_calls)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1871864"></a>6.14. Killed calls (killed_calls)</h3>
                </div>
              </div>
            </div>
            <p>Number of calls that were killed due to lack of credit.</p>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
