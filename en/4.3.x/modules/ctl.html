<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>The Ctl Module</title>
    <link rel="stylesheet" type="text/css" href="../../../../css/sr-doc.css" tppabs="http://kamailio.org/css/sr-doc.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.76.1" />
    <link rel="home" href="#ctl" title="The Ctl Module" />
    <link rel="next" href="#idp52704" title="Chapter1.Admin Guide" />
  </head>
  <body>
    <div class="book" title="The Ctl Module">
      <div class="titlepage">
        <div>
          <div>
            <h1 class="title"><a id="ctl"></a>The Ctl Module</h1>
          </div>
          <div>
            <div class="authorgroup">
              <div class="author">
                <h3 class="author"><span class="firstname">Andrei</span> <span class="surname">Pelinescu-Onciul</span></h3>
                <div class="affiliation">
                  <span class="orgname">iptelorg GmbH<br /></span>
                </div>
              </div>
            </div>
          </div>
          <div>
            <p class="copyright">Copyright 漏 2009 iptelorg GmbH</p>
          </div>
        </div>
        <hr />
      </div>
      <div class="toc">
        <p>
          <strong>Table of Contents</strong>
        </p>
        <dl>
          <dt>
            <span class="chapter">
              <a href="#idp52704">1. Admin Guide</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="#ctl.overview">1. Overview</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="#ctl.binrpc">2. BINRPC</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="#ctl.parameters">3. Parameters</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#binrpc">3.1. <code class="varname">binrpc</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#mode">3.2. <code class="varname">mode</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#user">3.3. <code class="varname">user</code> (integer or string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#group">3.4. <code class="varname">group</code> (integer or string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#fifo">3.5. <code class="varname">fifo</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#autoconversion">3.6. <code class="varname">autoconversion</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#binrpc_max_body_size">3.7. <code class="varname">binrpc_max_body_size</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#binrpc_struct_max_body_size">3.8. <code class="varname">binrpc_struct_max_body_size</code> (integer)</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#ctl.rpcs">4. SIP-router RPC Functions</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#ctl.listen">4.1.  <code class="function">ctl.listen</code></a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#ctl.connections">4.2.  <code class="function">ctl.connections</code></a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#ctl.who">4.3.  <code class="function">ctl.who</code></a>
                    </span>
                  </dt>
                </dl>
              </dd>
            </dl>
          </dd>
        </dl>
      </div>
      <div class="list-of-examples">
        <p>
          <strong>List of Examples</strong>
        </p>
        <dl>
          <dt>1.1. <a href="#idp58264"><code class="function">kamcmd example</code> usage</a></dt>
          <dt>1.2. <a href="#idp2618912">Set <code class="varname">binrpc</code> parameter</a></dt>
          <dt>1.3. <a href="#idp2526944">Set <code class="varname">mode</code> parameter</a></dt>
          <dt>1.4. <a href="#idp172104">Set <code class="varname">user</code> parameter</a></dt>
          <dt>1.5. <a href="#idp174416">Set <code class="varname">group</code> parameter</a></dt>
          <dt>1.6. <a href="#idp177576">Set <code class="varname">fifo</code> parameter</a></dt>
          <dt>1.7. <a href="#idp180784">Set the <code class="varname">autoconversion</code> parameter
		</a></dt>
          <dt>1.8. <a href="#idp183024">Set the <code class="varname">binrpc_max_body_size</code> parameter
		</a></dt>
          <dt>1.9. <a href="#idp69264">Set the <code class="varname">binrpc_struct_max_body_size</code> parameter
		</a></dt>
          <dt>1.10. <a href="#idp276848"><code class="function">print</code> usage</a></dt>
          <dt>1.11. <a href="#idp2370584"><code class="function">ctl.connections</code> usage</a></dt>
          <dt>1.12. <a href="#idp1769472"><code class="function">ctl.who</code> usage</a></dt>
        </dl>
      </div>
      <div class="chapter" title="Chapter1.Admin Guide">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="idp52704"></a>Chapter1.Admin Guide</h2>
            </div>
          </div>
        </div>
        <div class="toc">
          <p>
            <strong>Table of Contents</strong>
          </p>
          <dl>
            <dt>
              <span class="section">
                <a href="#ctl.overview">1. Overview</a>
              </span>
            </dt>
            <dt>
              <span class="section">
                <a href="#ctl.binrpc">2. BINRPC</a>
              </span>
            </dt>
            <dt>
              <span class="section">
                <a href="#ctl.parameters">3. Parameters</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#binrpc">3.1. <code class="varname">binrpc</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#mode">3.2. <code class="varname">mode</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#user">3.3. <code class="varname">user</code> (integer or string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#group">3.4. <code class="varname">group</code> (integer or string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#fifo">3.5. <code class="varname">fifo</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#autoconversion">3.6. <code class="varname">autoconversion</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#binrpc_max_body_size">3.7. <code class="varname">binrpc_max_body_size</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#binrpc_struct_max_body_size">3.8. <code class="varname">binrpc_struct_max_body_size</code> (integer)</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#ctl.rpcs">4. SIP-router RPC Functions</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#ctl.listen">4.1.  <code class="function">ctl.listen</code></a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#ctl.connections">4.2.  <code class="function">ctl.connections</code></a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#ctl.who">4.3.  <code class="function">ctl.who</code></a>
                  </span>
                </dt>
              </dl>
            </dd>
          </dl>
        </div>
        <div class="section" title="1.Overview">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="ctl.overview"></a>1.Overview</h2>
              </div>
            </div>
          </div>
          <p>
		This module implements the binrpc transport interface for Kamailio RPCs.
		It supports various transports over which it speaks binrpc:
		Unix datagram sockets, Unix stream sockets, UDP and TCP.
		It also supports a backward compatible FIFO interface (using the old
		Kamailio FIFO protocol).
	</p>
          <p>
		By default (if no parameters are changed in the config file) it uses
		a Unix stream socket under /var/run/kamailio:
		/var/run/kamailio/kamailio_ctl. This socket is also the
		default for kamcmd.
	</p>
          <p>
		In general it's used in conjunction with kamcmd. kamcmd is a Unix
		tool for invoking Kamailio RPC functions. It can be used both in
		interactive mode (supports tab-completion and history) or command
		line mode.
		</p>
          <div class="example">
            <a id="idp58264"></a>
            <p class="title">
              <strong>Example1.1.<code class="function">kamcmd example</code> usage</strong>
            </p>
            <div class="example-contents">
              <pre class="programlisting">$ kamcmd ps
11262	attendant
11268	udp receiver child=0 sock=127.0.0.1:5060
11269	udp receiver child=1 sock=127.0.0.1:5060
11270	udp receiver child=0 sock=192.168.1.101:5060
11271	udp receiver child=1 sock=192.168.1.101:5060
11272	slow timer
11273	timer
11274	ctl handler
11275	tcp receiver child=0
11276	tcp receiver child=1
11277	tcp main process</pre>
            </div>
          </div>
          <p><br class="example-break" />
	See <a class="ulink" href="javascript:if(confirm('http://git.sip-router.org/cgi-bin/gitweb.cgi?p=sip-router;a=blob;f=utils/sercmd/EXAMPLES  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://git.sip-router.org/cgi-bin/gitweb.cgi?p=sip-router;a=blob;f=utils/sercmd/EXAMPLES'" tppabs="http://git.sip-router.org/cgi-bin/gitweb.cgi?p=sip-router;a=blob;f=utils/sercmd/EXAMPLES">utils/kamcmd/EXAMPLES</a>
	for more examples.
	</p>
        </div>
        <div class="section" title="2.BINRPC">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="ctl.binrpc"></a>2.BINRPC</h2>
              </div>
            </div>
          </div>
          <p>
		binrpc is a ser proprietary binary protocol for invoking rpcs.
		It was designed such that it would minimize the packet sizes and it
		would be very fast to parse (as opposed to XML-rpc).
	</p>
          <p>
		The binrpc encoding format is fully documented inside
		<a class="ulink" href="javascript:if(confirm('http://git.sip-router.org/cgi-bin/gitweb.cgi?p=sip-router;a=blob;f=modules/ctl/binrpc.h  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://git.sip-router.org/cgi-bin/gitweb.cgi?p=sip-router;a=blob;f=modules/ctl/binrpc.h'" tppabs="http://git.sip-router.org/cgi-bin/gitweb.cgi?p=sip-router;a=blob;f=modules/ctl/binrpc.h">
		modules/ctl/binrpc.h</a>.
	</p>
        </div>
        <div class="section" title="3.Parameters">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="ctl.parameters"></a>3.Parameters</h2>
              </div>
            </div>
          </div>
          <div class="section" title="3.1.binrpc (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="binrpc"></a>3.1.<code class="varname">binrpc</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Specifies the transport used for the binrpc protocol.
		The following transport protocol are supported: Unix datagram
		sockets, Unix stream sockets, UDP and TCP.
	</p>
            <p>
		The format is: [ protocol:] address_port|path .
	</p>
            <p>
	</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
			For <span class="emphasis"><em>Unix</em></span> sockets:  [unixd|unixs|unix]:path
			where <code class="varname">"unixd"</code> means Unix datagram sockets and
			<code class="varname">"unix"</code>  <code class="varname">"unixs"</code> mean Unix
			stream sockets.
			Examples: "unixd:/tmp/unix_dgram", "unixs:/tmp/unix_stream",
			"unix:/tmp/unix_stream".
		</p>
                </li>
                <li class="listitem">
                  <p>
		For <span class="emphasis"><em>UDP</em></span> or <span class="emphasis"><em>TCP</em></span> sockets:
		[udp|tcp]:address:port.
		If the address is "*" or missing, it will bind to all the local 
		addresses (0.0.0.0).
		Examples: "udp:localhost:2046", "tcp:localhost:2046",
		"tcp:3012", "udp:*:3012".
	</p>
                </li>
              </ul>
            </div>
            <p>
	</p>
            <p>
		If the protocol part is missing and the address/path part looks like a
		file system path it will default to a Unix stream socket and if not to
		an Unix UDP socket.
		Examples:
		</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
				"/tmp/unix_test" - equivalent to "unixs:/tmp/unix_test".
			</li>
                <li class="listitem">
				"localhost:3000" - equivalent to "udp:localhost:3000".
			</li>
              </ul>
            </div>
            <p>
	</p>
            <p>
		Multiple transports / listen addresses can be specified, just by
		setting the parameter multiple times.
	</p>
            <p>
		<span class="emphasis"><em>Default:</em></span>
		"unix:/var/run/kamailio/kamailio_ctl" (Unix stream socket).
		The default value is used <span class="emphasis"><em>only</em></span> if no
		<code class="varname">binrpc</code> parameter is found in the config file.
	</p>
            <div class="example">
              <a id="idp2618912"></a>
              <p class="title">
                <strong>Example1.2.Set <code class="varname">binrpc</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">loadmodule "ctl"
# optional listen addresses, if no one is specified,
# ctl will listen on unixs:/tmp/ser_ctl

modparam("ctl", "binrpc", "unix:/tmp/kamailio_ctl") # default
modparam("ctl", "binrpc", "udp:localhost:2046")
modparam("ctl", "binrpc", "tcp:localhost:2046")
modparam("ctl", "binrpc", "unixd:/tmp/unix_dgram")  # unix datagram
modparam("ctl", "binrpc", "unixs:/tmp/unix_stream") # unix stream
modparam("ctl", "binrpc", "unix:/tmp/unix_default") # unix stream
modparam("ctl", "binrpc", "/tmp/unix_test")         # unix stream
modparam("ctl", "binrpc", "localhost:3000")         # udp
modparam("ctl", "binrpc", "tcp:3012")               # tcp any , port 3012
modparam("ctl", "binrpc", "udp:*:3012")             # udp any , port 3012</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.2.mode (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="mode"></a>3.2.<code class="varname">mode</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Permissions used for the created Unix sockets or for the fifo.
	</p>
            <p>
		Default: 0600.
	</p>
            <div class="example">
              <a id="idp2526944"></a>
              <p class="title">
                <strong>Example1.3.Set <code class="varname">mode</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">modparam("ctl", "mode", 0600) # permissions</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.3.user (integer or string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="user"></a>3.3.<code class="varname">user</code> (integer or string)</h3>
                </div>
              </div>
            </div>
            <p>
		Username or uid used for the created Unix sockets or for the fifo.
	</p>
            <p>
		Default: not set (the user under which SER runs).
	</p>
            <div class="example">
              <a id="idp172104"></a>
              <p class="title">
                <strong>Example1.4.Set <code class="varname">user</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">modparam("ctl", "user", "andrei")</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.4.group (integer or string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="group"></a>3.4.<code class="varname">group</code> (integer or string)</h3>
                </div>
              </div>
            </div>
            <p>
		Group name or gid used for the created Unix sockets or for the fifo.
	</p>
            <p>
		Default: not set (the group under which SER runs).
	</p>
            <div class="example">
              <a id="idp174416"></a>
              <p class="title">
                <strong>Example1.5.Set <code class="varname">group</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">modparam("ctl", "group", 100)</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.5.fifo (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="fifo"></a>3.5.<code class="varname">fifo</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		fifo used for the obsolete fifo protocol.
		The fifo protocol can be run over a real fifo, over UDP or over TCP.
		Format: [protocol:]path|address.
		If no protocol is specified the default is "fifo".
		Examples: "fifo:/tmp/ser_fifo", "/tmp/ser_fifo2", "udp:*:2050",
		"tcp:localhost:2050".
		For more details on the UDP and TCP formats see 
		<code class="varname">binrpc</code>.
		Multiple fifos or fifo transports can be used in the same time
		(just by setting the <code class="varname">fifo</code> parameter multiple
		times in the config).
	</p>
            <p>
		Default: not set (no fifo will be used).
	</p>
            <div class="example">
              <a id="idp177576"></a>
              <p class="title">
                <strong>Example1.6.Set <code class="varname">fifo</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting"># old fifo support
modparam("ctl", "fifo", "fifo:/tmp/ser_fifo")      # clasic fifo
modparam("ctl", "fifo", "/tmp/ser_fifo2")       
modparam("ctl", "fifo", "udp:*:2050")              # fifo protocol over udp
modparam("ctl", "fifo", "tcp:*:2050")              # fifo over tcp</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.6.autoconversion (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="autoconversion"></a>3.6.<code class="varname">autoconversion</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Enable or disable automatic type conversion globally, for all the
		methods parameters.
		If on, a type mismatch in a method parameter will not cause a fault
		if it is possible to automatically convert it to the expected type.
	</p>
            <p>
		Default: off 
	</p>
            <p>
		It is recommended to leave this parameter to its default off value
		and fix instead the client application (which should use the
		proper types) or to modify the target rpc to accept any type
		(see the rpc scan '.' modifier).
	</p>
            <div class="example">
              <a id="idp180784"></a>
              <p class="title">
                <strong>Example1.7.Set the <code class="varname">autoconversion</code> parameter
		</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">modparam("ctl", "autoconversion", 1)</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.7.binrpc_max_body_size (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="binrpc_max_body_size"></a>3.7.<code class="varname">binrpc_max_body_size</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Set the size of binrpc buffer for RPC reply. Value represents
		kilobytes.
	</p>
            <p>
		Default: 4 (meaning 4KB);
	</p>
            <div class="example">
              <a id="idp183024"></a>
              <p class="title">
                <strong>Example1.8.Set the <code class="varname">binrpc_max_body_size</code> parameter
		</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">modparam("ctl", "binrpc_max_body_size", 10)</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.8.binrpc_struct_max_body_size (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="binrpc_struct_max_body_size"></a>3.8.<code class="varname">binrpc_struct_max_body_size</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Set the size of binrpc structure buffer for RPC reply. Value represents
		kilobytes.
	</p>
            <p>
		Default: 1 (meaning 1KB);
	</p>
            <div class="example">
              <a id="idp69264"></a>
              <p class="title">
                <strong>Example1.9.Set the <code class="varname">binrpc_struct_max_body_size</code> parameter
		</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">modparam("ctl", "binrpc_struct_max_body_size", 3)</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
        <div class="section" title="4.SIP-router RPC Functions">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="ctl.rpcs"></a>4.SIP-router RPC Functions</h2>
              </div>
            </div>
          </div>
          <div class="section" title="4.1. ctl.listen">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="ctl.listen"></a>4.1. <code class="function">ctl.listen</code></h3>
                </div>
              </div>
            </div>
            <p>
		List all the sockets on which the ctl module listens.
	</p>
            <div class="example">
              <a id="idp276848"></a>
              <p class="title">
                <strong>Example1.10.<code class="function">print</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting"> $ kamcmd -f"[%v] %v:%v %v\n" ctl.listen
[binrpc] unix_stream:/tmp/kamailio_ctl
 
# note: the above command is equivalent with kamcmd listen</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.2. ctl.connections">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="ctl.connections"></a>4.2. <code class="function">ctl.connections</code></h3>
                </div>
              </div>
            </div>
            <p>
		Returns the number of open binrpc connections (to the ctl module).
	</p>
            <div class="example">
              <a id="idp2370584"></a>
              <p class="title">
                <strong>Example1.11.<code class="function">ctl.connections</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting"> $ kamcmd ctl.connections
1</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.3. ctl.who">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="ctl.who"></a>4.3. <code class="function">ctl.who</code></h3>
                </div>
              </div>
            </div>
            <p>
		List open binrpc connections (to the ctl module).
	</p>
            <div class="example">
              <a id="idp1769472"></a>
              <p class="title">
                <strong>Example1.12.<code class="function">ctl.who</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting"> $ kamcmd -f"[%v] %v: %v %v -&gt; %v %v\n" ctl.who
[binrpc] unix_stream: &lt;anonymous unix socket&gt;  -&gt; /tmp/kamailio_ctl

# note the above command is equivalent to kamcmd who</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
