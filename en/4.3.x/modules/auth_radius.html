<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Auth_radius Module</title>
    <link rel="stylesheet" type="text/css" href="../../../../css/sr-doc.css" tppabs="http://kamailio.org/css/sr-doc.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.76.1" />
    <link rel="home" href="#idm4360568" title="Auth_radius Module" />
    <link rel="next" href="#idp3359464" title="Chapter¬†1.¬†Admin Guide" />
  </head>
  <body>
    <div class="book" title="Auth_radius Module">
      <div class="titlepage">
        <div>
          <div>
            <h1 class="title"><a id="idm4360568"></a>Auth_radius Module</h1>
          </div>
          <div>
            <div class="authorgroup">
              <div class="author">
                <h3 class="author"><span class="firstname">Jan</span> <span class="surname">Janak</span></h3>
                <div class="affiliation">
                  <span class="orgname">FhG Fokus<br /></span>
                </div>
                <code class="email">&lt;<a class="email" href="mailto:jan@iptel.org">jan@iptel.org</a>&gt;</code>
              </div>
              <div class="author">
                <h3 class="author"><span class="firstname">Juha</span> <span class="surname">Heinanen</span></h3>
                <code class="email">&lt;<a class="email" href="mailto:jh@tutpro.com">jh@tutpro.com</a>&gt;</code>
              </div>
              <div class="author">
                <h3 class="author"><span class="firstname">Stelios</span> <span class="surname">Sidiroglou-Douskos</span></h3>
              </div>
              <div class="author">
                <h3 class="author"><span class="firstname">Bogdan-Andrei</span> <span class="surname">Iancu</span></h3>
                <div class="affiliation">
                  <span class="orgname">Voice Sistem SRL<br /></span>
                </div>
                <code class="email">&lt;<a class="email" href="mailto:bogdan@voice-system.ro">bogdan@voice-system.ro</a>&gt;</code>
              </div>
              <div class="editor">
                <h4 class="editedby">Edited by</h4>
                <h3 class="editor"><span class="firstname">Jan</span> <span class="surname">Janak</span></h3>
                <code class="email">&lt;<a class="email" href="mailto:jan@iptel.org">jan@iptel.org</a>&gt;</code>
              </div>
            </div>
          </div>
          <div>
            <p class="copyright">Copyright ¬© 2002, 2003 FhG FOKUS</p>
          </div>
          <div>
            <p class="copyright">Copyright ¬© 2005 Voice Sistem SRL</p>
          </div>
          <div>
            <p class="copyright">Copyright ¬© 2008-2010 Juha Heinanen</p>
          </div>
        </div>
        <hr />
      </div>
      <div class="toc">
        <p>
          <strong>Table of Contents</strong>
        </p>
        <dl>
          <dt>
            <span class="chapter">
              <a href="#idp3359464">1. Admin Guide</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="#idp3247816">1. Overview</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="#idp3028680">2. Additional Credentials</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="#idp2529904">3. Dependencies</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp2609560">3.1. Modules</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1964752">3.2. External Libraries or Applications</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp1543096">4. Parameters</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp2576776">4.1. <code class="varname">radius_config</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp2863304">4.2. <code class="varname">service_type</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp2865800">4.3. <code class="varname">auth_extra</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp2868216">4.4. <code class="varname">use_ruri_flag</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#auth_radius.p.radius_avps_mode">4.5. <code class="varname">radius_avps_mode</code> (integer)</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp2873664">5. Functions</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp2874032">5.1. <code class="function">radius_www_authorize(realm [, uri_user])</code></a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idm3488">5.2. <code class="function">radius_proxy_authorize(realm [, uri_user])</code></a>
                    </span>
                  </dt>
                </dl>
              </dd>
            </dl>
          </dd>
        </dl>
      </div>
      <div class="list-of-examples">
        <p>
          <strong>List of Examples</strong>
        </p>
        <dl>
          <dt>1.1. <a href="#idp2696432"><span class="quote">‚Äú<span class="quote">SIP-AVP</span>‚Äù</span> RADIUS AVP exmaples</a></dt>
          <dt>1.2. <a href="#idp2862184"><code class="varname">radius_config</code> parameter usage</a></dt>
          <dt>1.3. <a href="#idp2864704"><code class="varname">service_type</code> parameter usage</a></dt>
          <dt>1.4. <a href="#idp2867112"><code class="varname">auth_extra</code> parameter usage</a></dt>
          <dt>1.5. <a href="#idp2870080"><code class="varname">use_ruri_flag</code> parameter usage</a></dt>
          <dt>1.6. <a href="#idp2872488"><code class="varname">radius_avps_mode</code> parameter usage</a></dt>
          <dt>1.7. <a href="#idm5112"><code class="function">radius_www_authorize</code> usage</a></dt>
          <dt>1.8. <a href="#idp70112"><code class="function">proxy_authorize</code> usage</a></dt>
        </dl>
      </div>
      <div class="chapter" title="Chapter¬†1.¬†Admin Guide">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="idp3359464"></a>Chapter¬†1.¬†Admin Guide</h2>
            </div>
          </div>
        </div>
        <div class="toc">
          <p>
            <strong>Table of Contents</strong>
          </p>
          <dl>
            <dt>
              <span class="section">
                <a href="#idp3247816">1. Overview</a>
              </span>
            </dt>
            <dt>
              <span class="section">
                <a href="#idp3028680">2. Additional Credentials</a>
              </span>
            </dt>
            <dt>
              <span class="section">
                <a href="#idp2529904">3. Dependencies</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp2609560">3.1. Modules</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1964752">3.2. External Libraries or Applications</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp1543096">4. Parameters</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp2576776">4.1. <code class="varname">radius_config</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp2863304">4.2. <code class="varname">service_type</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp2865800">4.3. <code class="varname">auth_extra</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp2868216">4.4. <code class="varname">use_ruri_flag</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#auth_radius.p.radius_avps_mode">4.5. <code class="varname">radius_avps_mode</code> (integer)</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp2873664">5. Functions</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp2874032">5.1. <code class="function">radius_www_authorize(realm [, uri_user])</code></a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idm3488">5.2. <code class="function">radius_proxy_authorize(realm [, uri_user])</code></a>
                  </span>
                </dt>
              </dl>
            </dd>
          </dl>
        </div>
        <div class="section" title="1.¬†Overview">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp3247816"></a>1.¬†Overview</h2>
              </div>
            </div>
          </div>
          <p>
		This module contains functions that are used to perform authentication 
		using a Radius server. Basically the proxy will pass along the 
		credentials to the radius server which will in turn send a reply 
		containing result of the authentication. So basically the whole
		authentication is done in the Radius server. Before sending the request 
		to the radius server we perform some sanity checks over the 
		credentials to make sure that only well formed credentials will get to 
		the server. We have implemented radius authentication according to 
		draft-sterman-aaa-sip-00. This module requires radiusclient-ng
		library version 0.5.0 or higher which is available from 
		<a class="ulink" href="javascript:if(confirm('http://developer.berlios.de/projects/radiusclient-ng/  \n\n∏√Œƒº˛Œﬁ∑®”√ Teleport Ultra œ¬‘ÿ, “ÚŒ™ À¸ «“ª∏ˆ”ÚªÚ¬∑æ∂Õ‚≤ø±ª…Ë÷√Œ™À¸µƒ∆Ù ºµÿ÷∑µƒµÿ÷∑°£  \n\nƒ„œÎ‘⁄∑˛ŒÒ∆˜…œ¥Úø™À¸?'))window.location='http://developer.berlios.de/projects/radiusclient-ng/'" tppabs="http://developer.berlios.de/projects/radiusclient-ng/">
		http://developer.berlios.de/projects/radiusclient-ng/</a>.
	</p>
        </div>
        <div class="section" title="2.¬†Additional Credentials">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp3028680"></a>2.¬†Additional Credentials</h2>
              </div>
            </div>
          </div>
          <p>
		When performing authentification, the RADIUS server may include in the
		response additional credentials. This scheme is very useful in fetching
		additional user information from the RADIUS server without making
		extra queries.
	</p>
          <p>
		The additional credentials are embedded in the RADIUS reply as AVPs 
		<span class="quote">‚Äú<span class="quote">SIP-AVP</span>‚Äù</span>. The syntax of the value is:
		</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
                <p>
                  <span class="emphasis">
                    <em>
			value = SIP_AVP_NAME SIP_AVP_VALUE
			</em>
                  </span>
                </p>
              </li>
              <li class="listitem">
                <p>
                  <span class="emphasis">
                    <em>
			SIP_AVP_NAME = STRING_NAME | '#'ID_NUMBER
			</em>
                  </span>
                </p>
              </li>
              <li class="listitem">
                <p>
                  <span class="emphasis">
                    <em>
			SIP_AVP_VALUE = ':'STRING_VALUE | '#'NUMBER_VALUE
			</em>
                  </span>
                </p>
              </li>
            </ul>
          </div>
          <p>
	</p>
          <p>
		All additional credentials will be stored as Kamailio AVPs
		(SIP_AVP_NAME = SIP_AVP_VALUE).
	</p>
          <p>
		The RPID value may be fetch via this mechanism.
	</p>
          <div class="example">
            <a id="idp2696432"></a>
            <p class="title">
              <strong>Example¬†1.1.¬†<span class="quote">‚Äú<span class="quote">SIP-AVP</span>‚Äù</span> RADIUS AVP exmaples</strong>
            </p>
            <div class="example-contents">
              <pre class="programlisting">....
"email:joe@yahoo.com"
    - STRING NAME AVP (email) with STRING VALUE (joe@yahoo.com)
"#14:joe@yahoo.com"
    - ID AVP (14) with STRING VALUE (joe@yahoo.com)
"age#28"
    - STRING NAME AVP (age) with INTEGER VALUE (28)
"#14#28"
    - ID AVP (14) with INTEGER VALUE (28)
....</pre>
            </div>
          </div>
          <br class="example-break" />
        </div>
        <div class="section" title="3.¬†Dependencies">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp2529904"></a>3.¬†Dependencies</h2>
              </div>
            </div>
          </div>
          <div class="section" title="3.1.¬†Modules">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp2609560"></a>3.1.¬†Modules</h3>
                </div>
              </div>
            </div>
            <p>
			The module depends on the following modules (in the other words 
			the listed modules must be loaded before this module):
			</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p><span class="emphasis"><em>modules/auth</em></span>
				-- Generic authentication functions
				</p>
                </li>
              </ul>
            </div>
            <p>
			</p>
          </div>
          <div class="section" title="3.2.¬†External Libraries or Applications">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1964752"></a>3.2.¬†External Libraries or Applications</h3>
                </div>
              </div>
            </div>
            <p>
			The following libraries or applications must be installed 
			before compilling Kamailio with this module loaded:
			</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p><span class="emphasis"><em>radiusclient-ng</em></span> 0.5.0 or higher -- 
				library and development files. See <a class="ulink" href="javascript:if(confirm('http://developer.berlios.de/projects/radiusclient-ng/  \n\n∏√Œƒº˛Œﬁ∑®”√ Teleport Ultra œ¬‘ÿ, “ÚŒ™ À¸ «“ª∏ˆ”ÚªÚ¬∑æ∂Õ‚≤ø±ª…Ë÷√Œ™À¸µƒ∆Ù ºµÿ÷∑µƒµÿ÷∑°£  \n\nƒ„œÎ‘⁄∑˛ŒÒ∆˜…œ¥Úø™À¸?'))window.location='http://developer.berlios.de/projects/radiusclient-ng/'" tppabs="http://developer.berlios.de/projects/radiusclient-ng/">
				http://developer.berlios.de/projects/radiusclient-ng/</a>.
				</p>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="section" title="4.¬†Parameters">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp1543096"></a>4.¬†Parameters</h2>
              </div>
            </div>
          </div>
          <div class="section" title="4.1.¬†radius_config (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp2576776"></a>4.1.¬†<code class="varname">radius_config</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		This is the location of the configuration file of radius client 
		libraries.
		</p>
            <p>
		Default value is 
			<span class="quote">‚Äú<span class="quote">/usr/local/etc/radiusclient-ng/radiusclient.conf</span>‚Äù</span>.
		</p>
            <div class="example">
              <a id="idp2862184"></a>
              <p class="title">
                <strong>Example¬†1.2.¬†<code class="varname">radius_config</code> parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">modparam("auth_radius", "radius_config", "/etc/radiusclient.conf")</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.2.¬†service_type (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp2863304"></a>4.2.¬†<code class="varname">service_type</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		This is the value of the Service-Type radius attribute to be used. 
		The default should be fine for most people. See your radius client 
		include files for numbers to be put in this parameter if you need 
		to change it.
		</p>
            <p>
		Default value is <span class="quote">‚Äú<span class="quote">15</span>‚Äù</span>.
		</p>
            <div class="example">
              <a id="idp2864704"></a>
              <p class="title">
                <strong>Example¬†1.3.¬†<code class="varname">service_type</code> parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">modparam("auth_radius", "service_type", 15)</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.3.¬†auth_extra (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp2865800"></a>4.3.¬†<code class="varname">auth_extra</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Semi-colon separated list of extra RADIUS attribute
		name=pseudo variable pairs. When radius_www_authorize() or
		radius_proxy_authorize() function is called, listed extra
		attributes are included in RADIUS request with 
		current values of corresponding pseudo variables.
		</p>
            <p>
		There is no default value, i.e., by default no extra
		attributes are included.
		</p>
            <div class="example">
              <a id="idp2867112"></a>
              <p class="title">
                <strong>Example¬†1.4.¬†<code class="varname">auth_extra</code> parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">modparam("auth_radius", "auth_extra", "Acct-Session-Id=$ci")</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.4.¬†use_ruri_flag (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp2868216"></a>4.4.¬†<code class="varname">use_ruri_flag</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
                When this parameter is set to the value other than "-1" and the
                request being authenticated has flag with matching number set
                via setflag() function, use Request URI instead of uri parameter
                value from the Authorization / Proxy-Authorization header field
                to perform RADIUS authentication.  This is intended to provide
                workaround for misbehaving NAT / routers / ALGs that alter request
                in the transit, breaking authentication.  At the time of this
                writing, certain versions of Linksys WRT54GL are known to do that.
                </p>
            <p>
                Default value is <span class="quote">‚Äú<span class="quote">-1</span>‚Äù</span>.
                </p>
            <div class="example">
              <a id="idp2870080"></a>
              <p class="title">
                <strong>Example¬†1.5.¬†<code class="varname">use_ruri_flag</code> parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">modparam("auth_radius", "use_ruri_flag", 22)</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.5.¬†radius_avps_mode (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="auth_radius.p.radius_avps_mode"></a>4.5.¬†<code class="varname">radius_avps_mode</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
			If set to 1, all RADIUS AVPs returned by RADIUS server are stored
			in Kamailio AVPs list. If set to 0, only the SIP_AVP type of RADIUS
			AVPs are stored in Kamailio AVPs list.
		</p>
            <p>
			Default value is 0.
		</p>
            <div class="example">
              <a id="idp2872488"></a>
              <p class="title">
                <strong>Example¬†1.6.¬†<code class="varname">radius_avps_mode</code> parameter usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">modparam("auth_radius", "radius_avps_mode", 1)</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
        <div class="section" title="5.¬†Functions">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp2873664"></a>5.¬†Functions</h2>
              </div>
            </div>
          </div>
          <div class="section" title="5.1.¬†radius_www_authorize(realm [, uri_user])">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp2874032"></a>5.1.¬†<code class="function">radius_www_authorize(realm [, uri_user])</code></h3>
                </div>
              </div>
            </div>
            <p>
		The function verifies credentials according to 
		<a class="ulink" href="javascript:if(confirm('http://www.ietf.org/rfc/rfc2617.txt  \n\n∏√Œƒº˛Œﬁ∑®”√ Teleport Ultra œ¬‘ÿ, “ÚŒ™ À¸ «“ª∏ˆ”ÚªÚ¬∑æ∂Õ‚≤ø±ª…Ë÷√Œ™À¸µƒ∆Ù ºµÿ÷∑µƒµÿ÷∑°£  \n\nƒ„œÎ‘⁄∑˛ŒÒ∆˜…œ¥Úø™À¸?'))window.location='http://www.ietf.org/rfc/rfc2617.txt'" tppabs="http://www.ietf.org/rfc/rfc2617.txt">RFC2617</a>. If 
		the credentials are verified successfully then the function will 
		succeed and mark the credentials as authorized (marked credentials can 
		be later used by some other functions).
		</p>
            <p>
		If the function	was unable to  
		verify the credentials for some reason, it fails and
		assigns a WWW-Authorize header containing a new
	challenge to digest_challenge AVP (see modules/auth).
	The script should
	then respond with 401 that includes this header, which will
	challenge the user again.
		</p>
            <p>Negative result codes may be interpreted as follows:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>-7 (internal error)</em></span> - some
			internal error occurred (see syslog);
			</p>
                </li>
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>-6 (nonce reused)</em></span> - nonce is used more than once;
			</p>
                </li>
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>-5 (no credentials)</em></span> - credentials were not found in request;
			</p>
                </li>
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>-4 (stale nonce)</em></span> - stale nonce;
			</p>
                </li>
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>-2 (authorization failed)</em></span> - RADIUS responded with Access Reject which may be, for example, due to user not found or wrong password;
			</p>
                </li>
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>-1 (error)</em></span> - some error occured during authorization (see syslog);
			</p>
                </li>
              </ul>
            </div>
            <p>
		This function will perform sanity checks over
	the received  
		credentials and then pass them along to RADIUS
	server which will  
		verify the credentials and return whether they are valid or not.
		</p>
            <p>Meaning of the parameter is as follows:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p><span class="emphasis"><em>realm</em></span> - Realm is a
	opaque string that  
			the user agent should present to the user so he
	can decide what  
			username and password to use.  In case of
	REGISTER requests it is usually hostpart of To URI.
			</p>
                  <p>
			The string may contain pseudo variables.
			</p>
                </li>
                <li class="listitem">
                  <p><span class="emphasis"><em>uri_user</em></span> - Uri_user is an
			optional pseudo variable parameter whose value, if
			present, will be given to Radius server as value of
			SIP-URI-User check item.
			If uri_user pseudo variable parameter is not
			present, the server will generate 
                        SIP-URI-User check item value from user part of
			To/From URI.
			</p>
                </li>
              </ul>
            </div>
            <p>
		This function can be used from REQUEST_ROUTE.
		</p>
            <div class="example">
              <a id="idm5112"></a>
              <p class="title">
                <strong>Example¬†1.7.¬†<code class="function">radius_www_authorize</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
    if (!radius_www_authorize("$td")) {
        switch ($rc) {
        case -7:
	    send_reply("500", "Server Internal Error");
	    exit;
        case -1:
	    send_reply("400", "Bad Request");
	    exit;
        default:
        };
        if (defined($avp(digest_challenge)) &amp;&amp;
                ($avp(digest_challenge) != "")) {
            append_to_reply("$avp(digest_challenge)");
        };
        send_reply("401", "Unauthorized");
        exit;
    };
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="5.2.¬†radius_proxy_authorize(realm [, uri_user])">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idm3488"></a>5.2.¬†<code class="function">radius_proxy_authorize(realm [, uri_user])</code></h3>
                </div>
              </div>
            </div>
            <p>
		The function verifies credentials according to 
		<a class="ulink" href="javascript:if(confirm('http://www.ietf.org/rfc/rfc2617.txt  \n\n∏√Œƒº˛Œﬁ∑®”√ Teleport Ultra œ¬‘ÿ, “ÚŒ™ À¸ «“ª∏ˆ”ÚªÚ¬∑æ∂Õ‚≤ø±ª…Ë÷√Œ™À¸µƒ∆Ù ºµÿ÷∑µƒµÿ÷∑°£  \n\nƒ„œÎ‘⁄∑˛ŒÒ∆˜…œ¥Úø™À¸?'))window.location='http://www.ietf.org/rfc/rfc2617.txt'" tppabs="http://www.ietf.org/rfc/rfc2617.txt">RFC2617</a>. If 
		the credentials are verified successfully then the function will 
		succeed and mark the credentials as authorized (marked credentials can 
		be later used by some other functions).  
		</p>
            <p>If the function was unable to  
		verify the credentials for some reason, it fails and
		assigns a Proxy-Authorize header containing a new
	challenge to digest_challenge AVP.  The script should
	then respond with 407 that includes this header, which will
	challenge the user again.
		For negative result codes, see the above function.
		</p>
            <p>
		This function will perform sanity checks over the received 
		credentials and then pass them along to RADIUS server which will 
		verify the credentials and return whether they are valid or not.
		</p>
            <p>Meaning of the parameters is as follows:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p><span class="emphasis"><em>realm</em></span> - Realm is a opaque string that 
			the user agent should present to the user so he can decide what 
			username and password to use.  In case of
	non-REGISTER requests it is usually hostpart of From or
		P-Preferred-Identity URI.
			</p>
                  <p>
			The string may contain pseudo variables.
			</p>
                </li>
                <li class="listitem">
                  <p><span class="emphasis"><em>uri_user</em></span> - Uri_user is an
			optional pseudo variable parameter whose value, if
			present, will be given to Radius server as value of
			SIP-URI-User check item.
			If uri_user pseudo variable parameter is not
			present, the server will generate 
                        SIP-URI-User check item value from user part of
			To/From URI.
			</p>
                </li>
              </ul>
            </div>
            <p>
		This function can be used from REQUEST_ROUTE.
		</p>
            <div class="example">
              <a id="idp70112"></a>
              <p class="title">
                <strong>Example¬†1.8.¬†<code class="function">proxy_authorize</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
    if (!radius_proxy_authorize("$pd", "$pU")) { # Realm and URI user are taken
        switch ($rc) {                           # from P-Preferred-Identity
        case -7:                                 # header field
	    send_reply("500", "Server Internal Error");
	    exit;
        case -1:
	    send_reply("400", "Bad Request");
	    exit;
        default:
        };
        if (defined($avp(digest_challenge)) &amp;&amp;
                ($avp(digest_challenge) != "")) {
            append_to_reply("$avp(digest_challenge)");
        };
        send_reply("407", "Proxy Authentication Required");
        exit;
    };
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
