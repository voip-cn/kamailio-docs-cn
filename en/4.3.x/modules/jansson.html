<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>JANSSON Module</title>
    <link rel="stylesheet" type="text/css" href="../../../../css/sr-doc.css" tppabs="http://kamailio.org/css/sr-doc.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.76.1" />
    <link rel="home" href="#idp208" title="JANSSON Module" />
    <link rel="next" href="#idp2948640" title="Chapter 1. Admin Guide" />
  </head>
  <body>
    <div class="book" title="JANSSON Module">
      <div class="titlepage">
        <div>
          <div>
            <h1 class="title"><a id="idp208"></a>JANSSON Module</h1>
          </div>
          <div>
            <div class="authorgroup">
              <div class="author">
                <h3 class="author"><span class="firstname">Joe</span> <span class="surname">Hillenbrand</span></h3>
                <code class="email">&lt;<a class="email" href="mailto:joe@flowroute.com">joe@flowroute.com</a>&gt;</code>
              </div>
              <div class="editor">
                <h4 class="editedby">Edited by</h4>
                <h3 class="editor"><span class="firstname">Matthew</span> <span class="surname">Williams</span></h3>
                <code class="email">&lt;<a class="email" href="mailto:matthew@flowroute.com">matthew@flowroute.com</a>&gt;</code>
              </div>
            </div>
          </div>
          <div>
            <p class="copyright">Copyright © 2013 Flowroute LLC (flowroute.com)</p>
          </div>
        </div>
        <hr />
      </div>
      <div class="toc">
        <p>
          <strong>Table of Contents</strong>
        </p>
        <dl>
          <dt>
            <span class="chapter">
              <a href="#idp2948640">1. Admin Guide</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="#idp2655024">1. Overview</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="#idp2327904">2. Dependencies</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp2826384">2.1. Kamailio Modules</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp2214952">2.2. External Libraries or Applications</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp1831576">3. Parameters</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp2555632">3.1. </a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp2594816">4. Functions</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp1522280">4.1. 
            <code class="function">jansson_get(key/path, src, dst)</code>
        </a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1148232">4.2. 
            <code class="function">jansson_set(type, key/path, value, result)</code>
        </a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp262272">4.3. 
            <code class="function">jansson_append(type, key/path, value, result)</code>
        </a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp178328">4.4. 
            <code class="function">jansson_array_size(key/path, src, dst)</code>
        </a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp182336">4.5. 
            <code class="function">jansson_get_field(src, field_name, dst)</code>
        </a>
                    </span>
                  </dt>
                </dl>
              </dd>
            </dl>
          </dd>
        </dl>
      </div>
      <div class="list-of-examples">
        <p>
          <strong>List of Examples</strong>
        </p>
        <dl>
          <dt>1.1. <a href="#idp1803920"><code class="function">jansson_get</code> usage</a></dt>
          <dt>1.2. <a href="#idp260240"><code class="function">jansson_set</code> usage</a></dt>
          <dt>1.3. <a href="#idp263800"><code class="function">jansson_append</code> usage</a></dt>
          <dt>1.4. <a href="#idp179672"><code class="function">jansson_array_size</code> usage</a></dt>
          <dt>1.5. <a href="#idp181088">array concatination</a></dt>
          <dt>1.6. <a href="#idp184280"><code class="function">jansson_get_field</code> usage</a></dt>
        </dl>
      </div>
      <div class="chapter" title="Chapter 1. Admin Guide">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="idp2948640"></a>Chapter 1. Admin Guide</h2>
            </div>
          </div>
        </div>
        <div class="toc">
          <p>
            <strong>Table of Contents</strong>
          </p>
          <dl>
            <dt>
              <span class="section">
                <a href="#idp2655024">1. Overview</a>
              </span>
            </dt>
            <dt>
              <span class="section">
                <a href="#idp2327904">2. Dependencies</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp2826384">2.1. Kamailio Modules</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp2214952">2.2. External Libraries or Applications</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp1831576">3. Parameters</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp2555632">3.1. </a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp2594816">4. Functions</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp1522280">4.1. 
            <code class="function">jansson_get(key/path, src, dst)</code>
        </a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1148232">4.2. 
            <code class="function">jansson_set(type, key/path, value, result)</code>
        </a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp262272">4.3. 
            <code class="function">jansson_append(type, key/path, value, result)</code>
        </a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp178328">4.4. 
            <code class="function">jansson_array_size(key/path, src, dst)</code>
        </a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp182336">4.5. 
            <code class="function">jansson_get_field(src, field_name, dst)</code>
        </a>
                  </span>
                </dt>
              </dl>
            </dd>
          </dl>
        </div>
        <div class="section" title="1. Overview">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp2655024"></a>1. Overview</h2>
              </div>
            </div>
          </div>
          <p>
		This module provides operations on JSON strings using JANSSON
		library. It has support for JSON-PATH operations.
    </p>
        </div>
        <div class="section" title="2. Dependencies">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp2327904"></a>2. Dependencies</h2>
              </div>
            </div>
          </div>
          <div class="section" title="2.1. Kamailio Modules">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp2826384"></a>2.1. Kamailio Modules</h3>
                </div>
              </div>
            </div>
            <p>
        The following modules must be loaded before this module:
            </p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
                <span class="emphasis"><em>None</em></span>
            </p>
                </li>
              </ul>
            </div>
            <p>
        </p>
          </div>
          <div class="section" title="2.2. External Libraries or Applications">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp2214952"></a>2.2. External Libraries or Applications</h3>
                </div>
              </div>
            </div>
            <p>
        The following libraries or applications must be installed before running
        Kamailio with this module loaded:
            </p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
                <span class="emphasis"><em>jansson (http://www.digip.org/jansson/)</em></span>, tested with: 2.2+
            </p>
                </li>
              </ul>
            </div>
            <p>
        </p>
          </div>
        </div>
        <div class="section" title="3. Parameters">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp1831576"></a>3. Parameters</h2>
              </div>
            </div>
          </div>
          <div class="section" title="3.1. ">
            <div class="titlepage"></div>
            <p>
            <span class="emphasis"><em>None</em></span>
        </p>
          </div>
        </div>
        <div class="section" title="4. Functions">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp2594816"></a>4. Functions</h2>
              </div>
            </div>
          </div>
          <div class="section" title="4.1.  jansson_get(key/path, src, dst)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1522280"></a>4.1. 
            <code class="function">jansson_get(key/path, src, dst)</code>
        </h3>
                </div>
              </div>
            </div>
            <p>
            Copy the value at the location 'path' from the json object 'src' and store it in pvar 'dst'.
        </p>
            <p>
            The path string supports dot delimited notation (e.g. foo.bar.baz), array notation (e.g. [0]), or a combination of the two (e.g. foo.bar[0][1].baz).
        </p>
            <p>
            The function can put a string, integer, null, or new json string into destination.
        </p>
            <div class="example">
              <a id="idp1803920"></a>
              <p class="title">
                <strong>Example 1.1. <code class="function">jansson_get</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
jansson_get("inner.deep.list[3]", $var(myjson), "$var(n)");
xlog("foo is $var(n)");
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.2.  jansson_set(type, key/path, value, result)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1148232"></a>4.2. 
            <code class="function">jansson_set(type, key/path, value, result)</code>
        </h3>
                </div>
              </div>
            </div>
            <p>
            Insert 'value' as 'type' at location 'path' into 'result'.
        </p>
            <p>
            The path string works the same as in jansson_get.
        </p>
            <p>
            Valid 'type' parameters are 'integer', 'real', 'string', 'object', 'array', 'true', 'false', and 'null'  as well as
            abbriviated names such as 'int', 'str', and 'obj'. 'value' is ignored when type is 'true', 'false', or 'null'.
        </p>
            <div class="example">
              <a id="idp260240"></a>
              <p class="title">
                <strong>Example 1.2. <code class="function">jansson_set</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
# create a new json object and put a string in it at key "mystr"
jansson_set("string", "mystr", "my input string", "$var(myjson)");
# $var(myjson) =='{"mystr":"my input string"}'

# add other values
jansson_set("integer", "count", 9000, "$var(myjson)");
jansson_set("true", "mybool", 0, "$var(myjson)");
jansson_set("real", "pi", "3.14159", "$var(myjson)");
# $var(myjson) == '{"mystr":"my input string", "count":9000, "mybool":true, "pi":3.14159}'

# add a nested object
jansson_set("obj", "myobj", '{"foo":"bar"}', "$var(myjson)");
# $var(myjson) =='{"mystr":"my input string", "count":9000, "mybool":true, "pi":3.14159, "myobj":{"foo":"bar"}}'

# change the nested object
jansson_set("str", "myobj.foo", "baz", "$var(myjson)");
# $var(myjson) == '{"mystr":"my input string", "count":9000, "mybool":true, "pi":3.14159, "myobj":{"foo":"baz"}}'
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.3.  jansson_append(type, key/path, value, result)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp262272"></a>4.3. 
            <code class="function">jansson_append(type, key/path, value, result)</code>
        </h3>
                </div>
              </div>
            </div>
            <p>
            Like jansson_set but can be used to append to arrays. It can also be used to combine two json objects.
        </p>
            <p>
            Note that when appending a json object to another json object, if there is a key that is shared between the two objects, that value will be overwritten by the new object.
        </p>
            <div class="example">
              <a id="idp263800"></a>
              <p class="title">
                <strong>Example 1.3. <code class="function">jansson_append</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
# create a new json array and append values to it
$var(myarray) = '[]';
jansson_append("int", "", 0, "$var(myarray)");
jansson_append("int", "", 1, "$var(myarray)");
jansson_append("int", "", 2, "$var(myarray)");
jansson_append("int", "", 3, "$var(myarray)");
jansson_append("int", "", 4, "$var(myarray)");
# $var(myarray) == '[0,1,2,3,4]'

# add that array to an object
jansson_set("array", "list", $var(myarray), "$var(myjson)");
# $var(myjson) == '{"list":[0,1,2,3,4]}'

# append another value to the list
jansson_append("int", "list", 5, "$var(myjson)");
# $var(myjson) == '{"list":[0,1,2,3,4,5]}'

# combining two json objects
$var(newobj) = '{"b":2, "c":3}';
jansson_append('obj', "", '{"a":1, "b":100}', "$var(newobj)");
# $var(newobj) == '{"a":1,"b":100","c":3}';
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.4.  jansson_array_size(key/path, src, dst)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp178328"></a>4.4. 
            <code class="function">jansson_array_size(key/path, src, dst)</code>
        </h3>
                </div>
              </div>
            </div>
            <p>
            Puts the size of the array in 'src' at location 'path' into the pvar 'dst'.
        </p>
            <p>
            This is particularly useful for looping through an array. See example.
        </p>
            <div class="example">
              <a id="idp179672"></a>
              <p class="title">
                <strong>Example 1.4. <code class="function">jansson_array_size</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
$var(array) = "{\"loopme\":[0,1,2,3,4,5]}";
$var(count) = 0;
jansson_array_size("loopme", $var(array), "$var(size)");
while($var(count) &lt; $var(size)) {
    jansson_get("loopme[$var(count)]", $var(array), "$var(v)");
    xlog("loopme[$var(count)] == $var(v)\n");
    $var(count) = $var(count) + 1;
}
...</pre>
              </div>
            </div>
            <br class="example-break" />
            <div class="example">
              <a id="idp181088"></a>
              <p class="title">
                <strong>Example 1.5. array concatination</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
$var(count) = 0;
$var(appendme) = '[0,1]';
$var(mylist) = '[2,3,4,5]';
jansson_array_size("", $var(mylist), "$var(appendme_size)");
while($var(count) &lt; $var(appendme_size)) {
    jansson_get("[$var(count)]", $var(mylist), "$var(tmp)");
    jansson_append('int', "", $var(tmp), "$var(appendme)");
    $var(count) = $var(count) + 1;
}
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.5.  jansson_get_field(src, field_name, dst)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp182336"></a>4.5. 
            <code class="function">jansson_get_field(src, field_name, dst)</code>
        </h3>
                </div>
              </div>
            </div>
            <p>
            Copy field 'field_name' from json object 'src' and store it in pvar 'dst'.
        </p>
            <p>
            <span class="emphasis"><em>This function is deprecated</em></span> but kept for backwards compatibility. Right now it is just a wrapper around <code class="function">jansson_get</code>, and its functionality is the same.
        </p>
            <div class="example">
              <a id="idp184280"></a>
              <p class="title">
                <strong>Example 1.6. <code class="function">jansson_get_field</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
jansson_get_field("{'foo':'bar'}", "foo", "$var(foo)");
xlog("foo is $var(foo)");
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
