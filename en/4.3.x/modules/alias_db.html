<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>ALIAS_DB Module</title>
    <link rel="stylesheet" type="text/css" href="../../../../css/sr-doc.css" tppabs="http://kamailio.org/css/sr-doc.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.76.1" />
    <link rel="home" href="#idp15536168" title="ALIAS_DB Module" />
    <link rel="next" href="#idp18159760" title="Chapter 1. Admin Guide" />
  </head>
  <body>
    <div class="book" title="ALIAS_DB Module">
      <div class="titlepage">
        <div>
          <div>
            <h1 class="title"><a id="idp15536168"></a>ALIAS_DB Module</h1>
          </div>
          <div>
            <div class="authorgroup">
              <div class="author">
                <h3 class="author"><span class="firstname">Daniel-Constantin</span> <span class="surname">Mierla</span></h3>
                <code class="email">&lt;<a class="email" href="mailto:miconda@gmail.com">miconda@gmail.com</a>&gt;</code>
              </div>
              <div class="author">
                <h3 class="author"><span class="firstname">Elena-Ramona</span> <span class="surname">Modroiu</span></h3>
                <code class="email">&lt;<a class="email" href="mailto:ramona@asipto.com">ramona@asipto.com</a>&gt;</code>
              </div>
              <div class="editor">
                <h4 class="editedby">Edited by</h4>
                <h3 class="editor"><span class="firstname">Daniel-Constantin</span> <span class="surname">Mierla</span></h3>
                <code class="email">&lt;<a class="email" href="mailto:miconda@gmail.com">miconda@gmail.com</a>&gt;</code>
              </div>
            </div>
          </div>
          <div>
            <p class="copyright">Copyright © 2005 Voice Sistem SRL</p>
          </div>
          <div>
            <p class="copyright">Copyright © 2008 asipto.com</p>
          </div>
        </div>
        <hr />
      </div>
      <div class="toc">
        <p>
          <strong>Table of Contents</strong>
        </p>
        <dl>
          <dt>
            <span class="chapter">
              <a href="#idp18159760">1. Admin Guide</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="#idp18487432">1. Overview</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="#idp18032032">2. Dependencies</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp17597080">2.1. Kamailio Modules</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp16686184">2.2. External Libraries or Applications</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp18114264">3. Parameters</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp17293024">3.1. <code class="varname">db_url</code> (str)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp18090768">3.2. <code class="varname">user_column</code> (str)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp15516464">3.3. <code class="varname">domain_column</code> (str)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp15519056">3.4. <code class="varname">alias_user_column</code> (str)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp15521688">3.5. <code class="varname">alias_domain_column</code> (str)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp15524320">3.6. <code class="varname">use_domain</code> (int)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp15527048">3.7. <code class="varname">domain_prefix</code> (str)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp15529712">3.8. <code class="varname">append_branches</code> (int)</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp15710584">4. Functions</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp15710952">4.1. 
		<code class="function">alias_db_lookup(table_name)</code>
		</a>
                    </span>
                  </dt>
                </dl>
              </dd>
            </dl>
          </dd>
        </dl>
      </div>
      <div class="list-of-examples">
        <p>
          <strong>List of Examples</strong>
        </p>
        <dl>
          <dt>1.1. <a href="#idp18010200">Set <code class="varname">db_url</code> parameter</a></dt>
          <dt>1.2. <a href="#idp15797160">Set <code class="varname">user_column</code> parameter</a></dt>
          <dt>1.3. <a href="#idp15517880">Set <code class="varname">domain_column</code> parameter</a></dt>
          <dt>1.4. <a href="#idp15520504">Set <code class="varname">alias_user_column</code> parameter</a></dt>
          <dt>1.5. <a href="#idp15523136">Set <code class="varname">alias_domain_column</code> parameter</a></dt>
          <dt>1.6. <a href="#idp15525888">Set <code class="varname">use_domain</code> parameter</a></dt>
          <dt>1.7. <a href="#idp15528536">Set <code class="varname">domain_prefix</code> parameter</a></dt>
          <dt>1.8. <a href="#idp15531256">Set <code class="varname">append_branches</code> parameter</a></dt>
          <dt>1.9. <a href="#idp15713744"><code class="function">alias_db_lookup()</code> usage</a></dt>
        </dl>
      </div>
      <div class="chapter" title="Chapter 1. Admin Guide">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="idp18159760"></a>Chapter 1. Admin Guide</h2>
            </div>
          </div>
        </div>
        <div class="toc">
          <p>
            <strong>Table of Contents</strong>
          </p>
          <dl>
            <dt>
              <span class="section">
                <a href="#idp18487432">1. Overview</a>
              </span>
            </dt>
            <dt>
              <span class="section">
                <a href="#idp18032032">2. Dependencies</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp17597080">2.1. Kamailio Modules</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp16686184">2.2. External Libraries or Applications</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp18114264">3. Parameters</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp17293024">3.1. <code class="varname">db_url</code> (str)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp18090768">3.2. <code class="varname">user_column</code> (str)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp15516464">3.3. <code class="varname">domain_column</code> (str)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp15519056">3.4. <code class="varname">alias_user_column</code> (str)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp15521688">3.5. <code class="varname">alias_domain_column</code> (str)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp15524320">3.6. <code class="varname">use_domain</code> (int)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp15527048">3.7. <code class="varname">domain_prefix</code> (str)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp15529712">3.8. <code class="varname">append_branches</code> (int)</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp15710584">4. Functions</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp15710952">4.1. 
		<code class="function">alias_db_lookup(table_name)</code>
		</a>
                  </span>
                </dt>
              </dl>
            </dd>
          </dl>
        </div>
        <div class="section" title="1. Overview">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp18487432"></a>1. Overview</h2>
              </div>
            </div>
          </div>
          <p>
	The ALIAS_DB module can be used as an alternative for user aliases
	via usrloc. The main feature is that it does not store all addiacent
	data as for user location and always uses the database for search (no
	memory caching). A common use case is to provide additional user
	aliases, i.e. to supplement the registration in the location database.
	Users are this way on a proxy reachable with several request URIs.
	</p>
          <p>
	As the module use no memory caching the lookup is a bit slower but the
	data provisioning is easier. With very fast databases like MySQL the speed
	penalty can be lowered. Also, the search can be performed on different
	tables in the same script.
	</p>
        </div>
        <div class="section" title="2. Dependencies">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp18032032"></a>2. Dependencies</h2>
              </div>
            </div>
          </div>
          <div class="section" title="2.1. Kamailio Modules">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp17597080"></a>2.1. Kamailio Modules</h3>
                </div>
              </div>
            </div>
            <p>
		The following modules must be loaded before this module:
			</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
				<span class="emphasis"><em>database module</em></span> (mysql, dbtext, ...).
			</p>
                </li>
              </ul>
            </div>
            <p>
		</p>
          </div>
          <div class="section" title="2.2. External Libraries or Applications">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp16686184"></a>2.2. External Libraries or Applications</h3>
                </div>
              </div>
            </div>
            <p>
		The following libraries or applications must be installed before 
		running Kamailio with this module loaded:
			</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
				<span class="emphasis"><em>None</em></span>.
			</p>
                </li>
              </ul>
            </div>
            <p>
		</p>
          </div>
        </div>
        <div class="section" title="3. Parameters">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp18114264"></a>3. Parameters</h2>
              </div>
            </div>
          </div>
          <div class="section" title="3.1. db_url (str)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp17293024"></a>3.1. <code class="varname">db_url</code> (str)</h3>
                </div>
              </div>
            </div>
            <p>
		Database URL.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">mysql://kamailioro:kamailioro@localhost/kamailio</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp18010200"></a>
              <p class="title">
                <strong>Example 1.1. Set <code class="varname">db_url</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("alias_db", "db_url", "dbdriver://username:password@dbhost/dbname")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.2. user_column (str)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp18090768"></a>3.2. <code class="varname">user_column</code> (str)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column storing username.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">username</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp15797160"></a>
              <p class="title">
                <strong>Example 1.2. Set <code class="varname">user_column</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("alias_db", "user_column", "susername")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.3. domain_column (str)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp15516464"></a>3.3. <code class="varname">domain_column</code> (str)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column storing user's domain.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">domain</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp15517880"></a>
              <p class="title">
                <strong>Example 1.3. Set <code class="varname">domain_column</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("alias_db", "domain_column", "sdomain")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.4. alias_user_column (str)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp15519056"></a>3.4. <code class="varname">alias_user_column</code> (str)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column storing alias username.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">alias_username</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp15520504"></a>
              <p class="title">
                <strong>Example 1.4. Set <code class="varname">alias_user_column</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("alias_db", "alias_user_column", "auser")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.5. alias_domain_column (str)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp15521688"></a>3.5. <code class="varname">alias_domain_column</code> (str)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column storing alias domain.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">alias_domain</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp15523136"></a>
              <p class="title">
                <strong>Example 1.5. Set <code class="varname">alias_domain_column</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("alias_db", "alias_domain_column", "adomain")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.6. use_domain (int)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp15524320"></a>3.6. <code class="varname">use_domain</code> (int)</h3>
                </div>
              </div>
            </div>
            <p>
		Specifies whether to use or not the domain from R-URI when searching
		for alias. If set to 0, the domain from R-URI is not used, if set to
		1 the domain from R-URI is used.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">0</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp15525888"></a>
              <p class="title">
                <strong>Example 1.6. Set <code class="varname">use_domain</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("alias_db", "use_domain", 1)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.7. domain_prefix (str)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp15527048"></a>3.7. <code class="varname">domain_prefix</code> (str)</h3>
                </div>
              </div>
            </div>
            <p>
		Specifies the prefix to be stripped from the domain in R-URI before
		doing the search.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">NULL</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp15528536"></a>
              <p class="title">
                <strong>Example 1.7. Set <code class="varname">domain_prefix</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("alias_db", "domain_prefix", "sip.")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.8. append_branches (int)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp15529712"></a>3.8. <code class="varname">append_branches</code> (int)</h3>
                </div>
              </div>
            </div>
            <p>
			If the alias resolves to many SIP IDs, the first is replacing
			the R-URI, the rest are added as branches.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">0</span>”</span> (0 - don't add branches;
			1 - add branches).
		</em></span>
		</p>
            <div class="example">
              <a id="idp15531256"></a>
              <p class="title">
                <strong>Example 1.8. Set <code class="varname">append_branches</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("alias_db", "append_branches", 1)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
        <div class="section" title="4. Functions">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp15710584"></a>4. Functions</h2>
              </div>
            </div>
          </div>
          <div class="section" title="4.1.  alias_db_lookup(table_name)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp15710952"></a>4.1. 
		<code class="function">alias_db_lookup(table_name)</code>
		</h3>
                </div>
              </div>
            </div>
            <p>
		The function takes the R-URI and search to see whether it is an alias
		or not. If it is an alias for a local user, the R-URI is replaced with
		user's SIP uri.
		</p>
            <p>
		The function returns TRUE if R-URI is alias and it was replaced by
		user's SIP uri.
		</p>
            <p>Meaning of the parameters is as follows:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p><span class="emphasis"><em>table_name</em></span> - the name of the table
				where to search for alias. It can include pseudo-variables.
			</p>
                </li>
              </ul>
            </div>
            <p>
		This function can be used from REQUEST_ROUTE, FAILURE_ROUTE.
		</p>
            <div class="example">
              <a id="idp15713744"></a>
              <p class="title">
                <strong>Example 1.9. <code class="function">alias_db_lookup()</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
alias_db_lookup("dbaliases");
alias_db_lookup("dba_$(rU{s.substr,0,1})");
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
