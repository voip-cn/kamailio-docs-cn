<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>SipTrace Module</title>
    <link rel="stylesheet" type="text/css" href="../../../../css/sr-doc.css" tppabs="http://kamailio.org/css/sr-doc.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.76.1" />
    <link rel="home" href="#idp15478456" title="SipTrace Module" />
    <link rel="next" href="#idp18303176" title="Chapter¬†1.¬†Admin Guide" />
  </head>
  <body>
    <div class="book" title="SipTrace Module">
      <div class="titlepage">
        <div>
          <div>
            <h1 class="title"><a id="idp15478456"></a>SipTrace Module</h1>
          </div>
          <div>
            <div class="authorgroup">
              <div class="author">
                <h3 class="author"><span class="firstname">Daniel-Constantin</span> <span class="surname">Mierla</span></h3>
                <code class="email">&lt;<a class="email" href="mailto:miconda@gmail.com">miconda@gmail.com</a>&gt;</code>
              </div>
              <div class="editor">
                <h4 class="editedby">Edited by</h4>
                <h3 class="editor"><span class="firstname">Alexandr</span> <span class="surname">Dubovikov</span></h3>
                <code class="email">&lt;<a class="email" href="mailto:alexandr.dubovikov@gmail.com">alexandr.dubovikov@gmail.com</a>&gt;</code>
              </div>
              <div class="editor">
                <h4 class="editedby">Edited by</h4>
                <h3 class="editor"><span class="firstname">Daniel-Constantin</span> <span class="surname">Mierla</span></h3>
                <code class="email">&lt;<a class="email" href="mailto:miconda@gmail.com">miconda@gmail.com</a>&gt;</code>
              </div>
            </div>
          </div>
          <div>
            <p class="copyright">Copyright ¬© 2010 asipto.com</p>
          </div>
          <div>
            <p class="copyright">Copyright ¬© 2006 voice-system.ro</p>
          </div>
        </div>
        <hr />
      </div>
      <div class="toc">
        <p>
          <strong>Table of Contents</strong>
        </p>
        <dl>
          <dt>
            <span class="chapter">
              <a href="#idp18303176">1. Admin Guide</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="#idp18291648">1. Overview</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="#idp16867680">2. Dependencies</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp18293096">2.1. Kamailio Modules</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp17717736">2.2. External Libraries or Applications</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp17890008">3. Parameters</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.db_url">3.1. <code class="varname">db_url</code> (str)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.table">3.2. <code class="varname">table</code> (str)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.trace_flag">3.3. <code class="varname">trace_flag</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.trace_on">3.4. <code class="varname">trace_on</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.traced_user_avp">3.5. <code class="varname">traced_user_avp</code> (str)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.trace_table_avp">3.6. <code class="varname">trace_table_avp</code> (str)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.duplicate_uri">3.7. <code class="varname">duplicate_uri</code> (str)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.trace_to_database">3.8. <code class="varname">trace_to_database</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.trace_local_ip">3.9. <code class="varname">trace_local_ip</code> (str)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.trace_sl_acks">3.10. <code class="varname">trace_sl_acks</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.xheaders_write">3.11. <code class="varname">xheaders_write</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.xheaders_read">3.12. <code class="varname">xheaders_read</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.hep_mode_on">3.13. <code class="varname">hep_mode_on</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.hep_version">3.14. <code class="varname">hep_version</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.hep_capture_id">3.15. <code class="varname">hep_capture_id</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.trace_delayed">3.16. <code class="varname">trace_delayed</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.p.force_send_sock">3.17. <code class="varname">force_send_sock</code> (str)</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp18190848">4. Functions</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.f.sip_trace">4.1. 
		<code class="function">sip_trace([address])</code>
		</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp18010064">5. MI Commands</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.m.sip_trace">5.1. 
		<code class="function">sip_trace</code>
		</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp15721024">6. RPC Commands</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#siptrace.r.siptrace.status">6.1. 
		<code class="function">siptrace.status param</code>
		</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp15725832">7. Database setup</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="#idp15449832">8. Known issues</a>
                </span>
              </dt>
            </dl>
          </dd>
        </dl>
      </div>
      <div class="list-of-examples">
        <p>
          <strong>List of Examples</strong>
        </p>
        <dl>
          <dt>1.1. <a href="#idp18671424">Set <code class="varname">db_url</code> parameter</a></dt>
          <dt>1.2. <a href="#idp19017960">Set <code class="varname">sip_trace</code> parameter</a></dt>
          <dt>1.3. <a href="#idp17231728">Set <code class="varname">trace_flag</code> parameter</a></dt>
          <dt>1.4. <a href="#idp18453184">Set <code class="varname">trace_on</code> parameter</a></dt>
          <dt>1.5. <a href="#idp18246160">Set <code class="varname">traced_user_avp</code> parameter</a></dt>
          <dt>1.6. <a href="#idp18790736">Set <code class="varname">trace_table_avp</code> parameter</a></dt>
          <dt>1.7. <a href="#idp18228056">Set <code class="varname">duplicate_uri</code> parameter</a></dt>
          <dt>1.8. <a href="#idp18264680">Set <code class="varname">trace_to_database</code> parameter</a></dt>
          <dt>1.9. <a href="#idp17912472">Set <code class="varname">trace_local_ip</code> parameter</a></dt>
          <dt>1.10. <a href="#idp17793400">Set <code class="varname">trace_sl_acks</code> parameter</a></dt>
          <dt>1.11. <a href="#idp18773656">Set <code class="varname">xheaders_write</code> parameter</a></dt>
          <dt>1.12. <a href="#idp18670760">Set <code class="varname">xheaders_read</code> parameter</a></dt>
          <dt>1.13. <a href="#idp19048312">Set <code class="varname">hep_mode_on</code> parameter</a></dt>
          <dt>1.14. <a href="#idp18464248">Set <code class="varname">hep_version</code> parameter</a></dt>
          <dt>1.15. <a href="#idp17936824">Set <code class="varname">hep_capture_id</code>
                parameter</a></dt>
          <dt>1.16. <a href="#idp18159528">Set <code class="varname">trace_delayed</code>
                parameter</a></dt>
          <dt>1.17. <a href="#idp18726144">Set <code class="varname">force_send_sock</code> parameter</a></dt>
          <dt>1.18. <a href="#idp17494936"><code class="function">sip_trace()</code> usage</a></dt>
        </dl>
      </div>
      <div class="chapter" title="Chapter¬†1.¬†Admin Guide">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="idp18303176"></a>Chapter¬†1.¬†Admin Guide</h2>
            </div>
          </div>
        </div>
        <div class="toc">
          <p>
            <strong>Table of Contents</strong>
          </p>
          <dl>
            <dt>
              <span class="section">
                <a href="#idp18291648">1. Overview</a>
              </span>
            </dt>
            <dt>
              <span class="section">
                <a href="#idp16867680">2. Dependencies</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp18293096">2.1. Kamailio Modules</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp17717736">2.2. External Libraries or Applications</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp17890008">3. Parameters</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.db_url">3.1. <code class="varname">db_url</code> (str)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.table">3.2. <code class="varname">table</code> (str)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.trace_flag">3.3. <code class="varname">trace_flag</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.trace_on">3.4. <code class="varname">trace_on</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.traced_user_avp">3.5. <code class="varname">traced_user_avp</code> (str)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.trace_table_avp">3.6. <code class="varname">trace_table_avp</code> (str)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.duplicate_uri">3.7. <code class="varname">duplicate_uri</code> (str)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.trace_to_database">3.8. <code class="varname">trace_to_database</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.trace_local_ip">3.9. <code class="varname">trace_local_ip</code> (str)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.trace_sl_acks">3.10. <code class="varname">trace_sl_acks</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.xheaders_write">3.11. <code class="varname">xheaders_write</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.xheaders_read">3.12. <code class="varname">xheaders_read</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.hep_mode_on">3.13. <code class="varname">hep_mode_on</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.hep_version">3.14. <code class="varname">hep_version</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.hep_capture_id">3.15. <code class="varname">hep_capture_id</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.trace_delayed">3.16. <code class="varname">trace_delayed</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#siptrace.p.force_send_sock">3.17. <code class="varname">force_send_sock</code> (str)</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp18190848">4. Functions</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#siptrace.f.sip_trace">4.1. 
		<code class="function">sip_trace([address])</code>
		</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp18010064">5. MI Commands</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#siptrace.m.sip_trace">5.1. 
		<code class="function">sip_trace</code>
		</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp15721024">6. RPC Commands</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#siptrace.r.siptrace.status">6.1. 
		<code class="function">siptrace.status param</code>
		</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp15725832">7. Database setup</a>
              </span>
            </dt>
            <dt>
              <span class="section">
                <a href="#idp15449832">8. Known issues</a>
              </span>
            </dt>
          </dl>
        </div>
        <div class="section" title="1.¬†Overview">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp18291648"></a>1.¬†Overview</h2>
              </div>
            </div>
          </div>
          <p>
		The SIPtrace module offer a possibility to store incoming and outgoing SIP
		messages in a database and/or duplicate to the capturing server (using <acronym class="acronym">HEP</acronym>
		the Homer encapsulation protocol or plain SIP mode)
	</p>
          <p>
		There are two ways of storing information:
		</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
                <p>
		by calling the sip_trace() method explicitely in the Kamailio configuration
		file. In this case the original message is processed.
		</p>
              </li>
              <li class="listitem">
                <p>
		by setting the flag equal with the value of <span class="quote">‚Äú<span class="quote">trace_flag</span>‚Äù</span> (e.g.,
		setflag(__trace_flag__)) parameter of the module. In this case, the
		message sent forward is processed. The logging mechanism is based on
		TM/SL callbacks, so only messages processed with the TM module or sent statelessly
		are logged.
		</p>
              </li>
            </ul>
          </div>
          <p>
	</p>
          <p>
	The tracing can be turned on/off using Kamailio <acronym class="acronym">mi</acronym> or <acronym class="acronym">RPC</acronym>
	commands.
	</p>
          <p>
	kamctl fifo sip_trace on
	</p>
          <p>
	kamctl fifo sip_trace off
	</p>
        </div>
        <div class="section" title="2.¬†Dependencies">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp16867680"></a>2.¬†Dependencies</h2>
              </div>
            </div>
          </div>
          <div class="section" title="2.1.¬†Kamailio Modules">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp18293096"></a>2.1.¬†Kamailio Modules</h3>
                </div>
              </div>
            </div>
            <p>
		The following modules must be loaded before this module:
			</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
				<span class="emphasis"><em>A database module</em></span> - Mysql, Postgres,
				dbtext, unixODBC...
			</p>
                </li>
                <li class="listitem">
                  <p>
				<span class="emphasis"><em>tm and sl modules</em></span> - optional, only if
				you want to trace messages forwarded by these modules.
			</p>
                </li>
              </ul>
            </div>
            <p>
		</p>
          </div>
          <div class="section" title="2.2.¬†External Libraries or Applications">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp17717736"></a>2.2.¬†External Libraries or Applications</h3>
                </div>
              </div>
            </div>
            <p>
		The following libraries or applications must be installed before running
		Kamailio with this module loaded:
			</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
				<span class="emphasis"><em>None</em></span>.
			</p>
                </li>
              </ul>
            </div>
            <p>
		</p>
          </div>
        </div>
        <div class="section" title="3.¬†Parameters">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp17890008"></a>3.¬†Parameters</h2>
              </div>
            </div>
          </div>
          <div class="section" title="3.1.¬†db_url (str)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.db_url"></a>3.1.¬†<code class="varname">db_url</code> (str)</h3>
                </div>
              </div>
            </div>
            <p>
		Database URL.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is "mysql://kamailio:kamailiorw@localhost/okamailio".
		</em></span>
		</p>
            <div class="example">
              <a id="idp18671424"></a>
              <p class="title">
                <strong>Example¬†1.1.¬†Set <code class="varname">db_url</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "db_url", "mysql://user:passwd@host/dbname")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.2.¬†table (str)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.table"></a>3.2.¬†<code class="varname">table</code> (str)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the table where to store the SIP messages.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">‚Äú<span class="quote">sip_trace</span>‚Äù</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp19017960"></a>
              <p class="title">
                <strong>Example¬†1.2.¬†Set <code class="varname">sip_trace</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "table", "strace")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.3.¬†trace_flag (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.trace_flag"></a>3.3.¬†<code class="varname">trace_flag</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Which flag is used to mark messages to trace without
		traced user.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is "0".
		</em></span>
		</p>
            <div class="example">
              <a id="idp17231728"></a>
              <p class="title">
                <strong>Example¬†1.3.¬†Set <code class="varname">trace_flag</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "trace_flag", 22)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.4.¬†trace_on (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.trace_on"></a>3.4.¬†<code class="varname">trace_on</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Parameter to enable/disable trace (on(1)/off(0))
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is "0".
		</em></span>
		</p>
            <div class="example">
              <a id="idp18453184"></a>
              <p class="title">
                <strong>Example¬†1.4.¬†Set <code class="varname">trace_on</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "trace_on", 1)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.5.¬†traced_user_avp (str)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.traced_user_avp"></a>3.5.¬†<code class="varname">traced_user_avp</code> (str)</h3>
                </div>
              </div>
            </div>
            <p>
		The name of the <acronym class="acronym">AVP</acronym> storing the SIP URI of the traced user. If
		the AVP is set, messages are stored in database table and
		the <span class="quote">‚Äú<span class="quote">traced_user</span>‚Äù</span> column is filled with AVP's value. You can store
		the message many times for many users by having multiple values
		for this AVP.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is "NULL" (feature disabled).
		</em></span>
		</p>
            <div class="example">
              <a id="idp18246160"></a>
              <p class="title">
                <strong>Example¬†1.5.¬†Set <code class="varname">traced_user_avp</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "traced_user_avp", "$avp(i:123)")
modparam("siptrace", "traced_user_avp", "$avp(s:user)")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.6.¬†trace_table_avp (str)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.trace_table_avp"></a>3.6.¬†<code class="varname">trace_table_avp</code> (str)</h3>
                </div>
              </div>
            </div>
            <p>
		The name of the AVP storing the name of the table where to
		store the SIP messages. If it is not set, the value of
		<span class="quote">‚Äú<span class="quote">table</span>‚Äù</span> parameter is used. In this way one can select
		dynamically where to store the traced messages. The table
		must exists, and must have the same structure as the <span class="quote">‚Äú<span class="quote">sip_trace</span>‚Äù</span>
		table.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is "NULL" (feature disabled).
		</em></span>
		</p>
            <div class="example">
              <a id="idp18790736"></a>
              <p class="title">
                <strong>Example¬†1.6.¬†Set <code class="varname">trace_table_avp</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "trace_table_avp", "$avp(i:345)")
modparam("siptrace", "trace_table_avp", "$avp(s:siptrace_table)")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.7.¬†duplicate_uri (str)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.duplicate_uri"></a>3.7.¬†<code class="varname">duplicate_uri</code> (str)</h3>
                </div>
              </div>
            </div>
            <p>
		The address in form of a SIP URI where to send a duplicate
		of traced message. It uses UDP all the time.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is "NULL".
		</em></span>
		</p>
            <div class="example">
              <a id="idp18228056"></a>
              <p class="title">
                <strong>Example¬†1.7.¬†Set <code class="varname">duplicate_uri</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "duplicate_uri", "sip:10.1.1.1:5888")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.8.¬†trace_to_database (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.trace_to_database"></a>3.8.¬†<code class="varname">trace_to_database</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Parameter to enable/disable inserts to the database from this
		Kamailio. 
		</p>
            <p>
		In case we only want to send the SIP messages to the 
		<span class="quote">‚Äú<span class="quote">duplicate_uri</span>‚Äù</span> and not store the information to the local 
		database we can set this to "0".  
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is "1".
		</em></span>
		</p>
            <div class="example">
              <a id="idp18264680"></a>
              <p class="title">
                <strong>Example¬†1.8.¬†Set <code class="varname">trace_to_database</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "trace_to_database", 0)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.9.¬†trace_local_ip (str)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.trace_local_ip"></a>3.9.¬†<code class="varname">trace_local_ip</code> (str)</h3>
                </div>
              </div>
            </div>
            <p>
		The address to be used in <span class="quote">‚Äú<span class="quote">fromip</span>‚Äù</span> field for
		locally generated messages. If not set, the module sets it to the address
		of the socket that will be used to send the message.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is "NULL".
		</em></span>
		</p>
            <div class="example">
              <a id="idp17912472"></a>
              <p class="title">
                <strong>Example¬†1.9.¬†Set <code class="varname">trace_local_ip</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "trace_local_ip", "10.1.1.1:5064")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.10.¬†trace_sl_acks (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.trace_sl_acks"></a>3.10.¬†<code class="varname">trace_sl_acks</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Parameter to enable/disable tracing of SL-filtered ACKs (on=1
		/ off=0).
		</p>
            <p>
		By default all ACKs to replies generated by SL module are traced. There
		is no way to select among them. The SL module is able to run an event
		route when such an ACK arrives (<span class="emphasis"><em>event_route[sl:filtered-ack]</em></span>).
		You can set this parameter to 0 and then execute sip_trace() in the event route,
		accompanied by config rules to decide which ACK to trace.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is "1".
		</em></span>
		</p>
            <div class="example">
              <a id="idp17793400"></a>
              <p class="title">
                <strong>Example¬†1.10.¬†Set <code class="varname">trace_sl_acks</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "trace_sl_acks", 0)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.11.¬†xheaders_write (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.xheaders_write"></a>3.11.¬†<code class="varname">xheaders_write</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Parameter to enable/disable writing of x-headers.
		</p>
            <p>
		Stores <span class="quote">‚Äú<span class="quote">fromip</span>‚Äù</span>, <span class="quote">‚Äú<span class="quote">toip</span>‚Äù</span>, <span class="quote">‚Äú<span class="quote">method</span>‚Äù</span> and
		<span class="quote">‚Äú<span class="quote">direction</span>‚Äù</span> in <span class="quote">‚Äú<span class="quote">X-Siptrace-*</span>‚Äù</span> headers.
		This allows to transmit them to a second Kamailio server
		using the <span class="quote">‚Äú<span class="quote">duplicate_uri</span>‚Äù</span> feature.
		Because the headers are added after the data is written to the database,
		the headers only show up in the packets sent by duplicate_uri.
		</p>
            <p>
		See <code class="varname">xheaders_read</code>, it should be used on the receiving
		side.
		</p>
            <p>
		<span class="emphasis"><em>Note:</em></span> The headers are first read, then written. This allows 
		relaying the information over more than two Kamailio servers by setting both
		<code class="varname">xheaders_write</code> and <code class="varname">xheaders_read</code>
		to "1" on the servers in the middle.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is "0".
		</em></span>
		</p>
            <div class="example">
              <a id="idp18773656"></a>
              <p class="title">
                <strong>Example¬†1.11.¬†Set <code class="varname">xheaders_write</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "xheaders_write", 0)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.12.¬†xheaders_read (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.xheaders_read"></a>3.12.¬†<code class="varname">xheaders_read</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Parameter to enable/disable reading of x-headers.
		</p>
            <p>
		Reads and removes the <span class="quote">‚Äú<span class="quote">X-Siptrace-*</span>‚Äù</span> headers. Packets not containing the
		headers are neither stored to the database nor relayed (duplicate_uri).
		See <code class="varname">xheaders_write</code> for further information.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is "0".
		</em></span>
		</p>
            <div class="example">
              <a id="idp18670760"></a>
              <p class="title">
                <strong>Example¬†1.12.¬†Set <code class="varname">xheaders_read</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "xheaders_read", 0)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.13.¬†hep_mode_on (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.hep_mode_on"></a>3.13.¬†<code class="varname">hep_mode_on</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
                Parameter to enable/disable Homer encapsulate mode (on(1)/off(0))
                </p>
            <p>
                <span class="emphasis"><em>
                        Default value is "0".
                </em></span>
                </p>
            <div class="example">
              <a id="idp19048312"></a>
              <p class="title">
                <strong>Example¬†1.13.¬†Set <code class="varname">hep_mode_on</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "hep_mode_on", 1)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.14.¬†hep_version (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.hep_version"></a>3.14.¬†<code class="varname">hep_version</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
                The parameter indicate the version of the HEP protocol.
                Can be <span class="quote">‚Äú<span class="quote">1</span>‚Äù</span> or <span class="quote">‚Äú<span class="quote">2</span>‚Äù</span>. In HEPv2 the timestamp and capture agent ID
                will be included to HEP header.
                </p>
            <p>
                <span class="emphasis"><em>
                        Default value is "1".
                </em></span>
                </p>
            <div class="example">
              <a id="idp18464248"></a>
              <p class="title">
                <strong>Example¬†1.14.¬†Set <code class="varname">hep_version</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "hep_version", 2)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.15.¬†hep_capture_id (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.hep_capture_id"></a>3.15.¬†<code class="varname">hep_capture_id</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
                The parameter indicate the capture agent ID for the <acronym class="acronym">HEPv2</acronym>
                protocol.
                Limitation: 16-bit integer.
                </p>
            <p>
                <span class="emphasis"><em>
                        Default value is "1".
                </em></span>
                </p>
            <div class="example">
              <a id="idp17936824"></a>
              <p class="title">
                <strong>Example¬†1.15.¬†Set <code class="varname">hep_capture_id</code>
                parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "hep_capture_id", 234)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.16.¬†trace_delayed (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.trace_delayed"></a>3.16.¬†<code class="varname">trace_delayed</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Use <span class="quote">‚Äú<span class="quote">INSERT DELAYED</span>‚Äù</span> to store to database when it is available,
		instead of <span class="quote">‚Äú<span class="quote">INSERT</span>‚Äù</span>.
                </p>
            <p>
                Default value is <span class="emphasis"><em>0 (off)</em></span>.
                </p>
            <div class="example">
              <a id="idp18159528"></a>
              <p class="title">
                <strong>Example¬†1.16.¬†Set <code class="varname">trace_delayed</code>
                parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "trace_delayed", 1)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.17.¬†force_send_sock (str)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.p.force_send_sock"></a>3.17.¬†<code class="varname">force_send_sock</code> (str)</h3>
                </div>
              </div>
            </div>
            <p>
			The local interface in the form of SIP uri from where to send
			the duplicated traffic. In the absence of this parameter
			Kamailio automatically picks an interface.
                </p>
            <div class="example">
              <a id="idp18726144"></a>
              <p class="title">
                <strong>Example¬†1.17.¬†Set <code class="varname">force_send_sock</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("siptrace", "force_send_sock", "sip:10.1.1.2:5000")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
        <div class="section" title="4.¬†Functions">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp18190848"></a>4.¬†Functions</h2>
              </div>
            </div>
          </div>
          <div class="section" title="4.1.¬† sip_trace([address])">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.f.sip_trace"></a>4.1.¬†
		<code class="function">sip_trace([address])</code>
		</h3>
                </div>
              </div>
            </div>
            <p>
		Store or forward the current processed SIP message in database. It is stored in the
		form prior applying changes made to it.
		</p>
            <p>Meaning of the parameters is as follows:</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p><span class="emphasis"><em>address</em></span> - The address in form of SIP uri
		where to send a duplicate of traced message. This parameter trumps
		duplicate_uri and allows tracing to more than one server.
		</p>
                </li>
              </ul>
            </div>
            <p>
		This function can be used from REQUEST_ROUTE, FAILURE_ROUTE,
		ONREPLY_ROUTE, BRANCH_ROUTE.
		</p>
            <span class="emphasis">
              <em>
			Default value is "NULL".
		</em>
            </span>
            <div class="example">
              <a id="idp17494936"></a>
              <p class="title">
                <strong>Example¬†1.18.¬†<code class="function">sip_trace()</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
sip_trace();
...
sip_trace("sip:10.1.1.2:5085");
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
        <div class="section" title="5.¬†MI Commands">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp18010064"></a>5.¬†MI Commands</h2>
              </div>
            </div>
          </div>
          <div class="section" title="5.1.¬† sip_trace">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.m.sip_trace"></a>5.1.¬†
		<code class="function">sip_trace</code>
		</h3>
                </div>
              </div>
            </div>
            <p>

		</p>
            <p>
		Name: <span class="emphasis"><em>sip_trace</em></span>
		</p>
            <p>Parameters: </p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>trace_mode : turns on/off SIP message tracing.
			Possible values are:</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist">
                      <li class="listitem">
                        <p> on </p>
                      </li>
                      <li class="listitem">
                        <p> off </p>
                      </li>
                    </ul>
                  </div>
                  <p>The parameter is optional - if missing, the command will
			return the status of the SIP message tracing (as string 
			<span class="quote">‚Äú<span class="quote">on</span>‚Äù</span> or <span class="quote">‚Äú<span class="quote">off</span>‚Äù</span> ) without changing
			anything.</p>
                </li>
              </ul>
            </div>
            <p>
		MI FIFO Command Format:
		</p>
            <pre class="programlisting">		:sip_trace:_reply_fifo_file_
		trace_mode
		_empty_line_</pre>
          </div>
        </div>
        <div class="section" title="6.¬†RPC Commands">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp15721024"></a>6.¬†RPC Commands</h2>
              </div>
            </div>
          </div>
          <div class="section" title="6.1.¬† siptrace.status param">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="siptrace.r.siptrace.status"></a>6.1.¬†
		<code class="function">siptrace.status param</code>
		</h3>
                </div>
              </div>
            </div>
            <p>

		</p>
            <p>
		Name: <span class="emphasis"><em>siptrace.status</em></span>
		</p>
            <p>Parameters: </p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>on or off: turns on/off SIP message tracing..
			Possible values are:</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist">
                      <li class="listitem">
                        <p>on</p>
                      </li>
                      <li class="listitem">
                        <p>off</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p><span class="quote">‚Äú<span class="quote">check</span>‚Äù</span> does not change 
			siptrace status, just reports the current status.</p>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="section" title="7.¬†Database setup">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp15725832"></a>7.¬†Database setup</h2>
              </div>
            </div>
          </div>
          <p>
		Before running Kamailio with siptrace, you have to setup the database 
		tables where the module will store the data. For that, if the
		table were not created by the installation script or you choose
		to install everything by yourself you can use the siptrace-create.sql
		<acronym class="acronym">SQL</acronym> script in the database directories in the
		kamailio/scripts folder as template.
		You can also find the complete database documentation on the
		project webpage, <a class="ulink" href="javascript:if(confirm('http://www.kamailio.org/docs/db-tables/kamailio-db-devel.html  \n\n∏√Œƒº˛Œﬁ∑®”√ Teleport Ultra œ¬‘ÿ, “ÚŒ™ À¸ «“ª∏ˆ”ÚªÚ¬∑æ∂Õ‚≤ø±ª…Ë÷√Œ™À¸µƒ∆Ù ºµÿ÷∑µƒµÿ÷∑°£  \n\nƒ„œÎ‘⁄∑˛ŒÒ∆˜…œ¥Úø™À¸?'))window.location='http://www.kamailio.org/docs/db-tables/kamailio-db-devel.html'" tppabs="http://www.kamailio.org/docs/db-tables/kamailio-db-devel.html">http://www.kamailio.org/docs/db-tables/kamailio-db-devel.html</a>.
		</p>
        </div>
        <div class="section" title="8.¬†Known issues">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp15449832"></a>8.¬†Known issues</h2>
              </div>
            </div>
          </div>
          <p>
	Stateless forwarded messages (forward()) are not logged if you set the
	flag, use sip_trace().
	</p>
        </div>
      </div>
    </div>
  </body>
</html>
