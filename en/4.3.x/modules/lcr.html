<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>LCR (Least Cost Routing) Module</title>
    <link rel="stylesheet" type="text/css" href="../../../../css/sr-doc.css" tppabs="http://kamailio.org/css/sr-doc.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.76.1" />
    <link rel="home" href="#idm4376824" title="LCR (Least Cost Routing) Module" />
    <link rel="next" href="#idp1956656" title="Chapter 1. Admin Guide" />
  </head>
  <body>
    <div class="book" title="LCR (Least Cost Routing) Module">
      <div class="titlepage">
        <div>
          <div>
            <h1 class="title"><a id="idm4376824"></a>LCR (Least Cost Routing) Module</h1>
          </div>
          <div>
            <div class="authorgroup">
              <div class="author">
                <h3 class="author"><span class="firstname">Juha</span> <span class="surname">Heinanen</span></h3>
                <code class="email">&lt;<a class="email" href="mailto:jh@tutpro.com">jh@tutpro.com</a>&gt;</code>
              </div>
              <div class="editor">
                <h4 class="editedby">Edited by</h4>
                <h3 class="editor"><span class="firstname">Juha</span> <span class="surname">Heinanen</span></h3>
                <code class="email">&lt;<a class="email" href="mailto:jh@tutpro.com">jh@tutpro.com</a>&gt;</code>
              </div>
            </div>
          </div>
          <div>
            <p class="copyright">Copyright © 2005-2014 Juha Heinanen</p>
          </div>
        </div>
        <hr />
      </div>
      <div class="toc">
        <p>
          <strong>Table of Contents</strong>
        </p>
        <dl>
          <dt>
            <span class="chapter">
              <a href="#idp1956656">1. Admin Guide</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="#idp3032528">1. Overview</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="#idp3540480">2. Dependencies</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp3540856">2.1. SIP Router modules</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp2480192">2.2. External libraries or applications</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp2533136">3. Parameters</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp2584104">3.1. <code class="varname">db_url</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idm14728">3.2. <code class="varname">lcr_gw_table</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idm12112">3.3. <code class="varname">id_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idm9472">3.4. <code class="varname">lcr_id_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idm6624">3.5. <code class="varname">gw_name_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idm3976">3.6. <code class="varname">ip_addr_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idm1336">3.7. <code class="varname">hostname_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp66200">3.8. <code class="varname">port_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp68816">3.9. <code class="varname">params_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp71512">3.10. <code class="varname">uri_scheme_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp74136">3.11. <code class="varname">transport_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp76776">3.12. <code class="varname">strip_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp79464">3.13. <code class="varname">tag_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp82136">3.14. <code class="varname">flags_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp20656">3.15. <code class="varname">defunct_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp23504">3.16. <code class="varname">lcr_rule_table</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp26128">3.17. <code class="varname">prefix_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp28792">3.18. <code class="varname">from_uri_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp31424">3.19. <code class="varname">request_uri_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp34136">3.20. <code class="varname">stopper_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp36736">3.21. <code class="varname">enabled_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp39368">3.22. <code class="varname">lcr_rule_target_table</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp41992">3.23. <code class="varname">rule_id_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1752568">3.24. <code class="varname">gw_id_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1755192">3.25. <code class="varname">priority_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1757832">3.26. <code class="varname">weight_column</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1760464">3.27. <code class="varname">lcr_count</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1762712">3.28. <code class="varname">gw_uri_avp</code> (AVP string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1765248">3.29. <code class="varname">ruri_user_avp</code> (AVP string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1767808">3.30. <code class="varname">tag_avp</code> (AVP string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1770352">3.31. <code class="varname">flags_avp</code> (AVP string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1772896">3.32. <code class="varname">defunct_capability</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1775344">3.33. <code class="varname">lcr_id_avp</code> (AVP string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1777864">3.34. <code class="varname">defunct_gw_avp</code> (AVP string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1780448">3.35. <code class="varname">lcr_rule_hash_size</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1782992">3.36. <code class="varname">lcr_gw_count</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1785384">3.37. <code class="varname">dont_strip_or_tag_flag</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1787848">3.38. <code class="varname">fetch_rows</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1790728">3.39. <code class="varname">ping_interval</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1794840">3.40. <code class="varname">ping_inactivate_threshold</code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1797528">3.41. <code class="varname">ping_valid_reply_codes</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1800264">3.42. <code class="varname">ping_from</code> (string)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1802864">3.43. <code class="varname">ping_socket</code> (string)</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp1805640">4. Functions</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp1806008">4.1. 
		<code class="function">load_gws(lcr_id[, uri_user[, caller_uri]])
		</code> 
		</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1809864">4.2. 
		<code class="function">next_gw()</code>
		</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1815080">4.3. 
		<code class="function">inactivate_gw()</code>
		</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1818432">4.4. 
		<code class="function">defunct_gw(period)</code>
		</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1821416">4.5. 
		<code class="function">from_gw(lcr_id[, ip_addr, proto])</code>
		</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1825752">4.6. 
		<code class="function">from_any_gw([ip_addr, proto])</code>
		</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1829808">4.7. 
		<code class="function">to_gw(lcr_id[, ip_addr, proto])</code>
		</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1833168">4.8. 
		<code class="function">to_any_gw([ip_addr, proto])</code>
		</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp1836784">5. Exported RPC Commands</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp1837136">5.1. <code class="function">lcr.reload</code></a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1839992">5.2. <code class="function">lcr.dump_gws</code></a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1842408">5.3. <code class="function">lcr.dump_rules</code></a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp1844856">5.4. <code class="function">lcr.defunct_gw</code></a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp1847912">6. Known Limitations</a>
                </span>
              </dt>
            </dl>
          </dd>
        </dl>
      </div>
      <div class="list-of-examples">
        <p>
          <strong>List of Examples</strong>
        </p>
        <dl>
          <dt>1.1. <a href="#idm15928">Setting <code class="varname">db_url</code> module parameter</a></dt>
          <dt>1.2. <a href="#idm13280">Setting <code class="varname">gw_table</code> module parameter</a></dt>
          <dt>1.3. <a href="#idm10640">Setting <code class="varname">id_column</code> module
		parameter</a></dt>
          <dt>1.4. <a href="#idm7816">Setting <code class="varname">lcr_id_column</code> module
		parameter</a></dt>
          <dt>1.5. <a href="#idm5152">Setting <code class="varname">gw_name_column</code> module parameter</a></dt>
          <dt>1.6. <a href="#idm2512">Setting <code class="varname">ip_addr_column</code> module
		parameter</a></dt>
          <dt>1.7. <a href="#idp65072">Setting <code class="varname">hostname_column</code> module parameter</a></dt>
          <dt>1.8. <a href="#idp67648">Setting <code class="varname">port_column</code> module parameter</a></dt>
          <dt>1.9. <a href="#idp70328">Setting <code class="varname">params_column</code> module parameter</a></dt>
          <dt>1.10. <a href="#idp72968">Setting <code class="varname">uri_scheme_column</code> module 
		parameter</a></dt>
          <dt>1.11. <a href="#idp75616">Setting <code class="varname">transport_column</code> module 
		parameter</a></dt>
          <dt>1.12. <a href="#idp78304">Setting <code class="varname">strip_column</code> module 
		parameter</a></dt>
          <dt>1.13. <a href="#idp80968">Setting <code class="varname">tag_column</code> module parameter</a></dt>
          <dt>1.14. <a href="#idp83592">Setting <code class="varname">flags_column</code> module parameter</a></dt>
          <dt>1.15. <a href="#idp22312">Setting <code class="varname">defunct_column</code> module parameter</a></dt>
          <dt>1.16. <a href="#idp24944">Setting <code class="varname">lcr_rule_table</code> module parameter</a></dt>
          <dt>1.17. <a href="#idp27608">Setting <code class="varname">prefix_column</code> module
		parameter</a></dt>
          <dt>1.18. <a href="#idp30240">Setting <code class="varname">from_uri_column</code> module parameter</a></dt>
          <dt>1.19. <a href="#idp32944">Setting <code class="varname">request_uri_column</code> module parameter</a></dt>
          <dt>1.20. <a href="#idp35584">Setting <code class="varname">stopper_column</code> module
		parameter 
			</a></dt>
          <dt>1.21. <a href="#idp38208">Setting <code class="varname">enabled_column</code> module
		parameter
		</a></dt>
          <dt>1.22. <a href="#idp40832">Setting <code class="varname">lcr_rule_target_table</code>
		module parameter</a></dt>
          <dt>1.23. <a href="#idp43464">Setting <code class="varname">rule_id_column</code> module
		parameter 
			</a></dt>
          <dt>1.24. <a href="#idp1754040">Setting <code class="varname">gw_id_column</code> module
		parameter 
			</a></dt>
          <dt>1.25. <a href="#idp1756648">Setting <code class="varname">priority_column</code> module
		parameter</a></dt>
          <dt>1.26. <a href="#idp1759280">Setting <code class="varname">weight_column</code> module
		parameter</a></dt>
          <dt>1.27. <a href="#idp1761616">
		Setting <code class="varname">lcr_count</code> module
		parameter
		</a></dt>
          <dt>1.28. <a href="#idp1764072">Setting <code class="varname">gw_uri_avp</code> module
		parameter</a></dt>
          <dt>1.29. <a href="#idp1766624">Setting <code class="varname">ruri_user_avp</code> module parameter</a></dt>
          <dt>1.30. <a href="#idp1769176">Setting <code class="varname">tag_avp</code> module parameter</a></dt>
          <dt>1.31. <a href="#idp1771720">Setting <code class="varname">flags_avp</code> module parameter</a></dt>
          <dt>1.32. <a href="#idp1774184">
		Setting <code class="varname">defunct_capability</code> module
		parameter
		</a></dt>
          <dt>1.33. <a href="#idp1776680">Setting <code class="varname">lcr_id_avp</code> module
		parameter</a></dt>
          <dt>1.34. <a href="#idp1779248">Setting <code class="varname">defunct_gw_avp</code> module
		parameter</a></dt>
          <dt>1.35. <a href="#idp1781824">
		Setting <code class="varname">lcr_rule_hash_size</code> module
		parameter
		</a></dt>
          <dt>1.36. <a href="#idp1784224">
		Setting <code class="varname">lcr_gw_count</code> module parameter
		</a></dt>
          <dt>1.37. <a href="#idp1786704">
		Setting <code class="varname">dont_strip_or_tag_flag</code> module
		parameter
		</a></dt>
          <dt>1.38. <a href="#idp1789568">Set <code class="varname">fetch_rows</code> parameter</a></dt>
          <dt>1.39. <a href="#idp1793664">
		Set <code class="varname">ping_interval</code> parameter
		</a></dt>
          <dt>1.40. <a href="#idp1796368">
		Set <code class="varname">ping_inactivate_threshold</code> parameter
		</a></dt>
          <dt>1.41. <a href="#idp1799096">
		Set <code class="varname">ping_valid_reply_codes</code> parameter
		</a></dt>
          <dt>1.42. <a href="#idp1801680">
		Set <code class="varname">ping_from</code> parameter
		</a></dt>
          <dt>1.43. <a href="#idp1804376">
		Set <code class="varname">ping_socket</code> parameter
		</a></dt>
          <dt>1.44. <a href="#idp1808560"><code class="function">load_gws</code> usage</a></dt>
          <dt>1.45. <a href="#idp1812664"><code class="function">next_gw</code> usage from a route block</a></dt>
          <dt>1.46. <a href="#idp1813832"><code class="function">next_gw</code> usage from a failure
		route block 
			</a></dt>
          <dt>1.47. <a href="#idp1817144"><code class="function">inactivate_gw</code> usage</a></dt>
          <dt>1.48. <a href="#idp1820256"><code class="function">defunct_gw</code> usage</a></dt>
          <dt>1.49. <a href="#idp1824520"><code class="function">from_gw</code> usage</a></dt>
          <dt>1.50. <a href="#idp1828584"><code class="function">from_gw</code> usage</a></dt>
          <dt>1.51. <a href="#idp1832008"><code class="function">to_gw</code> usage</a></dt>
          <dt>1.52. <a href="#idp1835480"><code class="function">to_gw</code> usage</a></dt>
          <dt>1.53. <a href="#idp1838824"><code class="function">lcr.reload</code> RPC example</a></dt>
          <dt>1.54. <a href="#idp1841232"><code class="function">lcr.dump_gws</code> RPC example</a></dt>
          <dt>1.55. <a href="#idp1843680"><code class="function">lcr.dump_rules</code> RPC example</a></dt>
          <dt>1.56. <a href="#idp1846656"><code class="function">lcr.defunct_gw</code> RPC example</a></dt>
        </dl>
      </div>
      <div class="chapter" title="Chapter 1. Admin Guide">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="idp1956656"></a>Chapter 1. Admin Guide</h2>
            </div>
          </div>
        </div>
        <div class="toc">
          <p>
            <strong>Table of Contents</strong>
          </p>
          <dl>
            <dt>
              <span class="section">
                <a href="#idp3032528">1. Overview</a>
              </span>
            </dt>
            <dt>
              <span class="section">
                <a href="#idp3540480">2. Dependencies</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp3540856">2.1. SIP Router modules</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp2480192">2.2. External libraries or applications</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp2533136">3. Parameters</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp2584104">3.1. <code class="varname">db_url</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idm14728">3.2. <code class="varname">lcr_gw_table</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idm12112">3.3. <code class="varname">id_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idm9472">3.4. <code class="varname">lcr_id_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idm6624">3.5. <code class="varname">gw_name_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idm3976">3.6. <code class="varname">ip_addr_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idm1336">3.7. <code class="varname">hostname_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp66200">3.8. <code class="varname">port_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp68816">3.9. <code class="varname">params_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp71512">3.10. <code class="varname">uri_scheme_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp74136">3.11. <code class="varname">transport_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp76776">3.12. <code class="varname">strip_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp79464">3.13. <code class="varname">tag_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp82136">3.14. <code class="varname">flags_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp20656">3.15. <code class="varname">defunct_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp23504">3.16. <code class="varname">lcr_rule_table</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp26128">3.17. <code class="varname">prefix_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp28792">3.18. <code class="varname">from_uri_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp31424">3.19. <code class="varname">request_uri_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp34136">3.20. <code class="varname">stopper_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp36736">3.21. <code class="varname">enabled_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp39368">3.22. <code class="varname">lcr_rule_target_table</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp41992">3.23. <code class="varname">rule_id_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1752568">3.24. <code class="varname">gw_id_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1755192">3.25. <code class="varname">priority_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1757832">3.26. <code class="varname">weight_column</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1760464">3.27. <code class="varname">lcr_count</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1762712">3.28. <code class="varname">gw_uri_avp</code> (AVP string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1765248">3.29. <code class="varname">ruri_user_avp</code> (AVP string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1767808">3.30. <code class="varname">tag_avp</code> (AVP string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1770352">3.31. <code class="varname">flags_avp</code> (AVP string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1772896">3.32. <code class="varname">defunct_capability</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1775344">3.33. <code class="varname">lcr_id_avp</code> (AVP string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1777864">3.34. <code class="varname">defunct_gw_avp</code> (AVP string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1780448">3.35. <code class="varname">lcr_rule_hash_size</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1782992">3.36. <code class="varname">lcr_gw_count</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1785384">3.37. <code class="varname">dont_strip_or_tag_flag</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1787848">3.38. <code class="varname">fetch_rows</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1790728">3.39. <code class="varname">ping_interval</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1794840">3.40. <code class="varname">ping_inactivate_threshold</code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1797528">3.41. <code class="varname">ping_valid_reply_codes</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1800264">3.42. <code class="varname">ping_from</code> (string)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1802864">3.43. <code class="varname">ping_socket</code> (string)</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp1805640">4. Functions</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp1806008">4.1. 
		<code class="function">load_gws(lcr_id[, uri_user[, caller_uri]])
		</code> 
		</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1809864">4.2. 
		<code class="function">next_gw()</code>
		</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1815080">4.3. 
		<code class="function">inactivate_gw()</code>
		</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1818432">4.4. 
		<code class="function">defunct_gw(period)</code>
		</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1821416">4.5. 
		<code class="function">from_gw(lcr_id[, ip_addr, proto])</code>
		</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1825752">4.6. 
		<code class="function">from_any_gw([ip_addr, proto])</code>
		</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1829808">4.7. 
		<code class="function">to_gw(lcr_id[, ip_addr, proto])</code>
		</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1833168">4.8. 
		<code class="function">to_any_gw([ip_addr, proto])</code>
		</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp1836784">5. Exported RPC Commands</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp1837136">5.1. <code class="function">lcr.reload</code></a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1839992">5.2. <code class="function">lcr.dump_gws</code></a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1842408">5.3. <code class="function">lcr.dump_rules</code></a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp1844856">5.4. <code class="function">lcr.defunct_gw</code></a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp1847912">6. Known Limitations</a>
              </span>
            </dt>
          </dl>
        </div>
        <div class="section" title="1. Overview">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp3032528"></a>1. Overview</h2>
              </div>
            </div>
          </div>
          <p>
	The Least Cost Routing (LCR) module implements capability to
	serially forward a request to one or more gateways so that the
	order in which the gateways is tried is based on admin defined
	"least cost" rules.
	</p>
          <p>
	The LCR module supports many independent LCR instances (gateways and
	least cost rules).  Each such instance has its own <span class="emphasis"><em>LCR
	instance identifier</em></span>.  Identifiers of normal LCR instances
	are positive integers. Gateways may belong to special LCR instance
	with identifier 0 meaning that such gateways belong to all normal
	LCR instances.
	</p>
          <p>
	For the purpose of facilitating least cost routing of requests,
	each gateway of an LCR instance is associated with one or more 
	&lt;prefix, from uri pattern, request uri pattern, priority, weight&gt;
	tuples.  A gateway matches a request if user part of the Request-URI
	matches a "prefix", the caller's URI matches a "From-URI" pattern and
	the callee's URI matches a "Request-URI" pattern in a tuple that is
	associated with the gateway.
	</p>
          <p>
	When the function <span class="emphasis"><em>load_gws()</em></span> is called,
	matching gateways (that are not currently designated as defunct)
	are ordered for forwarding purposes as follows:
	</p>
          <p>
	</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
                <p>(1) according to longest Request-URI user part match
                </p>
              </li>
              <li class="listitem">
                <p>(2) according to tuple's priority
                </p>
              </li>
              <li class="listitem">
                <p>(3) according to tuple's randomized weight
                </p>
              </li>
            </ul>
          </div>
          <p>
	</p>
          <p>
	A tuple can be marked as a "stopper" tuple.  If a "stopper"
	tuple matches, then matching stops at it and all other tuples
	with shorter prefixes are not considered.
	</p>
          <p>
	Prefix is a string of characters or NULL.  From-URI
	pattern and Request-URI pattern are regular expressions (see 'man 
	pcresyntax' for syntax), an empty string, or NULL.  An empty or
	NULL From-URI pattern, Request-URI pattern or prefix matches anything.
	Smaller priority value means higher priority (highest priority
	value being 0 and lowest being 255).
	</p>
          <p>
	Weight is an integer value from 1 to 254.  Weight implementation is
	fast, but unfair favoring larger weight values at the expense smaller
	ones.  For example, if two gateways have weights 1 and 2, probability
	that the gateway with weight 1 is tried first is 1/4, not 1/3.
	Two scripts are provided in lcr/utils directory that can be used to
	check the probabilities resulting from a given set of weight values.
	Same can be done with command 'kamctl eval_weights'.
	</p>
          <p>
        The function <span class="emphasis"><em>next_gw()</em></span> can then be used to
	select one gateway at a 
	time for forwarding.  Upon each call, unless "dont_strip_or_tag_flag"
	flag is set, user part of the original Request-URI is first  
	stripped by the number of characters as specified by the
	gateway's strip count and then prefixed by 
	the gateway's prefix.  Upon each call, if a gateway's hostname is
	NULL, Request-URI will be  
	rewritten based on gateway's URI scheme, IP address, port,
	parameters, and transport protocol.  If hostname is not NULL and
	IP address is NULL, Request-URI will be rewritten based on the
	gateway's URI scheme, 
	hostname, port, parameters and transport protocol.  If both
	hostname and IP address are not NULL, Request-URI will be
	rewritten based on gateway's URI scheme, 
	hostname, and parameters, and destination URI is set 
	based on gateway's URI scheme, IP address, port, and transport
	protocol.
	</p>
          <p>
        Valid URI scheme values are NULL = sip, 1 = sip and 2
	= sips.  Currently valid transport protocol values are NULL and 0 =
	none, 1 = udp, 2 = tcp, 3 = tls, and 4 = sctp.
	</p>
          <p>
	As a side effect of gateway selection, selected gateway's tag and flags
	(that may contain information about the gateway and its capabilities)
	are stored to tag_avp and flags_avp, respectively, if the corresponding
	module parameter has been defined.
	</p>
        </div>
        <div class="section" title="2. Dependencies">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp3540480"></a>2. Dependencies</h2>
              </div>
            </div>
          </div>
          <div class="section" title="2.1. SIP Router modules">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp3540856"></a>2.1. SIP Router modules</h3>
                </div>
              </div>
            </div>
            <p>
		The following modules must be loaded before this module:
		</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>A database module like mysql, postgres or 
			dbtext</em></span>.
		</p>
                </li>
              </ul>
            </div>
            <p>
	</p>
          </div>
          <div class="section" title="2.2. External libraries or applications">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp2480192"></a>2.2. External libraries or applications</h3>
                </div>
              </div>
            </div>
            <p>
		The following libraries or applications must be installed before
		running SIP Router with this module:
			</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
				<span class="emphasis"><em>libpcre</em></span>
			</p>
                </li>
              </ul>
            </div>
            <p>
	</p>
          </div>
        </div>
        <div class="section" title="3. Parameters">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp2533136"></a>3. Parameters</h2>
              </div>
            </div>
          </div>
          <div class="section" title="3.1. db_url (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp2584104"></a>3.1. <code class="varname">db_url</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		<acronym class="acronym">URL</acronym> of the database table to be used.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is 
			<span class="quote">“<span class="quote">mysql://kamailioro:kamailioro@localhost/kamailio</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idm15928"></a>
              <p class="title">
                <strong>Example 1.1. Setting <code class="varname">db_url</code> module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr","db_url","dbdriver://username:password@dbhost/dbname")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.2. lcr_gw_table (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idm14728"></a>3.2. <code class="varname">lcr_gw_table</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the table holding gateways definitions.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">lcr_gw</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idm13280"></a>
              <p class="title">
                <strong>Example 1.2. Setting <code class="varname">gw_table</code> module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "lcr_gw_table","gw")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.3. id_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idm12112"></a>3.3. <code class="varname">id_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the auto-increment, primary key column.  Common
		to all lcr module tables.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">id</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idm10640"></a>
              <p class="title">
                <strong>Example 1.3. Setting <code class="varname">id_column</code> module
		parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "id_column", "row_id")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.4. lcr_id_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idm9472"></a>3.4. <code class="varname">lcr_id_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding the identifier of an LCR
		instance.  Common to all lcr module tables.  In lcr_rule and
		lcr_rule_target tables, value of the column is
		integer from 1 to lcr_count.  In lcr_gw table, value of the
		column is from 0 to lcr_count.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">lcr_id</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idm7816"></a>
              <p class="title">
                <strong>Example 1.4. Setting <code class="varname">lcr_id_column</code> module
		parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "lcr_id_column", "lcr_identifier")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.5. gw_name_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idm6624"></a>3.5. <code class="varname">gw_name_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding gateway's name for
		documentation purpose.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">gw_name</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idm5152"></a>
              <p class="title">
                <strong>Example 1.5. Setting <code class="varname">gw_name_column</code> module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "gw_name_column", "name")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.6. ip_addr_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idm3976"></a>3.6. <code class="varname">ip_addr_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding the IPv4 or IPv6 address of
		the gateway.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">ip_addr</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idm2512"></a>
              <p class="title">
                <strong>Example 1.6. Setting <code class="varname">ip_addr_column</code> module
		parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "ip_addr_column", "ip")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.7. hostname_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idm1336"></a>3.7. <code class="varname">hostname_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding gateway's hostname that is
		used in Request-URI hostpart, when request is sent to the
		gateway.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">hostname</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp65072"></a>
              <p class="title">
                <strong>Example 1.7. Setting <code class="varname">hostname_column</code> module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "hostname_column", "host")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.8. port_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp66200"></a>3.8. <code class="varname">port_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding the port number of the gateway.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">port</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp67648"></a>
              <p class="title">
                <strong>Example 1.8. Setting <code class="varname">port_column</code> module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "port_column", "port")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.9. params_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp68816"></a>3.9. <code class="varname">params_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding gateway's parameters that is
		used in Request-URI, when request is sent to the
		gateway.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">params</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp70328"></a>
              <p class="title">
                <strong>Example 1.9. Setting <code class="varname">params_column</code> module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "params_column", "parameters")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.10. uri_scheme_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp71512"></a>3.10. <code class="varname">uri_scheme_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding the uri scheme of the gateway.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">uri_scheme</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp72968"></a>
              <p class="title">
                <strong>Example 1.10. Setting <code class="varname">uri_scheme_column</code> module 
		parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "uri_scheme_column", "uri_scheme")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.11. transport_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp74136"></a>3.11. <code class="varname">transport_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding the transport protocol to be
		used for the gateway.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">transport</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp75616"></a>
              <p class="title">
                <strong>Example 1.11. Setting <code class="varname">transport_column</code> module 
		parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "transport_column", "trans")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.12. strip_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp76776"></a>3.12. <code class="varname">strip_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding the number of characters
		to be stripped from the front of Request-URI user part
		before inserting tag.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">strip</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp78304"></a>
              <p class="title">
                <strong>Example 1.12. Setting <code class="varname">strip_column</code> module 
		parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "strip_column", "strip_count")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.13. tag_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp79464"></a>3.13. <code class="varname">tag_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding gateway specific tag string
		that is added to Request URI userpart after stripping.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">tag</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp80968"></a>
              <p class="title">
                <strong>Example 1.13. Setting <code class="varname">tag_column</code> module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "tag_column", "gw_tag")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.14. flags_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp82136"></a>3.14. <code class="varname">flags_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding gateway specific flag values.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">flags</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp83592"></a>
              <p class="title">
                <strong>Example 1.14. Setting <code class="varname">flags_column</code> module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "flags_column", "gw_flags")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.15. defunct_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp20656"></a>3.15. <code class="varname">defunct_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding UNIX timestamp telling the
		time until which the gw is considered as defunct.
		If timestamp value is 4294967295 (= max UNIX timestamp value)
		or greater, gw is considered currently unused and is not
		loaded into memory at all.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">defunct</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp22312"></a>
              <p class="title">
                <strong>Example 1.15. Setting <code class="varname">defunct_column</code> module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "defunct_column", "defunct_until")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.16. lcr_rule_table (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp23504"></a>3.16. <code class="varname">lcr_rule_table</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the table holding the LCR rules.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">lcr_rule</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp24944"></a>
              <p class="title">
                <strong>Example 1.16. Setting <code class="varname">lcr_rule_table</code> module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "lcr_rule_table", "rules")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.17. prefix_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp26128"></a>3.17. <code class="varname">prefix_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding prefix of Request-URI user
		part and prefix of gateway.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">prefix</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp27608"></a>
              <p class="title">
                <strong>Example 1.17. Setting <code class="varname">prefix_column</code> module
		parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "prefix_column", "number_prefix")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.18. from_uri_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp28792"></a>3.18. <code class="varname">from_uri_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding the From (caller's) URI.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">from_uri</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp30240"></a>
              <p class="title">
                <strong>Example 1.18. Setting <code class="varname">from_uri_column</code> module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "from_uri_column", "caller_uri")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.19. request_uri_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp31424"></a>3.19. <code class="varname">request_uri_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding the regular expression to match
		against the complete request URI (including the "sip:" prefix).
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">request_uri</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp32944"></a>
              <p class="title">
                <strong>Example 1.19. Setting <code class="varname">request_uri_column</code> module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "request_uri_column", "callee_uri")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.20. stopper_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp34136"></a>3.20. <code class="varname">stopper_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding rule's stopper attribute.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">stopper</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp35584"></a>
              <p class="title">
                <strong>Example 1.20. Setting <code class="varname">stopper_column</code> module
		parameter 
			</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "stopper_column", "stop")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.21. enabled_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp36736"></a>3.21. <code class="varname">enabled_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column telling is the rule is currently
		enabled or disabled.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">enabled</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp38208"></a>
              <p class="title">
                <strong>Example 1.21. Setting <code class="varname">enabled_column</code> module
		parameter
		</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "enabled_column", "in_use")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.22. lcr_rule_target_table (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp39368"></a>3.22. <code class="varname">lcr_rule_target_table</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the table holding information about the LCR rule
		targets (gateways).
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">lcr_rule_target</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp40832"></a>
              <p class="title">
                <strong>Example 1.22. Setting <code class="varname">lcr_rule_target_table</code>
		module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "lcr_rule_target_table", "rules")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.23. rule_id_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp41992"></a>3.23. <code class="varname">rule_id_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of lcr_rule_target_table column containing an id of
		lcr_rule table.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">rule_id</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp43464"></a>
              <p class="title">
                <strong>Example 1.23. Setting <code class="varname">rule_id_column</code> module
		parameter 
			</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "rule_id_column", "rule")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.24. gw_id_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1752568"></a>3.24. <code class="varname">gw_id_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of lcr_rule_target_table column containing an id of
		lcr_gw table.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">gw_id</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1754040"></a>
              <p class="title">
                <strong>Example 1.24. Setting <code class="varname">gw_id_column</code> module
		parameter 
			</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "gw_id_column", "gw")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.25. priority_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1755192"></a>3.25. <code class="varname">priority_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding the priority of the rule
		target.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">priority</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1756648"></a>
              <p class="title">
                <strong>Example 1.25. Setting <code class="varname">priority_column</code> module
		parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "priority_column", "priority")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.26. weight_column (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1757832"></a>3.26. <code class="varname">weight_column</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		Name of the column holding weight of rule target.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">weight</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1759280"></a>
              <p class="title">
                <strong>Example 1.26. Setting <code class="varname">weight_column</code> module
		parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr","weight_column", "target_weight")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.27. lcr_count (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1760464"></a>3.27. <code class="varname">lcr_count</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Maximun value of lcr_id.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is 1.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1761616"></a>
              <p class="title">
                <strong>Example 1.27. 
		Setting <code class="varname">lcr_count</code> module
		parameter
		</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "lcr_count", 10)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.28. gw_uri_avp (AVP string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1762712"></a>3.28. <code class="varname">gw_uri_avp</code> (AVP string)</h3>
                </div>
              </div>
            </div>
            <p>
		Internal AVP that load_gws() function uses to store
		information of matching gateways.
		</p>
            <p>
		<span class="emphasis"><em>
			There is NO default value, thus this variable must
			be defined in sip-router.cfg.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1764072"></a>
              <p class="title">
                <strong>Example 1.28. Setting <code class="varname">gw_uri_avp</code> module
		parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "gw_uri_avp", "$avp(i:709)")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.29. ruri_user_avp (AVP string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1765248"></a>3.29. <code class="varname">ruri_user_avp</code> (AVP string)</h3>
                </div>
              </div>
            </div>
            <p>
   		Internal AVP that next_gw function uses to store
		Request-URI user for subsequent next_gw calls.
		</p>
            <p>
		<span class="emphasis"><em>
			There is NO default value, thus this variable must
			be defined in sip-router.cfg.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1766624"></a>
              <p class="title">
                <strong>Example 1.29. Setting <code class="varname">ruri_user_avp</code> module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "ruri_user_avp", "$avp(i:500)")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.30. tag_avp (AVP string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1767808"></a>3.30. <code class="varname">tag_avp</code> (AVP string)</h3>
                </div>
              </div>
            </div>
            <p>
		If defined, an AVP where successful next_gw and from_gw
		functions store gateway's tag.
		</p>
            <p>
		<span class="emphasis"><em>
			There is NO default value, i.e, if not defined,
			gateway's tag is not stored anywhere.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1769176"></a>
              <p class="title">
                <strong>Example 1.30. Setting <code class="varname">tag_avp</code> module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "tag_avp", "$avp(lcr_tag)")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.31. flags_avp (AVP string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1770352"></a>3.31. <code class="varname">flags_avp</code> (AVP string)</h3>
                </div>
              </div>
            </div>
            <p>
		If defined, an AVP where successful next_gw and from_gw
		functions store gateway's flags.
		</p>
            <p>
		<span class="emphasis"><em>
			There is NO default value, i.e, if not defined,
			gateway's flags are not stored anywhere.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1771720"></a>
              <p class="title">
                <strong>Example 1.31. Setting <code class="varname">flags_avp</code> module parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "flags_avp", "$avp(i:712)")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.32. defunct_capability (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1772896"></a>3.32. <code class="varname">defunct_capability</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Tells if defunct capability of (non-responsive) gateways is
		supported.  Non-zero value turns on defunct capability.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is 0.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1774184"></a>
              <p class="title">
                <strong>Example 1.32. 
		Setting <code class="varname">defunct_capability</code> module
		parameter
		</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "defunct_capability", 1)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.33. lcr_id_avp (AVP string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1775344"></a>3.33. <code class="varname">lcr_id_avp</code> (AVP string)</h3>
                </div>
              </div>
            </div>
            <p>
		Internal AVP that load_gws() function uses to store
		LCR instance identifier of loaded gateways.  Only needed if
		gateway defunct capability has been activated.
		</p>
            <p>
		<span class="emphasis"><em>
			There is NO default value.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1776680"></a>
              <p class="title">
                <strong>Example 1.33. Setting <code class="varname">lcr_id_avp</code> module
		parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "lcr_id_avp", "$avp(s:lcr_id_avp)")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.34. defunct_gw_avp (AVP string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1777864"></a>3.34. <code class="varname">defunct_gw_avp</code> (AVP string)</h3>
                </div>
              </div>
            </div>
            <p>
		Internal AVP that next_gw() function uses to store
		internal index of the  
		selected gateway for later use by defunct_gw() function.
		Only needed if 
		gateway defunct capability has been activated.
		</p>
            <p>
		<span class="emphasis"><em>
			There is NO default value.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1779248"></a>
              <p class="title">
                <strong>Example 1.34. Setting <code class="varname">defunct_gw_avp</code> module
		parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "defunct_gw_avp", "$avp(s:defunct_gw_avp)")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.35. lcr_rule_hash_size (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1780448"></a>3.35. <code class="varname">lcr_rule_hash_size</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Defines the size of hash table used to store LCR rules.
		Hashing is done based on rule's prefix.  Larger value means
		less collisions with other prefixes.  Hash size value
		should be a power of 2.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is 128.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1781824"></a>
              <p class="title">
                <strong>Example 1.35. 
		Setting <code class="varname">lcr_rule_hash_size</code> module
		parameter
		</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "lcr_rule_hash_size", 1024)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.36. lcr_gw_count (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1782992"></a>3.36. <code class="varname">lcr_gw_count</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Defines the maximum number of gateways in lcr_gw table.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is 128.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1784224"></a>
              <p class="title">
                <strong>Example 1.36. 
		Setting <code class="varname">lcr_gw_count</code> module parameter
		</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "lcr_gw_count", 1024)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.37. dont_strip_or_tag_flag (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1785384"></a>3.37. <code class="varname">dont_strip_or_tag_flag</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Defines the flag number used to tell if stripping and
		tagging is done for the selected gateway.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is -1 meaning that the flag is not
		defined.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1786704"></a>
              <p class="title">
                <strong>Example 1.37. 
		Setting <code class="varname">dont_strip_or_tag_flag</code> module
		parameter
		</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "dont_strip_or_tag_flag", 10)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.38. fetch_rows (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1787848"></a>3.38. <code class="varname">fetch_rows</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		The number of the rows to be fetched at once from database
		when loading data from lcr_rule table. This value can be
		used to tune 
		the load time at startup.  For 1MB of private memory (default)
		it should be below 3750. In order for this parameter to
		have effect, the database driver must support fetch_result()
		capability.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">1024</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1789568"></a>
              <p class="title">
                <strong>Example 1.38. Set <code class="varname">fetch_rows</code> parameter</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "fetch_rows", 3000)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.39. ping_interval (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1790728"></a>3.39. <code class="varname">ping_interval</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		  Interval in seconds for sending OPTIONS ping requests
		  to gateways that, due to failures, have been marked
		  as inactive by inactivate_gw() function call.
		  If an inactive gateway later gives a valid response (see
		  <code class="varname">ping_valid_reply_codes</code>) to a ping
		  request, it is marked again as active.
		</p>
            <p>
		  If value of this parameter is greater
		  than zero, tm module must have been loaded and
		  parameters <code class="varname">lcr_id_avp</code> and
		  <code class="varname">defunct_gw_avp</code> must have been defined.
		  Value <span class="quote">“<span class="quote">0</span>”</span> disables sending of OPTIONS ping
		  requests to failed gateways.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">0</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1793664"></a>
              <p class="title">
                <strong>Example 1.39. 
		Set <code class="varname">ping_interval</code> parameter
		</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "ping_interval", 15)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.40. ping_inactivate_threshold (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1794840"></a>3.40. <code class="varname">ping_inactivate_threshold</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		  Tells after how many failures (= inactivate_gw() function
		  calls) a gateway is marked as inactive.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">1</span>”</span>, i.e., gateway is
			inactivated after first failure.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1796368"></a>
              <p class="title">
                <strong>Example 1.40. 
		Set <code class="varname">ping_inactivate_threshold</code> parameter
		</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "ping_inactivate_threshold", 3)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.41. ping_valid_reply_codes (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1797528"></a>3.41. <code class="varname">ping_valid_reply_codes</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		  A comma separated list of SIP reply codes, which are
		  accepted as valid replies to OPTIONS ping requests.
		  Reply codes 2xx are by default accepted as valid replies and
		  they don't need to be listed here.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote"></span>”</span>, i.e., only 2xx
			replies are considered as valid replies.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1799096"></a>
              <p class="title">
                <strong>Example 1.41. 
		Set <code class="varname">ping_valid_reply_codes</code> parameter
		</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "ping_valid_reply_codes", "403,405,501")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.42. ping_from (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1800264"></a>3.42. <code class="varname">ping_from</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		  From URI used in OPTIONS ping requests.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote">sip:pinger@localhost</span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1801680"></a>
              <p class="title">
                <strong>Example 1.42. 
		Set <code class="varname">ping_from</code> parameter
		</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "ping_from", "sip:proxy.operator.com")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.43. ping_socket (string)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1802864"></a>3.43. <code class="varname">ping_socket</code> (string)</h3>
                </div>
              </div>
            </div>
            <p>
		  Socket to be used for sending OPTIONS ping request.  If not
		  set or set to <span class="quote">“<span class="quote"></span>”</span>, default socket is used.
		</p>
            <p>
		<span class="emphasis"><em>
			Default value is <span class="quote">“<span class="quote"></span>”</span>.
		</em></span>
		</p>
            <div class="example">
              <a id="idp1804376"></a>
              <p class="title">
                <strong>Example 1.43. 
		Set <code class="varname">ping_socket</code> parameter
		</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("lcr", "ping_socket", "192.98.102.10:5060")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
        <div class="section" title="4. Functions">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp1805640"></a>4. Functions</h2>
              </div>
            </div>
          </div>
          <div class="section" title="4.1.  load_gws(lcr_id[, uri_user[, caller_uri]])">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1806008"></a>4.1. 
		<code class="function">load_gws(lcr_id[, uri_user[, caller_uri]])
		</code> 
		</h3>
                </div>
              </div>
            </div>
            <p>
		Loads attributes of matching gateways to gw_uri_avp
		(see Overview section).  Argument lcr_id specifies the used
	        LCR instance.  It can be a positive integer or a pseudo
		variable containing an integer value.
		If uri_user is given, it is used, instead of Request-URI user
		part, to look for matching gateways.  Caller's URI may be given
		by caller_uri argument. If caller_uri argument is
		omitted, it defaults to empty string. Both uri_user and
		caller_uri argument may be a string or a pseudo variable
		containing a sting value.  
		</p>
            <p>
		Returns 1 if at least one matching gateway was found, 2
		if no matching gateways was found, and -1 on error.
		</p>
            <p>
		Execution time of load_gws() function is O(N) * O(M),
		where N is number of different prefix lengths and M
		is number of collisions for matching prefix(es) in lcr
		rules hash table of the LCR instance.
		</p>
            <p>
		This function can be used from REQUEST_ROUTE.
		</p>
            <div class="example">
              <a id="idp1808560"></a>
              <p class="title">
                <strong>Example 1.44. <code class="function">load_gws</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
if (!load_gws(1, $rU, $var(caller_uri))) {
	sl_send_reply("500", "Server Internal Error - Cannot load gateways");
	exit;
};
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.2.  next_gw()">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1809864"></a>4.2. 
		<code class="function">next_gw()</code>
		</h3>
                </div>
              </div>
            </div>
            <p>
		Upon first call, fetches attribute values stored in first
		gw_uri_avp, destroys that AVP, and rewrites
		Request-URI and possibly also destination URI as
		described in the Overview section. Saves user part of
		Request-URI into 
		ruri_user_avp for use in subsequent next_gw() calls.
		</p>
            <p>
		Upon subsequent calls, does the same as in above, but
		takes user part of Request-URI from ruri_user_avp.
		</p>
            <p>
		As a side effect, stores gateway's tag and flags to
		tag_avp and flags_avp, respectively, if the corresponding
		module parameter has been defined.
		</p>
            <p>
		Returns 1 on success and -1 if there were no gateways
		left or if an error occurred (see syslog).
		</p>
            <p>
		Must be preceded by successful load_gws() call.
		</p>
            <p>
		This function can be used from REQUEST_ROUTE, FAILURE_ROUTE.
		</p>
            <div class="example">
              <a id="idp1812664"></a>
              <p class="title">
                <strong>Example 1.45. <code class="function">next_gw</code> usage from a route block</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
if (!next_gw()) {
	sl_send_reply("503", "Service not available - No gateways");
	exit;
};
...</pre>
              </div>
            </div>
            <br class="example-break" />
            <div class="example">
              <a id="idp1813832"></a>
              <p class="title">
                <strong>Example 1.46. <code class="function">next_gw</code> usage from a failure
		route block 
			</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
if (!next_gw()) {
	t_reply("503", "Service not available - No more gateways");
	exit;
};
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.3.  inactivate_gw()">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1815080"></a>4.3. 
		<code class="function">inactivate_gw()</code>
		</h3>
                </div>
              </div>
            </div>
            <p>
		Inactivates the gateway denoted by lcr_id_avp and defunct_gw_avp
		(which were set by previous next_gw() call).  Use of this
		function requires that <code class="varname">ping_interval</code> module
		parameter has been set to a positive value allowing an
		inactivated gateway to be automatically activated by a positive
		response to OPTIONS ping request.
		</p>
            <p>
		Returns 1 on success and -1 in case of error (see syslog).
		</p>
            <p>
		This function can be used from REQUEST_ROUTE and FAILURE_ROUTE.
		</p>
            <div class="example">
              <a id="idp1817144"></a>
              <p class="title">
                <strong>Example 1.47. <code class="function">inactivate_gw</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
failure_route [GW_FAILURE] {
...
    if (t_check_status("408|503")) {
        inactivate_gw();
    };
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.4.  defunct_gw(period)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1818432"></a>4.4. 
		<code class="function">defunct_gw(period)</code>
		</h3>
                </div>
              </div>
            </div>
            <p>
		Defuncts gateway denoted by lcr_id_avp and defunct_gw_avp
		(which were set by previuos next_gw() call)
		for a period of seconds given as argument.  Argument 
		must be a positive integer constant or a pseudo variable
		with positive integer value.  Value of defunct column in
		database is not updated.
		</p>
            <p>
		Returns 1 on success and -1 in case of error (see syslog).
		</p>
            <p>
		This function can be used from REQUEST_ROUTE, FAILURE_ROUTE.
		</p>
            <div class="example">
              <a id="idp1820256"></a>
              <p class="title">
                <strong>Example 1.48. <code class="function">defunct_gw</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
defunct_gw(60);
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.5.  from_gw(lcr_id[, ip_addr, proto])">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1821416"></a>4.5. 
		<code class="function">from_gw(lcr_id[, ip_addr, proto])</code>
		</h3>
                </div>
              </div>
            </div>
            <p>
		Checks if request comes from IP address and transport protocol
		specified for a gateway in LCR instance lcr_id.
		Fails if the LCR instance includes 
		one or more gateways without IP address.
		IP address and transport protocol to be checked are either
		taken from source IP address of the request or
		(if present) from ip_addr and proto arguments.
		</p>
            <p>
		lcr_id can be an integer constant or a pseudo variable
		holding an integer value.  ip_addr can be a string or a pseudo
		variable holding a string value.  proto can be an integer
		constant (0 = ANY, 1 = UDP, 2 = TCP,
		3 = TLS, 4 = SCTP) or a pseudo variable holding such an
		integer value.
		</p>
            <p>
		If request comes from a gateway, gateway's tag and flags are
		stored as a side effect to
		tag_avp and flags_avp, respectively, if the corresponding
		module parameter has been defined.
		</p>
            <p>
		Returns 1 on success and -1 on failure or on error.
		</p>
            <p>
		Execution time of from_gw() function is O(log N),
		where N is number of gateways in the LCR instance.
		</p>
            <p>
		This function can be used from REQUEST_ROUTE, FAILURE_ROUTE,
		ONREPLY_ROUTE.
		</p>
            <div class="example">
              <a id="idp1824520"></a>
              <p class="title">
                <strong>Example 1.49. <code class="function">from_gw</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
if (from_gw(1, $avp(s:real_source_addr), 2) {
	...
};
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.6.  from_any_gw([ip_addr, proto])">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1825752"></a>4.6. 
		<code class="function">from_any_gw([ip_addr, proto])</code>
		</h3>
                </div>
              </div>
            </div>
            <p>
		Checks if request comes from IP address and transport 
		protocol specified for any gateway.  Only LCR instances,
		where all gateways
		have IP address, are included in the test.
		IP address and transport protocol to be checked are either
		taken from source IP address and transport protocol 
		of the request or
		(if present) from ip_addr and proto arguments.  See from_gw()
		function for more info about the arguments.
		</p>
            <p>
		If any gateway has the IP address and transport protocol,
		function returns LCR
		identifier of the gateway.  Returns -1 on error or if
		the request does not come from a gateway. 
		</p>
            <p>
		If request comes from a gateway, gateway's tag and flags are
		stored as a side effect to
		tag_avp and flags_avp, respectively, if the corresponding
		module parameter has been defined.
		</p>
            <p>
		Execution time of from_gw() function is M * O(log N),
		where M is number of LCR instances and N is average number of
		gateways in LCR instances.
		</p>
            <p>
		This function can be used from REQUEST_ROUTE, FAILURE_ROUTE,
		ONREPLY_ROUTE.
		</p>
            <div class="example">
              <a id="idp1828584"></a>
              <p class="title">
                <strong>Example 1.50. <code class="function">from_gw</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
$var(lcr_id) = from_any_gw("192.168.1.1", 3);
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.7.  to_gw(lcr_id[, ip_addr, proto])">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1829808"></a>4.7. 
		<code class="function">to_gw(lcr_id[, ip_addr, proto])</code>
		</h3>
                </div>
              </div>
            </div>
            <p>
		Checks if in-dialog request goes to IP address and transport
		protocol specified for a gateway in LCR instance lcr_id.
		Fails if LCR
		instance includes one or more gateways without IP
		address.  IP address and transport protocol to be
		checked are either taken from Request-URI or (if
		present) from ip_addr and proto arguments.  See from_gw()
		for more info regarding the arguments.
		</p>
            <p>
		Returns 1 on success and -1 on failure and error.
		</p>
            <p>
		Execution time of to_gw() function is O(log N),
		where N is number of gateways in the LCR instance.
		</p>
            <p>
		This function can be used from REQUEST_ROUTE, FAILURE_ROUTE.
		</p>
            <div class="example">
              <a id="idp1832008"></a>
              <p class="title">
                <strong>Example 1.51. <code class="function">to_gw</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
if (to_gw("1")) {
	...
	exit;
};
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.8.  to_any_gw([ip_addr, proto])">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1833168"></a>4.8. 
		<code class="function">to_any_gw([ip_addr, proto])</code>
		</h3>
                </div>
              </div>
            </div>
            <p>
		Checks if in-dialog request goes to IP address and transport
		protocol of any gateway.
		Only LCR instances, where all gateways 
		have IP address, are included in the test. IP
		address and transport protocol to be checked are
		either taken from Request-URI or (if present)
		from ip_addr and proto arguments.   See from_gw()
		for more info regarding the arguments.
		</p>
            <p>
		Execution time of to_any_gw() function is M * O(log N),
		where M is number of LCR instances and N is average
		number of gateways in LCR instances.
		</p>
            <p>
		If any gateway has the IP address, returns LCR identifier
		of the gateway.  Returns -1 if request does
		not go to a gateway and on error.
		</p>
            <p>
		This function can be used from REQUEST_ROUTE, FAILURE_ROUTE.
		</p>
            <div class="example">
              <a id="idp1835480"></a>
              <p class="title">
                <strong>Example 1.52. <code class="function">to_gw</code> usage</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
if (to_any_gw("192.55.66.2", 1)) {
	...
	exit;
};
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
        <div class="section" title="5. Exported RPC Commands">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp1836784"></a>5. Exported RPC Commands</h2>
              </div>
            </div>
          </div>
          <div class="section" title="5.1. lcr.reload">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1837136"></a>5.1. <code class="function">lcr.reload</code></h3>
                </div>
              </div>
            </div>
            <p>
			Causes lcr module to re-read the contents of
			LCR tables into memory.
		</p>
            <p>
		Name: <span class="emphasis"><em>lcr.reload</em></span>
		</p>
            <p>Parameters: <span class="emphasis"><em>none</em></span></p>
            <div class="example">
              <a id="idp1838824"></a>
              <p class="title">
                <strong>Example 1.53. <code class="function">lcr.reload</code> RPC example</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">		$ kamcmd lcr.reload</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="5.2. lcr.dump_gws">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1839992"></a>5.2. <code class="function">lcr.dump_gws</code></h3>
                </div>
              </div>
            </div>
            <p>
			Causes lcr module to dump the contents of its
			in-memory gw table.
		</p>
            <p>Parameters: <span class="emphasis"><em>none</em></span></p>
            <div class="example">
              <a id="idp1841232"></a>
              <p class="title">
                <strong>Example 1.54. <code class="function">lcr.dump_gws</code> RPC example</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">		$ kamcmd lcr.dump_gws</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="5.3. lcr.dump_rules">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1842408"></a>5.3. <code class="function">lcr.dump_rules</code></h3>
                </div>
              </div>
            </div>
            <p>
			Causes lcr module to dump the contents of its
			in-memory lcr_rule and lcr_rule_target tables.
		</p>
            <p>Parameters: <span class="emphasis"><em>none</em></span></p>
            <div class="example">
              <a id="idp1843680"></a>
              <p class="title">
                <strong>Example 1.55. <code class="function">lcr.dump_rules</code> RPC example</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">		$ kamcmd lcr.dump_rules</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="5.4. lcr.defunct_gw">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp1844856"></a>5.4. <code class="function">lcr.defunct_gw</code></h3>
                </div>
              </div>
            </div>
            <p>
			Defuncts gateway loaded into memory for a period of
			time (seconds) without a need to store gateway's
			defunct	value into database and reload the tables.
		</p>
            <p>
		Name: <span class="emphasis"><em>lcr.defunct_gw</em></span>
		</p>
            <p>Parameters: <span class="emphasis"><em>lcr_id gw_id period</em></span></p>
            <div class="example">
              <a id="idp1846656"></a>
              <p class="title">
                <strong>Example 1.56. <code class="function">lcr.defunct_gw</code> RPC example</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">		$ kamcmd lcr.defunct_gw 1 4 120</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
        <div class="section" title="6. Known Limitations">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp1847912"></a>6. Known Limitations</h2>
              </div>
            </div>
          </div>
          <p>
		In-memory LCR rules and gw tables are switched
		by two consecutive machine instructions. If lcr reload
		process is interrupted after the first one, in-memory
		gateway table does not match in-memory rule table until
		execution of lcr reload process is resumed.
	</p>
        </div>
      </div>
    </div>
  </body>
</html>
