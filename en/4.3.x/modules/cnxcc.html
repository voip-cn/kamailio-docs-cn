<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>cnxcc Module</title>
    <link rel="stylesheet" type="text/css" href="../../../../css/sr-doc.css" tppabs="http://kamailio.org/css/sr-doc.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.76.1" />
    <link rel="home" href="#idp15539008" title="cnxcc Module" />
    <link rel="next" href="#idp17756560" title="Chapter 1. Admin Guide" />
  </head>
  <body>
    <div class="book" title="cnxcc Module">
      <div class="titlepage">
        <div>
          <div>
            <h1 class="title"><a id="idp15539008"></a>cnxcc Module</h1>
          </div>
          <div>
            <div class="authorgroup">
              <div class="author">
                <h3 class="author"><span class="firstname">Carlos</span> <span class="surname">Ruiz Díaz</span></h3>
                <div class="affiliation">
                  <span class="orgname">ConexionGroup S.A.<br /></span>
                </div>
              </div>
            </div>
          </div>
          <div>
            <p class="copyright">Copyright © 2013 Carlos Ruiz Díaz, carlos.ruizdiaz@gmail.com</p>
          </div>
          <div>
            <p class="copyright">Copyright © 2014 Carlos Ruiz Díaz, carlos@latamvoices.com</p>
          </div>
        </div>
        <hr />
      </div>
      <div class="toc">
        <p>
          <strong>Table of Contents</strong>
        </p>
        <dl>
          <dt>
            <span class="chapter">
              <a href="#idp17756560">1. Admin Guide</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="#idp18990416">1. Overview</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="#idp18039032">2. Dependencies</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp18969008">2.1. Modules</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp17228200">2.2. Libraries</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp17599808">3. Parameters</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp18110232">3.1. <code class="varname"> redis </code> (integer)</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp17280320">3.2. <code class="varname">credit_check_period</code> (integer)</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp15728576">4. Functions</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp15728944">4.1. 
		<code class="function">cnxcc_set_max_credit()</code>
	    </a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp15524416">4.2. 
                <code class="function">cnxcc_set_max_time()</code>
            </a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp15528368">4.3. 
                <code class="function">cnxcc_update_max_time()</code>
            </a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp15822080">4.4. 
                <code class="function">cnxcc_set_max_channel()</code>
            </a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp15827744">4.5. 
                <code class="function">cnxcc_terminate_all()</code>
            </a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp15831792">5. Exported RPC Commands</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="#idp15832144">5.1. <code class="varname">cnxcc.active_clients</code></a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp15833952">5.2. <code class="varname">cnxcc.check_client</code></a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="#idp15663536">5.3. <code class="varname">cnxcc.kill_call</code></a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="#idp15665544">6. Events</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="#idp15667208">7. Web Interface</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="#idp15668352">8. Sample</a>
                </span>
              </dt>
            </dl>
          </dd>
        </dl>
      </div>
      <div class="list-of-examples">
        <p>
          <strong>List of Examples</strong>
        </p>
        <dl>
          <dt>1.1. <a href="#idp18119192">dlg_flag</a></dt>
          <dt>1.2. <a href="#idp17057720">credit_check_period</a></dt>
          <dt>1.3. <a href="#idp15523224">cnxcc_set_max_credit()</a></dt>
          <dt>1.4. <a href="#idp15527352">cnxcc_set_max_time()</a></dt>
          <dt>1.5. <a href="#idp15820960">cnxcc_update_max_time()</a></dt>
          <dt>1.6. <a href="#idp15826392">cnxcc_set_max_channels()</a></dt>
          <dt>1.7. <a href="#idp15830680">cnxcc_set_max_time()</a></dt>
          <dt>1.8. <a href="#idp15668720">kamailio-cnxcc.cfg</a></dt>
        </dl>
      </div>
      <div class="chapter" title="Chapter 1. Admin Guide">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="idp17756560"></a>Chapter 1. Admin Guide</h2>
            </div>
          </div>
        </div>
        <div class="toc">
          <p>
            <strong>Table of Contents</strong>
          </p>
          <dl>
            <dt>
              <span class="section">
                <a href="#idp18990416">1. Overview</a>
              </span>
            </dt>
            <dt>
              <span class="section">
                <a href="#idp18039032">2. Dependencies</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp18969008">2.1. Modules</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp17228200">2.2. Libraries</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp17599808">3. Parameters</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp18110232">3.1. <code class="varname"> redis </code> (integer)</a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp17280320">3.2. <code class="varname">credit_check_period</code> (integer)</a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp15728576">4. Functions</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp15728944">4.1. 
		<code class="function">cnxcc_set_max_credit()</code>
	    </a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp15524416">4.2. 
                <code class="function">cnxcc_set_max_time()</code>
            </a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp15528368">4.3. 
                <code class="function">cnxcc_update_max_time()</code>
            </a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp15822080">4.4. 
                <code class="function">cnxcc_set_max_channel()</code>
            </a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp15827744">4.5. 
                <code class="function">cnxcc_terminate_all()</code>
            </a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp15831792">5. Exported RPC Commands</a>
              </span>
            </dt>
            <dd>
              <dl>
                <dt>
                  <span class="section">
                    <a href="#idp15832144">5.1. <code class="varname">cnxcc.active_clients</code></a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp15833952">5.2. <code class="varname">cnxcc.check_client</code></a>
                  </span>
                </dt>
                <dt>
                  <span class="section">
                    <a href="#idp15663536">5.3. <code class="varname">cnxcc.kill_call</code></a>
                  </span>
                </dt>
              </dl>
            </dd>
            <dt>
              <span class="section">
                <a href="#idp15665544">6. Events</a>
              </span>
            </dt>
            <dt>
              <span class="section">
                <a href="#idp15667208">7. Web Interface</a>
              </span>
            </dt>
            <dt>
              <span class="section">
                <a href="#idp15668352">8. Sample</a>
              </span>
            </dt>
          </dl>
        </div>
        <div class="section" title="1. Overview">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp18990416"></a>1. Overview</h2>
              </div>
            </div>
          </div>
          <p>
		This module was designed to act as a mechanism to limit call duration based on credit information parameters.
		After getting the credit information of the call being set up, you can instruct the module to start monitoring
		the consumed credit to shutdown a single call or a group of calls in case of credit exhaustion.	
	</p>
          <p>
		Every call is associated to an unique client/customer identifier. If a credit event occurs, all calls hooked
	   	to this identifier are automatically shutdown.
	</p>
          <p>
		Cnxcc is dialog-aware so there's no need to explicitly allocate/deallocate the monitoring. Only a single function
		call inside the script is needed upon reception of the INVITE.
	</p>
          <p>
		The credit discount rate is proportional to the number of calls grouped inside an identifier. Once the setup
		of the first call is done, the information remains while the call is active. If the customer starts a new call with
		the same routing criteria, it will land in the same monitoring bag and it will consume the same pool of credit in
		rates that are equal to the cost per second of both calls.
	</p>
          <p>
		If your accounting program does not maintain the state of the call in real time, this module can provide you
		with that ability.
	</p>
          <p>
		Cnxcc can also provide more common means of monitoring, i.e., by time limit or by maximum simultaneous calls.
	</p>
        </div>
        <div class="section" title="2. Dependencies">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp18039032"></a>2. Dependencies</h2>
              </div>
            </div>
          </div>
          <div class="section" title="2.1. Modules">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp18969008"></a>2.1. Modules</h3>
                </div>
              </div>
            </div>
            <p>
		The following module must be loaded before this module: 
		</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>dialog</em></span>
		    </p>
                </li>
              </ul>
            </div>
            <p>
	    </p>
          </div>
          <div class="section" title="2.2. Libraries">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp17228200"></a>2.2. Libraries</h3>
                </div>
              </div>
            </div>
            <p>
		The following module must be loaded before this module: 
		</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
			<span class="emphasis"><em> hiredis-devel &gt;= 0.11.0 </em></span>
		    </p>
                </li>
                <li class="listitem">
                  <p>
			<span class="emphasis"><em> libevent-devel &gt;= 2.0.18-2 </em></span>
		    </p>
                </li>
              </ul>
            </div>
            <p>
	    </p>
          </div>
        </div>
        <div class="section" title="3. Parameters">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp17599808"></a>3. Parameters</h2>
              </div>
            </div>
          </div>
          <div class="section" title="3.1.  redis (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp18110232"></a>3.1. <code class="varname"> redis </code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Redis datasource connection information
	    </p>
            <div class="example">
              <a id="idp18119192"></a>
              <p class="title">
                <strong>Example 1.1. dlg_flag</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("cnxcc", "redis", "addr=127.0.0.1;port=6379;db=1")
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="3.2. credit_check_period (integer)">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp17280320"></a>3.2. <code class="varname">credit_check_period</code> (integer)</h3>
                </div>
              </div>
            </div>
            <p>
		Indicates how often the credit checking function should be called. It is directly related to the precison of the
		module. The maximum precision is 1, which means that every call is checked every one second.

	    </p>
            <p>
		Values greater than 1 leads to precision lost but less CPU consumption.
	    </p>
            <div class="example">
              <a id="idp17057720"></a>
              <p class="title">
                <strong>Example 1.2. credit_check_period</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
modparam("cnxcc", "credit_check_period", 1)
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
        <div class="section" title="4. Functions">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp15728576"></a>4. Functions</h2>
              </div>
            </div>
          </div>
          <div class="section" title="4.1.  cnxcc_set_max_credit()">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp15728944"></a>4.1. 
		<code class="function">cnxcc_set_max_credit()</code>
	    </h3>
                </div>
              </div>
            </div>
            <p>
		Specifies the initial pulse, final pulse, max credit and cost per second of a call. The discount
		is calculated in pulses (30/6, 1/1, etc) and sustracted from the pool of credit.
	    </p>
            <p>
		<span class="emphasis"><em>Return code:</em></span>
		</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>1 - successful</em></span>
		    </p>
                </li>
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>-1 - failed, error logged</em></span>
		    </p>
                </li>
                <li class="listitem">
                  <p>
			<span class="emphasis"><em>-2 - failed, credit value is less than initial pulse value</em></span>
		    </p>
                </li>
              </ul>
            </div>
            <p>
	    </p>
            <div class="example">
              <a id="idp15523224"></a>
              <p class="title">
                <strong>Example 1.3. cnxcc_set_max_credit()</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
$var(customer) = "john-doe-123-premium";
$var(credit) = "100";
$var(cps)   = "2.00";         # cost per second
$var(initial_p)   = "030";    # intial pulse
$var(final_p)   = "006";      # final pulse

cnxcc_set_max_credit("$var(customer)", "$var(credit)", "$var(cps)", "$var(initial_p)", "$var(final_p)");
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.2.  cnxcc_set_max_time()">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp15524416"></a>4.2. 
                <code class="function">cnxcc_set_max_time()</code>
            </h3>
                </div>
              </div>
            </div>
            <p>
		Specifies the amount of time the call should last at most.
            </p>
            <p>
                <span class="emphasis"><em>Return code:</em></span>
                </p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
                        <span class="emphasis"><em>1 - successful</em></span>
                    </p>
                </li>
                <li class="listitem">
                  <p>
                        <span class="emphasis"><em>-1 - failed, error logged</em></span>
                    </p>
                </li>
              </ul>
            </div>
            <p>
            </p>
            <div class="example">
              <a id="idp15527352"></a>
              <p class="title">
                <strong>Example 1.4. cnxcc_set_max_time()</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
$var(customer) = "john-doe-123-basic";
$var(max_time) = 120;

cnxcc_set_max_time("$var(customer)", "$var(max_time)");
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.3.  cnxcc_update_max_time()">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp15528368"></a>4.3. 
                <code class="function">cnxcc_update_max_time()</code>
            </h3>
                </div>
              </div>
            </div>
            <p>
		Updates max-time of an established and monitored call. This can be used to grant minimum values and to update them every short periods on time as a mean to prevent frauds and/or to mimic requested/granted units of time of Credit Control Application behavior.
            </p>
            <p>
                <span class="emphasis"><em>Return code:</em></span>
                </p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
                        <span class="emphasis"><em>1 - successful</em></span>
                    </p>
                </li>
                <li class="listitem">
                  <p>
                        <span class="emphasis"><em>-1 - failed, error logged</em></span>
                    </p>
                </li>
              </ul>
            </div>
            <p>
            </p>
            <div class="example">
              <a id="idp15820960"></a>
              <p class="title">
                <strong>Example 1.5. cnxcc_update_max_time()</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
        $var(update_time)  = 5;
        $var(client)       = "john-doe-123-basic";

        if (!cnxcc_update_max_time("$var(client)",
                                  "$var(update_time)")) {
                xlog("Error updating max-time");
                return;
        }

...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.4.  cnxcc_set_max_channel()">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp15822080"></a>4.4. 
                <code class="function">cnxcc_set_max_channel()</code>
            </h3>
                </div>
              </div>
            </div>
            <p>
		Specifies a limit for the number of simultaneous calls
            </p>
            <p>
                <span class="emphasis"><em>Return code:</em></span>
                </p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
                        <span class="emphasis"><em>1 - successful</em></span>
                    </p>
                </li>
                <li class="listitem">
                  <p>
                        <span class="emphasis"><em>-1 - failed, error logged</em></span>
                    </p>
                </li>
                <li class="listitem">
                  <p>
                        <span class="emphasis"><em>-2 - failed, calls established plus calls being established result in more than the limit you specified</em></span>
                    </p>
                </li>
                <li class="listitem">
                  <p>
                        <span class="emphasis"><em>-3 - failed, number of calls established is more than the limit you specified</em></span>
                    </p>
                </li>
              </ul>
            </div>
            <p>
            </p>
            <div class="example">
              <a id="idp15826392"></a>
              <p class="title">
                <strong>Example 1.6. cnxcc_set_max_channels()</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
$var(customer)  = "john-doe-123-basic";
$var(max_chan)  = 2;
$var(retcode)   = cnxcc_set_max_channels("$var(customer)", "$var(max_chan)");

if ($var(retcode) == -1) {
	xlog("Error setting up credit control");
	return;
}

if ($var(retcode) &lt; -1) {
        xlog("Too many channels for customer");
        sl_send_reply(403, "Forbidden");

        if (!cnxcc_terminate_all("$var(customer)")) {
		xlog("Error terminating customer's calls");
	}

	exit;
}

...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
          <div class="section" title="4.5.  cnxcc_terminate_all()">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp15827744"></a>4.5. 
                <code class="function">cnxcc_terminate_all()</code>
            </h3>
                </div>
              </div>
            </div>
            <p>
		Terminates all calls of the specified customer/profile
            </p>
            <p>
                <span class="emphasis"><em>Return code:</em></span>
                </p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p>
                        <span class="emphasis"><em>1 - successful</em></span>
                    </p>
                </li>
                <li class="listitem">
                  <p>
                        <span class="emphasis"><em>-1 - failed, error logged</em></span>
                    </p>
                </li>
              </ul>
            </div>
            <p>
            </p>
            <div class="example">
              <a id="idp15830680"></a>
              <p class="title">
                <strong>Example 1.7. cnxcc_set_max_time()</strong>
              </p>
              <div class="example-contents">
                <pre class="programlisting">...
$var(customer)  = "john-doe-123-basic";

if (!cnxcc_terminate_all("$var(customer)")) {
	xlog("Error terminating customer's calls");
}
...</pre>
              </div>
            </div>
            <br class="example-break" />
          </div>
        </div>
        <div class="section" title="5. Exported RPC Commands">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp15831792"></a>5. Exported RPC Commands</h2>
              </div>
            </div>
          </div>
          <div class="section" title="5.1. cnxcc.active_clients">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp15832144"></a>5.1. <code class="varname">cnxcc.active_clients</code></h3>
                </div>
              </div>
            </div>
            <p>
		Retrieves all calls grouped by their identifiers.
	    </p>
            <p>
		Parameters: <span class="emphasis"><em>none</em></span>
	    </p>
            <p>
		Example:
	    </p>
            <pre class="programlisting">	    kamcmd cnxcc.active_clients</pre>
          </div>
          <div class="section" title="5.2. cnxcc.check_client">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp15833952"></a>5.2. <code class="varname">cnxcc.check_client</code></h3>
                </div>
              </div>
            </div>
            <p>
		Retrives all calls from a particular identifier.
            </p>
            <p>
		    Parameters: <span class="emphasis"><em>client/customer identifier</em></span>
            </p>
            <p>
                Example:
            </p>
            <pre class="programlisting">	    kamcmd cnxcc.check_client john-doe-123-premium</pre>
          </div>
          <div class="section" title="5.3. cnxcc.kill_call">
            <div class="titlepage">
              <div>
                <div>
                  <h3 class="title"><a id="idp15663536"></a>5.3. <code class="varname">cnxcc.kill_call</code></h3>
                </div>
              </div>
            </div>
            <p>
		    Kills an active call using its call ID.
	    </p>
            <p>
                Parameters: <span class="emphasis"><em>Call-ID</em></span>
            </p>
            <p>
                Example:
            </p>
            <pre class="programlisting">            kamcmd cnxcc.kill_call qumojlaahitafih@carlosrdcnx-laptop.site</pre>
          </div>
        </div>
        <div class="section" title="6. Events">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp15665544"></a>6. Events</h2>
              </div>
            </div>
          </div>
          <p>
		When a call is forced to end an event route is automatically invoked. This route is suited with a fake OPTIONS
		message containing the call ID, ftag and ttag of the original call so it can be located somehow in the accounting
		database.
	    </p>
          <p>
                Example:
            </p>
          <pre class="programlisting">...
event_route[cnxcc:call-shutdown]
{
	xlog("L_INFO", "[$ci]: call killed");

        # perform some kind of notification, database update, email sending, etc.
}
...</pre>
        </div>
        <div class="section" title="7. Web Interface">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp15667208"></a>7. Web Interface</h2>
              </div>
            </div>
          </div>
          <p>
		The module contains a web management interface completely optional. With it, you can review your calls in real time
		and hang them up if necessary.    
	    </p>
          <p>
                Link: https://github.com/caruizdiaz/cnxcc-web
            </p>
        </div>
        <div class="section" title="8. Sample">
          <div class="titlepage">
            <div>
              <div>
                <h2 class="title"><a id="idp15668352"></a>8. Sample</h2>
              </div>
            </div>
          </div>
          <div class="example">
            <a id="idp15668720"></a>
            <p class="title">
              <strong>Example 1.8. kamailio-cnxcc.cfg</strong>
            </p>
            <div class="example-contents">
              <pre class="programlisting">...
route[CNXCC]
{
	$var(client)              = "test-client-0-123-01";
      	$var(credit)              = "50";
      	$var(cost_per_sec)        = "0.5";
      	$var(i_pulse)             = "30";
      	$var(f_pulse)             = "6";

      	if (!cnxcc_set_max_credit("$var(client)",
                          "$var(credit)",
                          "$var(cost_per_sec)",
                          "$var(i_pulse)",
                          "$var(f_pulse)")) {
		 xlog("Error setting up credit control");
      	}
}

event_route[cnxcc:call-shutdown]
{
	xlog("L_INFO", "[$ci]: call killed");


}	    
...</pre>
            </div>
          </div>
          <br class="example-break" />
        </div>
      </div>
    </div>
  </body>
</html>
